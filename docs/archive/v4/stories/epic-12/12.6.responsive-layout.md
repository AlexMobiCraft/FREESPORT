# Story 12.6: Адаптивная верстка карточки товара

## Status
Draft

## Story
**Как** пользователь мобильного устройства,
**Я хочу** удобно просматривать карточку товара на смартфоне,
**Чтобы** получить всю информацию без проблем с навигацией.

## Acceptance Criteria
1. Desktop (>1024px): двухколоночный layout (галерея 2/3, сводка 1/3)
2. Tablet (640-1024px): двухколоночный layout с адаптивными отступами
3. Mobile (<640px): вертикальный стек всех элементов
4. Галерея на mobile: горизонтальный swipe для изображений
5. Кнопка "В корзину" зафиксирована внизу экрана на mobile
6. Все интерактивные элементы имеют минимальный размер 44x44px
7. Текст читаем на всех разрешениях (минимум body-m)

## Tasks / Subtasks

- [ ] Настроить responsive layout для page.tsx (AC: 1, 2, 3)
  - [ ] Desktop: Grid 2-колонки (2fr 1fr), gap 24px
  - [ ] Tablet: Grid 2-колонки (3fr 2fr), gap 16px
  - [ ] Mobile: Stack вертикально (flex-col), gap 16px
  - [ ] Container padding адаптивный (desktop: 24px, tablet: 16px, mobile: 12px)

- [ ] Адаптировать ProductGallery для mobile (AC: 4)
  - [ ] Desktop/Tablet: вертикальные thumbnails как в story 12.4
  - [ ] Mobile: горизонтальный swipe (overflow-x-scroll)
  - [ ] Mobile: thumbnails внизу основного изображения
  - [ ] Touch gestures для навигации (swipe left/right)
  - [ ] Snap scroll для плавной навигации

- [ ] Адаптировать ProductSummary для mobile (AC: 5)
  - [ ] Desktop/Tablet: sticky позиционирование (offset 96px)
  - [ ] Mobile: фиксированная кнопка внизу экрана (fixed bottom-0)
  - [ ] Mobile: блок цены и кнопка в одном контейнере
  - [ ] Padding для контента внизу (pb-20) чтобы не перекрывался кнопкой

- [ ] Touch targets и accessibility (AC: 6, 7)
  - [ ] Все кнопки минимум 44x44px
  - [ ] Thumbnails на mobile: минимум 56x56px
  - [ ] Отступы между интерактивными элементами: минимум 8px
  - [ ] Текст минимум body-m (16px) на всех разрешениях
  - [ ] Контраст текста > 4.5:1

- [ ] Breakpoints конфигурация
  - [ ] Mobile: 0-639px
  - [ ] Tablet: 640-1023px
  - [ ] Desktop: 1024px+
  - [ ] Использовать Tailwind breakpoints (sm:, md:, lg:)

- [ ] Адаптировать Breadcrumbs для mobile
  - [ ] Desktop: полная цепочка навигации
  - [ ] Mobile: сократить до последних 2 уровней
  - [ ] Overflow scroll для длинных breadcrumbs

- [ ] Адаптировать ProductSpecs для mobile
  - [ ] Desktop: таблица 2-колонки
  - [ ] Mobile: стек вертикально (key-value пары)
  - [ ] Увеличить отступы для лучшей читаемости

- [ ] Адаптировать RelatedProducts для mobile
  - [ ] Desktop: 6 карточек
  - [ ] Tablet: 4 карточки
  - [ ] Mobile: 2-3 карточки с swipe
  - [ ] Touch-friendly navigation

- [ ] Написать responsive тесты
  - [ ] Тест layout на desktop разрешении
  - [ ] Тест layout на tablet разрешении
  - [ ] Тест layout на mobile разрешении
  - [ ] Тест фиксированной кнопки на mobile
  - [ ] Тест touch targets (минимум 44px)

- [ ] Accessibility тестирование
  - [ ] Проверка контраста текста (axe-core)
  - [ ] Проверка touch targets размеров
  - [ ] Keyboard navigation на mobile
  - [ ] Screen reader тестирование

## Dev Notes

### Relevant Source Tree
```
frontend/src/
├── app/
│   └── product/
│       └── [slug]/
│           └── page.tsx          (UPDATE - добавить responsive layout)
├── components/
│   └── product/
│       ├── ProductGallery.tsx    (UPDATE - mobile swipe)
│       ├── ProductSummary.tsx    (UPDATE - fixed button mobile)
│       ├── ProductBreadcrumbs.tsx (UPDATE - truncate mobile)
│       └── ProductSpecs.tsx      (UPDATE - vertical stack mobile)
└── styles/
    └── globals.css               (UPDATE - breakpoints если нужно)
```

### Responsive Layout
```typescript
// src/app/product/[slug]/page.tsx

export default async function ProductPage({ params }: { params: { slug: string } }) {
  const product = await getProductBySlug(params.slug);

  return (
    <div className="container mx-auto px-6 md:px-4 lg:px-6 py-6">
      {/* Breadcrumbs */}
      <ProductBreadcrumbs category={product.category} />

      {/* Main Content */}
      <div className="grid grid-cols-1 lg:grid-cols-[2fr_1fr] gap-6 lg:gap-6 mt-6">
        {/* Left Column - Gallery & Info */}
        <div className="space-y-6">
          <ProductGallery images={product.images} productName={product.name} />
          <ProductInfo product={product} />
          <ProductSpecs specifications={product.specifications} />
        </div>

        {/* Right Column - Summary (Sticky on desktop) */}
        <div className="lg:sticky lg:top-24 lg:self-start">
          <ProductSummary product={product} />
        </div>
      </div>

      {/* Related Products */}
      <RelatedProducts products={product.related_products} />

      {/* Mobile Fixed Button (показывается только на mobile) */}
      <div className="lg:hidden fixed bottom-0 left-0 right-0 bg-white shadow-modal p-4 pb-safe">
        <AddToCartButton product={product} />
      </div>

      {/* Padding Bottom для mobile чтобы контент не перекрывался кнопкой */}
      <div className="h-20 lg:hidden" />
    </div>
  );
}
```

### Mobile ProductGallery
```typescript
// Адаптация ProductGallery для mobile

export default function ProductGallery({ images, productName }: ProductGalleryProps) {
  return (
    <>
      {/* Desktop/Tablet: вертикальные thumbnails */}
      <div className="hidden md:flex gap-3">
        {/* Вертикальные thumbnails + Primary Image */}
        {/* ... существующий код из story 12.4 ... */}
      </div>

      {/* Mobile: горизонтальный swipe */}
      <div className="md:hidden">
        {/* Primary Image */}
        <div className="w-full aspect-square rounded-2xl shadow-default overflow-hidden mb-3">
          <Image
            src={images[selectedImage].image}
            alt={images[selectedImage].alt_text}
            width={400}
            height={400}
            className="object-cover w-full h-full"
            priority
          />
        </div>

        {/* Horizontal Thumbnails */}
        <div className="flex gap-2 overflow-x-scroll scrollbar-hide snap-x snap-mandatory">
          {images.map((img, idx) => (
            <button
              key={img.id}
              onClick={() => setSelectedImage(idx)}
              className={`
                flex-shrink-0 w-14 h-14 rounded-lg overflow-hidden snap-start
                ${idx === selectedImage ? 'ring-2 ring-primary' : 'ring-1 ring-neutral-300'}
              `}
            >
              <Image src={img.image} alt={img.alt_text} width={56} height={56} className="object-cover" />
            </button>
          ))}
        </div>
      </div>
    </>
  );
}
```

### Mobile Fixed Button
```typescript
// Фиксированная кнопка "В корзину" для mobile

<div className="lg:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-neutral-300 shadow-modal p-4 z-40 pb-safe">
  <div className="flex items-center gap-3">
    {/* Цена */}
    <div className="flex-1">
      <p className="text-caption text-secondary">Цена</p>
      <p className="text-title-m text-primary">{formatPrice(product.price.current)} ₽</p>
    </div>

    {/* Кнопка */}
    <button
      onClick={handleAddToCart}
      className="flex-1 h-14 bg-primary hover:bg-primary-hover text-white rounded-lg font-medium"
    >
      В корзину
    </button>
  </div>
</div>
```

### Breakpoints
```javascript
// tailwind.config.js

module.exports = {
  theme: {
    screens: {
      'sm': '640px',   // Tablet
      'md': '768px',   // Tablet landscape
      'lg': '1024px',  // Desktop
      'xl': '1280px',  // Large desktop
    },
  },
};
```

### Touch Targets
Минимальный размер для touch targets:
- Кнопки: 44x44px (iOS), 48x48px (Android) - используем 44px как минимум
- Thumbnails на mobile: 56x56px (для удобного тапа)
- Отступы между targets: минимум 8px

### Важные замечания
- Использовать `pb-safe` для учета safe area на iOS (notch)
- Тестировать на реальных устройствах (iPhone, Android)
- Проверить landscape ориентацию на mobile
- Оптимизировать изображения для mobile (WebP, меньший размер)

### Testing

#### Test file location
- `src/app/product/[slug]/__tests__/responsive.test.tsx`

#### Test cases
```typescript
describe('Product Page Responsive', () => {
  it('renders 2-column layout on desktop', () => {
    // viewport > 1024px
  });

  it('renders 2-column layout on tablet', () => {
    // viewport 640-1024px
  });

  it('renders vertical stack on mobile', () => {
    // viewport < 640px
  });

  it('shows fixed button on mobile', () => {
    // проверить fixed bottom button
  });

  it('hides fixed button on desktop', () => {
    // проверить что кнопка скрыта lg:hidden
  });

  it('all touch targets are minimum 44px', () => {
    // проверить размеры всех интерактивных элементов
  });

  it('text is readable on all screen sizes', () => {
    // проверить минимальный размер текста 16px
  });
});
```

#### Responsive Testing Tools
- Chrome DevTools Device Mode
- Vitest с @testing-library/react
- Playwright для E2E тестов на разных viewports
- axe-core для accessibility тестов

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-30 | 1.0 | Создание story 12.6 на основе Epic 12 | Sarah (PO) |

## Dev Agent Record
(Заполняется dev-агентом)

## QA Results
(Заполняется QA-агентом)
