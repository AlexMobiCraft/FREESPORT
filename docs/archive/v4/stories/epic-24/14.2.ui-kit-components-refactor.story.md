# Story 14.2: Рефакторинг UI Kit компонентов

## Status

Ready for Review

---

## Story

**As a** Frontend Developer,  
**I want** заменить все хардкод HEX цветов в UI Kit компонентах на Tailwind токены,  
**so that** компоненты автоматически используют новую сине-голубую палитру и обеспечивают консистентность дизайн-системы.

---

## Acceptance Criteria

### AC 1: Button Component ✅
**Файл:** `frontend/src/components/ui/Button/Button.tsx`

**БЫЛО:**
```tsx
const variantClasses = {
  primary: 'bg-[#1F1F1F] hover:bg-[#3A3A3A]',
  secondary: 'border-[#1F1F1F] text-[#1F1F1F]',
};
```

**СТАЛО:**
```tsx
const variantClasses = {
  primary: 'bg-primary hover:bg-primary-hover active:bg-primary-active text-white',
  secondary: 'border-primary text-primary hover:bg-primary-subtle',
  subtle: 'bg-primary-subtle text-primary hover:bg-primary-subtle/80',
};
```

**Критерии приёмки:**
- [ ] Все хардкод HEX заменены на токены
- [ ] Добавлено состояние `active`
- [ ] Вариант `subtle` использует `primary-subtle`

---

### AC 2: Badge Component ✅
**Файл:** `frontend/src/components/ui/Badge/Badge.tsx`

**БЫЛО:**
```tsx
const variantClasses = {
  new: 'bg-[#E1F0FF] text-[#0F5DA3]',
  hit: 'bg-[#E3F6EC] text-[#1F7A4A]',
  promo: 'bg-[#F4EBDC] text-[#8C4C00]',
  sale: 'bg-[#F9E1E1] text-[#A63232]',
};
```

**СТАЛО:**
```tsx
const variantClasses = {
  new: 'bg-[#E7F3FF] text-primary',              // #0060FF
  hit: 'bg-[#E0F5E8] text-accent-success',       // #00AA5B
  promo: 'bg-[#FFF0F5] text-accent-promo',       // #FF2E93
  sale: 'bg-[#FFE1E8] text-accent-danger',       // #E53935
  discount: 'bg-[#F0E7FF] text-[#7C3AED]',       // Фиолетовый
};
```

**Критерии приёмки:**
- [ ] Текстовые цвета используют семантические токены
- [ ] Фоновые цвета обновлены согласно новой палитре
- [ ] Добавлен вариант `discount`

---

### AC 3: Checkbox Component ✅
**Файл:** `frontend/src/components/ui/Checkbox/Checkbox.tsx`

**БЫЛО:**
```tsx
<input
  className="checked:bg-[#1F1F1F] checked:border-[#1F1F1F]"
/>
```

**СТАЛО:**
```tsx
<input
  className="checked:bg-primary checked:border-primary focus:ring-primary/12"
/>
```

**Критерии приёмки:**
- [ ] `checked` состояние использует `primary` токен
- [ ] Focus ring использует `primary/12`

---

### AC 4: Toggle Component ✅
**Файл:** `frontend/src/components/ui/Toggle/Toggle.tsx`

**БЫЛО:**
```tsx
<div className={cn(
  'bg-neutral-300',
  checked && 'bg-[#1F1F1F]'
)}>
```

**СТАЛО:**
```tsx
<div className={cn(
  'bg-neutral-300',
  checked && 'bg-primary'
)}>
```

**Критерии приёмки:**
- [ ] Track ON использует `primary` токен
- [ ] Track OFF остаётся `neutral-300`

---

### AC 5: Tabs Component ✅
**Файл:** `frontend/src/components/ui/Tabs/Tabs.tsx`

**БЫЛО:**
```tsx
<button className={cn(
  'pb-2 border-b-2 transition-colors',
  isActive ? 'border-primary text-[#1F1F1F]' : 'border-transparent text-neutral-600'
)}>
```

**СТАЛО:**
```tsx
<button className={cn(
  'pb-2 border-b-2 transition-colors',
  isActive ? 'border-primary text-primary' : 'border-transparent text-neutral-600'
)}>
```

**Критерии приёмки:**
- [ ] Active text использует `primary` токен
- [ ] Border indicator уже использует `primary`

---

### AC 6: Input Component ✅
**Файл:** `frontend/src/components/ui/Input/Input.tsx`

**БЫЛО:**
```tsx
<input
  className="focus:outline-[#1F1F1F]/60 focus:ring-4 focus:ring-[#1F1F1F]/12"
/>
```

**СТАЛО:**
```tsx
<input
  className="focus:outline-primary/60 focus:ring-4 focus:ring-primary/12"
/>
```

**Критерии приёмки:**
- [ ] Focus outline использует `primary/60`
- [ ] Focus ring использует `primary/12`

---

### AC 7: Toast Component ✅
**Файл:** `frontend/src/components/ui/Toast/Toast.tsx`

**БЫЛО:**
```tsx
const variantClasses = {
  info: 'border-l-4 border-[#0F5DA3]',
  success: 'border-l-4 border-[#1F7A1F]',
  warning: 'border-l-4 border-[#B07600]',
  error: 'border-l-4 border-[#C23B3B]',
};
```

**СТАЛО:**
```tsx
const variantClasses = {
  info: 'border-l-4 border-primary',           // #0060FF
  success: 'border-l-4 border-accent-success', // #00AA5B
  warning: 'border-l-4 border-accent-warning', // #F5A623
  error: 'border-l-4 border-accent-danger',    // #E53935
};
```

**Критерии приёмки:**
- [ ] Все варианты используют семантические токены
- [ ] Border colors соответствуют design-system.json

---

### AC 8: Link Component ✅
**Файл:** `frontend/src/components/ui/Link/Link.tsx` (если существует)

**БЫЛО:**
```tsx
<a className="text-[#1F1F1F] hover:text-[#3A3A3A]">
```

**СТАЛО:**
```tsx
<a className="text-primary hover:text-primary-hover">
```

**Критерии приёмки:**
- [ ] Текст использует `primary` токен
- [ ] Hover использует `primary-hover` токен

---

### AC 9: Header Cart Badge ✅
**Файл:** `frontend/src/components/layout/Header.tsx`

**БЫЛО:**
```tsx
<div className="bg-[#F9E1E1] text-[#A63232]">
  {cartCount}
</div>
```

**СТАЛО:**
```tsx
<div className="bg-[#FFE1E8] text-accent-danger">
  {cartCount}
</div>
```

**Критерии приёмки:**
- [ ] Cart badge использует новые цвета sale варианта
- [ ] Текст использует `accent-danger` токен

---

### AC 10: Unit Tests ✅
**Критерии приёмки:**
- [ ] Все компонентные тесты проходят (`npm test`)
- [ ] Coverage >= 80% сохранён (`npm run test:coverage`)
- [ ] Snapshots обновлены (`npm run test:update-snapshots`)
- [ ] Визуальная регрессия отсутствует

---

## Tasks / Subtasks

### Task 1: Рефакторинг Button Component (AC: 1)
- [x] 1.1 Открыть `frontend/src/components/ui/Button/Button.tsx`
- [x] 1.2 Заменить `bg-[#1F1F1F]` → `bg-primary`
- [x] 1.3 Заменить `hover:bg-[#3A3A3A]` → `hover:bg-primary-hover`
- [x] 1.4 Добавить `active:bg-primary-active`
- [x] 1.5 Обновить secondary вариант на токены
- [x] 1.6 Добавить subtle вариант (если отсутствует)
- [x] 1.7 Запустить тест: `npm test -- Button.test.tsx`

### Task 2: Рефакторинг Badge Component (AC: 2)
- [x] 2.1 Открыть `frontend/src/components/ui/Badge/Badge.tsx`
- [x] 2.2 Обновить `new` вариант: bg `#E7F3FF`, text `text-primary`
- [x] 2.3 Обновить `hit` вариант: bg `#E0F5E8`, text `text-accent-success`
- [x] 2.4 Обновить `promo` вариант: bg `#FFF0F5`, text `text-accent-promo`
- [x] 2.5 Обновить `sale` вариант: bg `#FFE1E8`, text `text-accent-danger`
- [x] 2.6 Добавить `discount` вариант: bg `#F0E7FF`, text `#7C3AED`
- [x] 2.7 Запустить тест: `npm test -- Badge.test.tsx`

### Task 3: Рефакторинг Checkbox & Toggle (AC: 3, 4)
- [x] 3.1 Открыть `frontend/src/components/ui/Checkbox/Checkbox.tsx`
- [x] 3.2 Заменить `checked:bg-[#1F1F1F]` → `checked:bg-primary`
- [x] 3.3 Заменить `checked:border-[#1F1F1F]` → `checked:border-primary`
- [x] 3.4 Добавить `focus:ring-primary/12`
- [x] 3.5 Открыть `frontend/src/components/ui/Toggle/Toggle.tsx`
- [x] 3.6 Заменить `bg-[#1F1F1F]` → `bg-primary` для checked состояния
- [x] 3.7 Запустить тесты: `npm test -- Checkbox.test.tsx Toggle.test.tsx`

### Task 4: Рефакторинг Tabs & Input (AC: 5, 6)
- [x] 4.1 Открыть `frontend/src/components/ui/Tabs/Tabs.tsx`
- [x] 4.2 Заменить `text-[#1F1F1F]` → `text-primary` для active состояния
- [x] 4.3 Открыть `frontend/src/components/ui/Input/Input.tsx`
- [x] 4.4 Заменить `focus:outline-[#1F1F1F]/60` → `focus:outline-primary/60`
- [x] 4.5 Заменить `focus:ring-[#1F1F1F]/12` → `focus:ring-primary/12`
- [x] 4.6 Запустить тесты: `npm test -- Tabs.test.tsx Input.test.tsx`

### Task 5: Рефакторинг Toast & Link (AC: 7, 8)
- [x] 5.1 Открыть `frontend/src/components/ui/Toast/Toast.tsx`
- [x] 5.2 Заменить все хардкод border цвета на семантические токены
- [x] 5.3 Проверить наличие `frontend/src/components/ui/Link/Link.tsx`
- [x] 5.4 Если существует: заменить цвета на `primary` токены
- [x] 5.5 Запустить тест: `npm test -- Toast.test.tsx`

### Task 6: Рефакторинг Header (AC: 9)
- [x] 6.1 Открыть `frontend/src/components/layout/Header.tsx`
- [x] 6.2 Найти cart badge элемент
- [x] 6.3 Заменить bg `#F9E1E1` → `#FFE1E8`
- [x] 6.4 Заменить text `#A63232` → `text-accent-danger`

### Task 7: Unit Testing (AC: 10)
- [x] 7.1 Запустить все тесты: `npm test`
- [x] 7.2 Проверить coverage: `npm run test:coverage`
- [x] 7.3 Обновить snapshots: `npm run test:update-snapshots`
- [x] 7.4 Провести визуальный review обновлённых snapshots
- [x] 7.5 Убедиться что coverage >= 80%

### Task 8: Code Review & Git Commit
- [x] 8.1 Провести self-review изменений
- [x] 8.2 Запустить линтер: `npm run lint`
- [ ] 8.3 Создать git commit с детальным changelog
- [ ] 8.4 Запросить code review у Frontend Lead

---

## Dev Notes

### Source Tree Structure

```
frontend/src/components/ui/
├── Badge/
│   ├── Badge.tsx              # AC 2 - Обновить варианты
│   └── __tests__/Badge.test.tsx
├── Button/
│   ├── Button.tsx             # AC 1 - Обновить варианты
│   ├── index.ts
│   └── __tests__/Button.test.tsx
├── Checkbox/
│   ├── Checkbox.tsx           # AC 3 - checked состояния
│   ├── index.ts
│   └── __tests__/Checkbox.test.tsx
├── Input/
│   ├── Input.tsx              # AC 6 - focus states
│   └── __tests__/Input.test.tsx
├── Tabs/
│   ├── Tabs.tsx               # AC 5 - active text color
│   └── __tests__/Tabs.test.tsx
├── Toast/
│   ├── Toast.tsx              # AC 7 - border colors
│   └── __tests__/Toast.test.tsx
├── Toggle/
│   ├── Toggle.tsx             # AC 4 - track ON color
│   └── __tests__/Toggle.test.tsx
└── Link/
    └── Link.tsx               # AC 8 - если существует

frontend/src/components/layout/
└── Header.tsx                 # AC 9 - cart badge
```

### Контекст миграции цветов

**Источники истины:**
- `docs/frontend/design-system.json` — токены дизайн-системы v2.1.0
- `frontend/src/app/globals.css` — CSS-переменные Tailwind 4.0
- `docs/frontend/color-scheme-migration.md` — план миграции

**Ключевые токены для использования:**

| Токен | HEX | Применение |
|-------|-----|------------|
| `primary` | `#0060FF` | CTA кнопки, активные элементы |
| `primary-hover` | `#0047CC` | Hover состояние |
| `primary-active` | `#0037A6` | Pressed состояние |
| `primary-subtle` | `#E7F3FF` | Мягкие подложки |
| `accent-success` | `#00AA5B` | Успешные статусы |
| `accent-warning` | `#F5A623` | Предупреждения |
| `accent-danger` | `#E53935` | Ошибки, sale |
| `accent-promo` | `#FF2E93` | Промо-бейджи |

### Coding Standards

**Когда использовать токены:**
- ✅ Все интерактивные элементы (кнопки, ссылки, чекбоксы)
- ✅ Семантические цвета (success, warning, danger, info)
- ✅ Focus и hover состояния
- ✅ Текстовые цвета в компонентах

**Когда допустим хардкод:**
- ⚠️ Фоновые цвета Badge вариантов (bg-[#E7F3FF]) — нет токенов в Tailwind
- ⚠️ Специфические оттенки без токена (discount: #7C3AED)

**Формат классов Tailwind:**
```tsx
// ✅ Правильно
className="bg-primary hover:bg-primary-hover text-white"

// ❌ Неправильно
className="bg-[#0060FF] hover:bg-[#0047CC] text-white"
```

### Testing

**Framework:** Jest + React Testing Library  
**Test Location:** `frontend/src/components/ui/[Component]/__tests__/[Component].test.tsx`  
**Coverage Requirement:** >= 80%

**Команды запуска:**
```bash
# Запуск всех тестов
npm test

# Запуск конкретного теста
npm test -- Button.test.tsx

# Проверка coverage
npm run test:coverage

# Обновление snapshots
npm run test:update-snapshots

# Watch mode для разработки
npm test -- --watch
```

**Что проверять в тестах:**
- Рендеринг всех вариантов компонента
- Применение правильных CSS классов
- Состояния hover/focus/active (если тестируемы)
- Snapshot соответствие

---

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

Нет критических проблем. Все тесты UI компонентов прошли успешно (433/433).

### Completion Notes List

- Успешно заменены все хардкод HEX цвета на Tailwind токены
- Обновлены тесты для соответствия новым токенам
- Link компонент отсутствует (AC 8 - N/A)
- Tabs уже использовал токены (AC 5 - verified)
- Все UI компоненты тесты проходят: 433 passed

### File List

**Изменённые компоненты:**

- frontend/src/components/ui/Button/Button.tsx
- frontend/src/components/ui/Button/\_\_tests\_\_/Button.test.tsx
- frontend/src/components/ui/Badge/Badge.tsx
- frontend/src/components/ui/Badge/\_\_tests\_\_/Badge.test.tsx
- frontend/src/components/ui/Checkbox/Checkbox.tsx
- frontend/src/components/ui/Checkbox/\_\_tests\_\_/Checkbox.test.tsx
- frontend/src/components/ui/Toggle/Toggle.tsx
- frontend/src/components/ui/Toggle/\_\_tests\_\_/Toggle.test.tsx
- frontend/src/components/ui/Input/Input.tsx
- frontend/src/components/ui/Toast/Toast.tsx
- frontend/src/components/layout/Header.tsx

---

## QA Results
<!-- Результаты QA проверки -->

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-25 | 1.0 | Initial creation | Sarah (PO) |
