# Quality Gate: Story 14.1 - Обновление дизайн-системы и CSS токенов
# Schema v1
schema: 1
story: "14.1"
story_title: "Обновление дизайн-системы и CSS токенов"
gate: CONCERNS
status_reason: >-
  AC5 и раздел Testing по-прежнему описывают host-level проверки и отсутствие тестов, что расходится
  с docker-first процессом и обязательным Vitest-сьютом для токенов.
reviewer: "Quinn (Test Architect)"
updated: "2025-11-26T06:00:00Z"

waiver:
  active: false

top_issues:
  - id: AC-14.1-001
    severity: medium
    finding: >-
      Acceptance Criteria 5 указывает команды node/npm для хостовой ОС и нарушает обязательный docker-compose
      процесс, поэтому QA не может следовать AC для проверок.
    suggested_action: >-
      Исправить AC5 и Validation: перечислить docker-compose команды из Task 4 и сделать их обязательными.
  - id: DOC-14.1-003
    severity: medium
    finding: >-
      Разделы Testing и DoD продолжают утверждать, что тесты не требуются, хотя Vitest-сьют по токенам
      уже обновлён и должен запускаться при приёмке.
    suggested_action: >-
      Обновить Testing/DoD, добавив обязательный запуск `docker compose ... frontend npm run test`/Vitest
      и ссылку на `frontend/src/__tests__/design-system/tokens.test.ts`.

quality_score: 70
expires: "2025-12-10T06:00:00Z"

evidence:
  tests_reviewed: 1
  tests_passed: 1
  tests_failed: 0
  risks_identified: 2
  trace:
    ac_covered: [1, 2, 3, 4]
    ac_gaps: [5]

nfr_validation:
  security:
    status: PASS
    notes: "Изменения ограничены токенами и документацией."
  performance:
    status: PASS
    notes: "CSS и JSON конфигурация не создаёт дополнительных нагрузок."
  reliability:
    status: CONCERNS
    notes: "Пока AC5 не приведён к docker-first процессу, проверки не воспроизводимы."
  maintainability:
    status: CONCERNS
    notes: "Testing/DoD не отражают обязательный Vitest-сьют."
  accessibility:
    status: PASS
    notes: "Новая палитра соответствует WCAG AA."

detailed_assessment:
  requirements_traceability:
    score: 8/10
    notes: >-
      AC1-AC4 покрыты и хорошо описаны, но AC5 нужно дополнить обязательным запуском тестов.
  documentation:
    score: 7/10
    notes: >-
      Большинство разделов синхронизировано, однако Testing всё ещё противоречит факту наличия Vitest.
  standards_compliance:
    score: 6/10
    notes: >-
      Требования CI (зелёные тесты) не выполняются, пока Vitest не обновлён.

risk_summary:
  totals:
    critical: 0
    high: 0
    medium: 2
    low: 0
  identified_risks:
    - id: RISK-14.1-A
      severity: medium
      category: validation
      description: "AC5 не отражает docker-compose процесс, что может привести к пропуску обязательных проверок."
      mitigation: "Сделать docker-команды частью Acceptance Criteria/DoD."
    - id: RISK-14.1-B
      severity: medium
      category: documentation
      description: "Testing/DoD не требуют запуск Vitest, возможен повторный регресс."
      mitigation: "Обновить разделы документации и зафиксировать обязательный Vitest."
  recommendations:
    must_fix:
      - "Обновить AC5 с docker-compose командами и ссылкой на Task 4."
      - "Переписать Testing/DoD, указав обязательный Vitest в Docker."

recommendations:
  immediate: []
  future:
    - action: "Подготовить automation-скрипт для dockerized Vitest + токен-валидации"
      refs: ["docs/stories/epic-14/14.1.design-system-tokens-update.story.md"]
      rationale: "Сократит ручные проверки при следующих миграциях."

highlights:
  - "design-system.json и globals.css доведены до версии 2.1.0"
  - "Docker-команды для JSON/CSS проверок задокументированы"
  - "Handoff к Story 14.2 включает список компонентов"

technical_details:
  files_modified: 2
  files_created: 0
  test_coverage:
    total_tests: 0
    passed: 0
    failed: 0

history:
  - at: "2025-11-25T19:25:00Z"
    gate: CONCERNS
    reviewer: "Quinn (Test Architect)"
    note: "Первичный QA review. Требуются уточнения по процессу и компонентам."
  - at: "2025-11-25T19:40:00Z"
    gate: FAIL
    reviewer: "Quinn (Test Architect)"
    note: "Vitest остаётся на версии 2.0 токенов и падает до обновления тестов."
  - at: "2025-11-26T06:00:00Z"
    gate: CONCERNS
    reviewer: "Quinn (Test Architect)"
    note: "Токены и Vitest синхронизированы, но AC5/Testing ещё не отражают docker-first процесс."
