# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:
```
FileNotFoundError: –§–∞–π–ª –æ—Å—Ç–∞—Ç–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω: /app/data/import_1c/rests/rests.xml
```

## –ü—Ä–∏—á–∏–Ω–∞

–í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/app/data/import_1c/rests/` –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Ñ–∞–π–ª—ã —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º `rests_1_*.xml`:
- `rests_1_1_bf987153-7db9-4af6-818e-07f3f1b97bc8.xml`
- `rests_1_2_90725d2f-8e88-49f1-bd46-666d3beb05d2.xml`
- `rests_1_3_bbfef6e3-a9e4-482a-ace3-5095192524c9.xml`
- –∏ —Ç.–¥.

–ö–æ–¥ –≤ `tasks.py` –∏—Å–∫–∞–ª –æ–¥–∏–Ω —Ñ–∞–π–ª `rests.xml`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

## –†–µ—à–µ–Ω–∏–µ

–ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ –≤ `backend/apps/integrations/tasks.py`:

### –ë—ã–ª–æ:
```python
elif import_type == "stocks":
    file_path = data_path / "rests" / "rests.xml"
    if not file_path.exists():
        raise FileNotFoundError(...)
    
    call_command("load_product_stocks", "--file", str(file_path))
```

### –°—Ç–∞–ª–æ:
```python
elif import_type == "stocks":
    rests_dir = data_path / "rests"
    if not rests_dir.exists():
        raise FileNotFoundError(...)
    
    call_command(
        "import_catalog_from_1c",
        "--data-dir", str(data_dir),
        "--file-type", "rests",
    )
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

‚úÖ **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã** - –∫–æ–º–∞–Ω–¥–∞ `import_catalog_from_1c` —Å `--file-type=rests` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã `rests*.xml`  
‚úÖ **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∞ –∂–µ –∫–æ–º–∞–Ω–¥–∞, —á—Ç–æ –∏ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –∏ —Ü–µ–Ω  
‚úÖ **–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞  
‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–º–ø–æ—Ä—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:8001/admin/integrations/integrationimportsession/`
2. –ù–∞–∂–º–∏—Ç–µ "üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç –∏–∑ 1–°"
3. –í—ã–±–µ—Ä–∏—Ç–µ **–¢–û–õ–¨–ö–û "–û—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤"**
4. –ù–∞–∂–º–∏—Ç–µ "‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç"

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Celery

```powershell
docker-compose -f docker/docker-compose.yml logs -f celery
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
[Task <task_id>] –ó–∞–ø—É—Å–∫ –≤—ã–±–æ—Ä–æ—á–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞: ['stocks']
[Task <task_id>] –ù–∞—á–∞–ª–æ –∏–º–ø–æ—Ä—Ç–∞: stocks
[Task <task_id>] –ó–∞–ø—É—Å–∫ import_catalog_from_1c --file-type=rests
üìä –®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏–∑ rests.xml...
   –û–±—Ä–∞–±–æ—Ç–∫–∞ rests_1_1_*.xml: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 1234/1234
   –û–±—Ä–∞–±–æ—Ç–∫–∞ rests_1_2_*.xml: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 1234/1234
   ...
[Task <task_id>] –ò–º–ø–æ—Ä—Ç stocks –∑–∞–≤–µ—Ä—à–µ–Ω: –û—Å—Ç–∞—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ò–º–ø–æ—Ä—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ –±–µ–∑ –æ—à–∏–±–∫–∏ `FileNotFoundError`.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö 1–°

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `data/import_1c/rests/` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç XML —Ñ–∞–π–ª—ã:

```
data/import_1c/rests/
‚îú‚îÄ‚îÄ rests_1_1_<uuid>.xml
‚îú‚îÄ‚îÄ rests_1_2_<uuid>.xml
‚îú‚îÄ‚îÄ rests_1_3_<uuid>.xml
‚îú‚îÄ‚îÄ rests_1_4_<uuid>.xml
‚îî‚îÄ‚îÄ rests_1_5_<uuid>.xml
```

–ö–æ–º–∞–Ω–¥–∞ `import_catalog_from_1c` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π–¥–µ—Ç –∏ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ —ç—Ç–∏ —Ñ–∞–π–ª—ã.

## –î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω

### –õ–æ–∫–∞–ª—å–Ω–æ

```powershell
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Celery worker
docker-compose -f docker/docker-compose.yml restart celery
```

### –ü—Ä–æ–¥–∞–∫—à–Ω

```bash
ssh root@5.35.124.149
cd /root/freesport

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Celery worker
docker-compose -f docker/docker-compose.prod.yml restart celery
```

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. ‚úÖ `backend/apps/integrations/tasks.py` - –∏–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

- `import_catalog_from_1c --file-type=rests` - –∏–º–ø–æ—Ä—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–ø–µ—Ä—å)
- `load_product_stocks --file <path>` - –∏–º–ø–æ—Ä—Ç –∏–∑ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (—É—Å—Ç–∞—Ä–µ–ª–æ –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª—É—á–∞—è)

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É:
- **Developer:** James (Dev Agent)
- **Fix:** –ò–º–ø–æ—Ä—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- **Date:** 2025-11-04
