# Story 3.1.3: test-catalog-loading

## Status
Ready for Development

## Story
**As a** Product Owner,
**I want** загрузить полный каталог товаров с корректными ценами,
**so that** фронтенд может отображать актуальные данные для всех типов пользователей.

## Acceptance Criteria

1. Загружено ≥500 товаров с полными данными
2. Установлены цены для всех 7 ролей пользователей
3. Созданы ≥50 категорий с корректной иерархией
4. Добавлено ≥20 брендов товаров
5. Заполнены технические характеристики в JSONB
6. Настроен fallback к retail_price
7. Проверена корректность связей между сущностями

### Детальные задачи:

- [ ] Подготовить тестовые данные товаров (AC: 1)
  - [ ] Создать каталог ≥500 товаров спортивной тематики
  - [ ] Включить товары разных типов: одежда, обувь, инвентарь
  - [ ] Добавить полные описания товаров
  - [ ] Подготовить изображения товаров (заглушки)

- [ ] Настроить ролевое ценообразование (AC: 2)
  - [ ] **retail_price** - розничная цена для обычных покупателей
  - [ ] **opt1_price** - оптовая цена уровень 1 (скидка 5-10%)
  - [ ] **opt2_price** - оптовая цена уровень 2 (скидка 10-15%)
  - [ ] **opt3_price** - оптовая цена уровень 3 (скидка 15-20%)
  - [ ] **trainer_price** - специальная цена для тренеров (скидка 20-25%)
  - [ ] **federation_price** - цена для спортивных федераций (скидка 25-30%)
  - [ ] **admin_price** - административная цена (себестоимость)

- [ ] Создать иерархию категорий (AC: 3)
  - [ ] Создать основные категории: "Одежда", "Обувь", "Инвентарь"
  - [ ] Добавить подкатегории: "Футбольная обувь", "Теннисные ракетки"
  - [ ] Создать специализированные категории: "Женская", "Мужская", "Детская"
  - [ ] Настроить правильную иерархию parent-child связей

- [ ] Добавить бренды товаров (AC: 4)
  - [ ] Создать популярные спортивные бренды: Nike, Adidas, Puma
  - [ ] Добавить специализированные бренды: Wilson, Head, Spalding
  - [ ] Настроить логотипы брендов (заглушки)
  - [ ] Связать товары с соответствующими брендами

- [ ] Заполнить технические характеристики (AC: 5)
  - [ ] Использовать JSONB поле `specifications` в Product
  - [ ] Добавить размеры, цвета, материалы
  - [ ] Создать специфичные характеристики для типов товаров
  - [ ] Валидировать структуру specifications

- [ ] Настроить fallback ценообразование (AC: 6)
  - [ ] Реализовать логику fallback к retail_price
  - [ ] Обработать случаи отсутствия специальных цен
  - [ ] Протестировать для всех 7 ролей
  - [ ] Добавить логирование fallback операций

- [ ] Проверить целостность данных (AC: 7)
  - [ ] Валидировать все связи Product ↔ Category
  - [ ] Проверить связи Product ↔ Brand
  - [ ] Убедиться в корректности иерархии категорий
  - [ ] Проверить уникальность onec_id для всех товаров

## Definition of Done
- [ ] API `/products/` возвращает корректные данные для всех ролей
- [ ] Каталог отображается в админке Django
- [ ] Все товары имеют цены и доступны для заказа
- [ ] Фронтенд может отображать каталог без ошибок
- [ ] Проведены smoke тесты интеграции

## Dev Notes

### Story Context
**Data Volume Requirements:**
- Минимум 500 товаров для реалистичного тестирования
- 50+ категорий для проверки иерархии и навигации
- 20+ брендов для тестирования фильтрации
- Все 7 ролей должны получать корректные цены

### Ролевое ценообразование
```python
# Пример структуры цен в БД
product = {
    'name': 'Nike Air Max',
    'retail_price': 15000.00,      # Розница
    'opt1_price': 13500.00,        # Опт 1 (-10%)
    'opt2_price': 12750.00,        # Опт 2 (-15%)
    'opt3_price': 12000.00,        # Опт 3 (-20%)
    'trainer_price': 11250.00,     # Тренеры (-25%)
    'federation_price': 10500.00,  # Федерации (-30%)
    'admin_price': 9000.00,        # Админ (себестоимость)
}
```

### Sample Data Structure
```json
{
  "specifications": {
    "size": ["40", "41", "42", "43", "44"],
    "color": ["black", "white", "red"],
    "material": "synthetic leather",
    "weight": "350g",
    "sport": "football"
  }
}
```

### API Testing
```bash
# Тестирование API для разных ролей
curl -H "Authorization: Bearer <retail_token>" /api/products/1/
curl -H "Authorization: Bearer <trainer_token>" /api/products/1/
curl -H "Authorization: Bearer <federation_token>" /api/products/1/
```

### Dependencies
- **Depends on:** Story 3.1.1, 3.1.2 (import infrastructure)
- **Blocks:** Frontend integration, Story 3.1.4 (stocks)
- **Related:** User role management, pricing logic

## Story Points
**3** (Low complexity, mostly data preparation)

## Priority
**High** - Критично для начала frontend разработки

## Labels
`epic-3` `test-data` `catalog` `role-pricing` `frontend-ready`