# Story 10.2: UI Kit Implementation

## Status
Ready

## Story
**As a** frontend developer,  
**I want** a complete set of reusable UI components based on the design system,  
**so that** I can build consistent and accessible user interfaces efficiently.

## Acceptance Criteria
1. Все компоненты реализованы согласно спецификации в `design-system.json`
2. Компоненты используют Tailwind CSS с токенами дизайн-системы
3. Unit-тесты покрывают 80%+ кода компонентов
4. Компоненты адаптивны (mobile/tablet/desktop)
5. Соблюдены стандарты accessibility (WCAG 2.1 AA)

## Tasks / Subtasks

- [ ] **Task 1: Создать глобальный layout.tsx с провайдерами** (AC: 1, 4)
  - [ ] Создать `src/app/layout.tsx` с базовой структурой
  - [ ] Настроить Tailwind CSS с токенами из `design-system.json`
  - [ ] Добавить провайдеры для темы и состояния
  - [ ] Настроить шрифты (Inter, SF Pro Display)
  - [ ] Добавить meta теги для SEO и responsive

- [ ] **Task 2: Реализовать базовые UI компоненты** (AC: 1, 2, 5)
  - [ ] Button (primary, secondary, tertiary, subtle варианты)
  - [ ] Input с поддержкой label, helper, error/success состояний
  - [ ] Select с нативным select и стилизованной стрелкой
  - [ ] SearchField для поиска с иконкой
  - [ ] Checkbox с анимацией и иконкой Check
  - [ ] Toggle (Switch) с плавным движением бегунка

- [ ] **Task 3: Реализовать компоненты для контента** (AC: 1, 2, 5)
  - [ ] Modal с backdrop blur и кнопкой закрытия
  - [ ] Card с hover эффектами
  - [ ] Badge (все варианты: delivered, transit, cancelled, promo, sale, etc.)
  - [ ] Tag (default, highlight, success, warning, danger)
  - [ ] Chip с иконкой и кнопкой удаления

- [ ] **Task 4: Реализовать навигационные компоненты** (AC: 1, 2, 5)
  - [ ] Breadcrumb с ChevronRight разделителем
  - [ ] Tabs с underline индикатором
  - [ ] Spinner для загрузки

- [ ] **Task 5: Реализовать информационные панели** (AC: 1, 2, 5)
  - [ ] InfoPanel с иконкой и текстом
  - [ ] SupportPanel (delivery и availability варианты)

- [ ] **Task 6: Написать unit-тесты для всех компонентов** (AC: 3)
  - [ ] Тесты для Button (все варианты, размеры, состояния)
  - [ ] Тесты для Input (валидация, error/success, conflicting states, disabled)
  - [ ] Тесты для Select, SearchField (пустой результат, длинный список опций)
  - [ ] Тесты для Checkbox, Toggle (indeterminate state, disabled, prefers-reduced-motion)
  - [ ] Тесты для Modal (focus trap, ESC/backdrop close, overflow, nested warning)
  - [ ] Тесты для Card, Badge, Tag, Chip (text overflow, ellipsis)
  - [ ] Тесты для Breadcrumb (длинная цепочка, ellipsis), Tabs (keyboard nav, overflow)
  - [ ] Тесты для Spinner (размеры, ARIA, prefers-reduced-motion)
  - [ ] Тесты для InfoPanel, SupportPanel (dismissible, длинный текст)
  - [ ] Тесты для edge cases из раздела "Edge Cases and Error Handling"
  - [ ] Проверить покрытие кода (должно быть 80%+)

- [ ] **Task 7: Проверить адаптивность и accessibility** (AC: 4, 5)
  - [ ] Протестировать все компоненты на mobile/tablet/desktop
  - [ ] Проверить keyboard navigation
  - [ ] Проверить screen reader support (aria-labels)
  - [ ] Проверить color contrast (WCAG 2.1 AA)
  - [ ] Запустить ESLint с `jsx-a11y` плагином

## Dev Notes

### Previous Story Insights
Story 10.1 настроила окружение разработки с ESLint, Prettier и Docker. Все инструменты готовы для разработки UI Kit.

### Design System Reference
[Source: frontend/docs/design-system.json]

**Основные токены дизайн-системы:**

**Colors:**
```javascript
primary: {
  default: '#1F1F1F',
  hover: '#3A3A3A',
  active: '#0D0D0D',
  subtle: '#F2F2F2'
}

neutral: {
  100: '#FFFFFF',
  200: '#F5F5F5',
  300: '#E0E0E0',
  400: '#C7C7C7',
  500: '#A3A3A3',
  600: '#7D7D7D',
  700: '#5E5E5E',
  800: '#3F3F3F',
  900: '#1F1F1F'
}

text: {
  primary: '#1B1B1B',
  secondary: '#4D4D4D',
  muted: '#7A7A7A',
  inverse: '#FFFFFF'
}
```

**Typography:**
```javascript
fontFamily: ['Inter', 'SF Pro Display', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'sans-serif']

scales: {
  'display-l': { size: 48, lineHeight: 56, weight: 700 },
  'display-m': { size: 40, lineHeight: 48, weight: 700 },
  'headline-l': { size: 32, lineHeight: 40, weight: 700 },
  'headline-m': { size: 28, lineHeight: 36, weight: 600 },
  'title-l': { size: 24, lineHeight: 32, weight: 600 },
  'title-m': { size: 20, lineHeight: 28, weight: 600 },
  'body-l': { size: 18, lineHeight: 28, weight: 500 },
  'body-m': { size: 16, lineHeight: 24, weight: 500 },
  'body-s': { size: 14, lineHeight: 20, weight: 500 },
  'caption': { size: 12, lineHeight: 16, weight: 500 }
}
```

**Spacing:**
```javascript
scale: [4, 8, 12, 16, 20, 24, 32, 40, 48, 56, 64]
```

**Radius:**
```javascript
sm: 6,
default: 12,
md: 16,
lg: 20,
xl: 24,
full: 9999
```

**Shadows:**
```javascript
default: '0 8px 24px rgba(15, 23, 42, 0.08)',
hover: '0 10px 32px rgba(15, 23, 42, 0.12)',
modal: '0 24px 64px rgba(15, 23, 42, 0.24)'
```

### Component Specifications

#### Button Component
[Source: frontend/docs/design-system.json#components.Button]

**Variants:**
- `primary`: bg-primary, text-inverse, shadow primary
- `secondary`: bg-neutral-100, border primary, text primary
- `tertiary`: transparent bg, text primary
- `subtle`: bg #E7F3FF, soft shadow

**Sizes:**
- `small`: h-10, text body-s
- `medium`: h-10, text body-m
- `large`: h-12, text body-l

**Interaction:**
- hover: color shift + translateY(-2px)
- focus: ring 2px primary
- disabled: opacity-50

**Props:**
```typescript
interface ButtonProps {
  variant?: 'primary' | 'secondary' | 'tertiary' | 'subtle';
  size?: 'small' | 'medium' | 'large';
  disabled?: boolean;
  onClick?: () => void;
  children: React.ReactNode;
}
```

#### Input Component
[Source: frontend/docs/design-system.json#components.Input]

**States:**
- default: border-neutral-400
- error: border-accent-danger, bg danger with opacity 8
- success: border-accent-success

**Props:**
```typescript
interface InputProps {
  label: string;
  helper?: string;
  error?: string;
  success?: string;
  icon?: React.ReactNode;
  type?: 'text' | 'email' | 'password' | 'number';
  value: string;
  onChange: (value: string) => void;
}
```

**Dimensions:**
- height: 40px
- radius: 4px
- border: 1px solid #D0D7E6

#### Modal Component
[Source: frontend/docs/design-system.json#components.Modal]

**Structure:**
- Header с title и кнопкой закрытия
- Content area
- Optional footer

**Props:**
```typescript
interface ModalProps {
  isOpen: boolean;
  onClose: () => void;
  title: string;
  children: React.ReactNode;
  footer?: React.ReactNode;
}
```

**Dimensions:**
- radius: 24px
- maxWidth: 560px
- closeIcon container: size 44px, radius 12px, hover bg #E3E8F2

#### Badge Component
[Source: frontend/docs/design-system.json#components.Badge]

**Variants:**
- delivered: bg #E0F5E0, text #1F7A1F, icon check-circle
- transit: bg #FFF1CC, text #B07600, icon truck
- cancelled: bg #FFE1E1, text #C23B3B, icon x
- promo: bg #F4EBDC, text #8C4C00
- sale: bg #F9E1E1, text #A63232
- discount: bg #F4E9FF, text #5E32A1
- premium: bg #F6F0E4, text #6D4C1F, icon sparkles
- new: bg #E1F0FF, text #0F5DA3
- hit: bg #E3F6EC, text #1F7A4A

**Props:**
```typescript
interface BadgeProps {
  variant: 'delivered' | 'transit' | 'cancelled' | 'promo' | 'sale' | 'discount' | 'premium' | 'new' | 'hit';
  children: React.ReactNode;
}
```

### Edge Cases and Error Handling

Этот раздел определяет поведение компонентов в нестандартных ситуациях для обеспечения консистентности реализации.

#### Input Component Edge Cases

**Конфликтующие состояния:**
- Если переданы одновременно `error` и `success` props - приоритет у `error`
- Пример: `<Input error="Invalid" success="Valid" />` → отображается error состояние

**Длинный текст:**
- Label длиннее 50 символов: переносится на новую строку с сохранением отступов
- Helper/error текст длиннее 100 символов: переносится на несколько строк
- Placeholder длиннее ширины поля: обрезается с ellipsis (...)

**Валидация и фокус:**
- Пустое обязательное поле показывает error state только после события `blur`
- При программном `focus()` на Input с ошибкой - border становится красным
- При `disabled={true}` все состояния (error/success) визуально приглушены (opacity-50)

**Иконки:**
- Если передан `icon` prop и одновременно `error` - отображаются оба (icon слева, error icon справа)
- Максимальный размер иконки: 20px

#### Select Component Edge Cases

**Длинный список опций:**
- Если опций больше 10 - добавляется внутренний скролл с максимальной высотой dropdown 320px
- Текст опции длиннее ширины dropdown - обрезается с ellipsis

**Поиск (для SearchField):**
- Пустой результат поиска: отображается текст "Ничего не найдено" (text-muted)
- Минимальная длина поискового запроса: 2 символа (иначе показывать placeholder "Введите минимум 2 символа")

#### Checkbox и Toggle Edge Cases

**Состояния:**
- `indeterminate` state для Checkbox (используется для "select all" сценариев)
- Toggle с `disabled={true}`: бегунок не двигается, opacity-50, cursor-not-allowed

**Анимации:**
- При `prefers-reduced-motion` - убрать все transition эффекты
- Checkbox check анимация: максимум 150ms
- Toggle slide анимация: максимум 200ms

#### Modal Component Edge Cases

**Вложенные модалы:**
- НЕ поддерживаются - при попытке открыть второй Modal выводить `console.warn()`:
  - "Nested modals are not supported. Close the current modal before opening a new one."
- Не блокировать рендеринг, но визуально второй modal не отображается

**Управление фокусом:**
- При открытии Modal: фокус перемещается на первый интерактивный элемент внутри
- При закрытии Modal (кнопка X, ESC, клик на backdrop): фокус возвращается на элемент, вызвавший Modal
- Фокус "заперт" внутри Modal - Tab/Shift+Tab циклически перемещаются только по элементам внутри

**Overflow контента:**
- Если контент Modal превышает 80vh:
  - Header и footer остаются фиксированными
  - Content area получает внутренний скролл
  - Визуальная подсказка скролла: легкая тень сверху/снизу content area

**Закрытие:**
- ESC key: закрывает Modal
- Клик на backdrop (затемненная область): закрывает Modal
- Клик внутри content area: НЕ закрывает Modal

#### Badge, Tag, Chip Edge Cases

**Переполнение текста:**
- Текст длиннее 200px: обрезается с ellipsis (...)
- Line breaks (переносы строк) НЕ поддерживаются - все компоненты single-line
- При необходимости длинного текста использовать Tooltip

**Chip с кнопкой удаления:**
- Если `onRemove` prop не передан - кнопка удаления не отображается
- Минимальная ширина Chip (даже с короткой меткой): 60px для удобного клика

**Иконки в Badge:**
- Размер иконки: 16px (фиксированный)
- Если иконка не загружается (lucide-react недоступен): отображается только текст без ошибки

#### Breadcrumb Component Edge Cases

**Длинная цепочка:**
- Если элементов больше 5: показывать первый, последний и "..." для промежуточных
- Пример: Home > ... > Category > Subcategory > Product
- При наведении на "..." - показывать Tooltip с полным путем

**Длинный текст элемента:**
- Текст элемента длиннее 150px: обрезается с ellipsis
- При наведении - показывать полный текст в Tooltip

#### Tabs Component Edge Cases

**Keyboard navigation:**
- Arrow Left/Right: переключение между табами
- Home/End: первый/последний таб
- Enter/Space: активировать таб

**Overflow табов:**
- Если табов больше, чем умещается по ширине: горизонтальный скролл
- Активный таб автоматически прокручивается в видимую область

**Disabled состояние:**
- Tab с `disabled={true}`: opacity-50, cursor-not-allowed, не реагирует на клики и keyboard navigation

#### Spinner Component Edge Cases

**Размеры:**
- По умолчанию: 24px
- Доступные размеры: `small` (16px), `medium` (24px), `large` (32px)

**Accessibility:**
- ARIA атрибуты: `role="status"`, `aria-live="polite"`, `aria-label="Loading"`
- При `prefers-reduced-motion`: статичная иконка вместо вращающегося Spinner

#### InfoPanel и SupportPanel Edge Cases

**Длинный текст:**
- Текст автоматически переносится на несколько строк
- Максимальная ширина панели: 100% контейнера

**Иконки:**
- Если иконка не указана: используется иконка по умолчанию (Info для InfoPanel)
- Размер иконки: 20px, цвет зависит от варианта панели

**Закрытие (dismissible):**
- Если передан `onDismiss` prop: показывается кнопка закрытия (X)
- При закрытии: панель исчезает с fade-out анимацией 200ms

### Project Structure
[Source: architecture/source-tree.md#frontend]

```
frontend/src/
├── app/
│   └── layout.tsx              # Глобальный layout (создать)
├── components/
│   └── ui/                     # UI Kit компоненты (создать)
│       ├── Button/
│       │   ├── Button.tsx
│       │   └── __tests__/
│       │       └── Button.test.tsx
│       ├── Input/
│       │   ├── Input.tsx
│       │   └── __tests__/
│       │       └── Input.test.tsx
│       ├── Select/
│       ├── SearchField/
│       ├── Checkbox/
│       ├── Toggle/
│       ├── Modal/
│       ├── Card/
│       ├── Badge/
│       ├── Tag/
│       ├── Chip/
│       ├── Breadcrumb/
│       ├── Tabs/
│       ├── Spinner/
│       ├── InfoPanel/
│       └── SupportPanel/
└── utils/
    └── cn.ts                   # Utility для условных классов (создать)
```

### Tailwind CSS Configuration
[Source: architecture/coding-standards.md#tailwind-css]

**Настройка токенов в `tailwind.config.js`:**

```javascript
module.exports = {
  theme: {
    extend: {
      colors: {
        primary: {
          DEFAULT: '#1F1F1F',
          hover: '#3A3A3A',
          active: '#0D0D0D',
          subtle: '#F2F2F2',
        },
        neutral: {
          100: '#FFFFFF',
          200: '#F5F5F5',
          300: '#E0E0E0',
          400: '#C7C7C7',
          500: '#A3A3A3',
          600: '#7D7D7D',
          700: '#5E5E5E',
          800: '#3F3F3F',
          900: '#1F1F1F',
        },
        text: {
          primary: '#1B1B1B',
          secondary: '#4D4D4D',
          muted: '#7A7A7A',
          inverse: '#FFFFFF',
        },
      },
      fontFamily: {
        sans: ['Inter', 'SF Pro Display', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'sans-serif'],
      },
      fontSize: {
        'display-l': ['48px', { lineHeight: '56px', fontWeight: '700' }],
        'display-m': ['40px', { lineHeight: '48px', fontWeight: '700' }],
        'headline-l': ['32px', { lineHeight: '40px', fontWeight: '700' }],
        'headline-m': ['28px', { lineHeight: '36px', fontWeight: '600' }],
        'title-l': ['24px', { lineHeight: '32px', fontWeight: '600' }],
        'title-m': ['20px', { lineHeight: '28px', fontWeight: '600' }],
        'body-l': ['18px', { lineHeight: '28px', fontWeight: '500' }],
        'body-m': ['16px', { lineHeight: '24px', fontWeight: '500' }],
        'body-s': ['14px', { lineHeight: '20px', fontWeight: '500' }],
        'caption': ['12px', { lineHeight: '16px', fontWeight: '500' }],
      },
      spacing: {
        '4': '4px',
        '8': '8px',
        '12': '12px',
        '16': '16px',
        '20': '20px',
        '24': '24px',
        '32': '32px',
        '40': '40px',
        '48': '48px',
        '56': '56px',
        '64': '64px',
      },
      borderRadius: {
        'sm': '6px',
        'DEFAULT': '12px',
        'md': '16px',
        'lg': '20px',
        'xl': '24px',
        'full': '9999px',
      },
      boxShadow: {
        'default': '0 8px 24px rgba(15, 23, 42, 0.08)',
        'hover': '0 10px 32px rgba(15, 23, 42, 0.12)',
        'modal': '0 24px 64px rgba(15, 23, 42, 0.24)',
      },
    },
  },
}
```

### Utility Function for Conditional Classes
[Source: architecture/coding-standards.md#tailwind-css]

**Создать `src/utils/cn.ts`:**

```typescript
import { clsx, type ClassValue } from 'clsx';
import { twMerge } from 'tailwind-merge';

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
```

**Установить зависимости:**
```bash
npm install clsx tailwind-merge
```

### Accessibility Requirements
[Source: frontend/docs/design-system.json#accessibility]

**Контраст:**
- Основной текст text-primary на светлом фоне: контраст > 4.5:1

**Focus:**
- Все интерактивные элементы: focus:ring 2px primary

**Keyboard:**
- Modal: ловить фокус внутри, ESC закрывает
- Tabs: переключение стрелками

**ARIA:**
- aria-label для кнопок без текста
- aria-expanded для Toggle
- role=tablist/tab для Tabs

**Motion Reduction:**
- При prefers-reduced-motion отключать анимации

### Icons
[Source: frontend/docs/design-system.json#iconography]

**Icon Library:** lucide-react

**Установка:**
```bash
npm install lucide-react
```

**Использование:**
```typescript
import { Check, ChevronRight, X, Truck } from 'lucide-react';

// В компоненте
<Check size={20} />
```

**Размеры:**
- Primary: 24px
- Secondary: 20px
- Color: #4B5C7A (default), #FFFFFF (inverse)

### Testing

#### Testing Standards
[Source: frontend/docs/testing-standards.md#unit-tests]

**Unit тесты для компонентов:**

```typescript
// src/components/ui/Button/__tests__/Button.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { Button } from '../Button';

describe('Button Component', () => {
  test('renders button with text', () => {
    render(<Button>Click me</Button>);
    expect(screen.getByRole('button', { name: /click me/i })).toBeInTheDocument();
  });

  test('calls onClick handler when clicked', () => {
    const handleClick = jest.fn();
    render(<Button onClick={handleClick}>Click me</Button>);
    
    fireEvent.click(screen.getByRole('button'));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });

  test('applies primary variant styles', () => {
    render(<Button variant="primary">Primary</Button>);
    const button = screen.getByRole('button');
    expect(button).toHaveClass('bg-primary');
  });

  test('is disabled when disabled prop is true', () => {
    render(<Button disabled>Disabled</Button>);
    const button = screen.getByRole('button');
    expect(button).toBeDisabled();
    expect(button).toHaveClass('opacity-50');
  });
});
```

**Покрытие кода:**
- Branches: 80%+
- Functions: 80%+
- Lines: 80%+
- Statements: 80%+

**Команды:**
```bash
npm test                    # Запуск всех тестов
npm run test:watch          # Watch режим
npm run test:coverage       # С покрытием
```

#### Test File Locations
[Source: frontend/docs/testing-standards.md#structure]

```
frontend/src/components/ui/
├── Button/
│   ├── Button.tsx
│   └── __tests__/
│       └── Button.test.tsx
├── Input/
│   ├── Input.tsx
│   └── __tests__/
│       └── Input.test.tsx
└── [другие компоненты]
```

### Technical Constraints
[Source: architecture/tech-stack.md#frontend-technologies]

**Версии:**
- React 19.1.0
- Next.js 15.4.6
- TypeScript 5.0+
- Tailwind CSS 4.0
- lucide-react (latest)

**Требования:**
- Все компоненты должны быть TypeScript
- Использовать React.FC для типизации компонентов
- Экспортировать компоненты через named exports
- Использовать Tailwind CSS классы (не inline styles)

### File Naming Conventions
[Source: architecture/coding-standards.md#frontend]

**Компоненты:**
- PascalCase для файлов: `Button.tsx`, `Input.tsx`
- PascalCase для компонентов: `export const Button: React.FC<ButtonProps>`

**Тесты:**
- `ComponentName.test.tsx`
- Размещать в `__tests__/` папке рядом с компонентом

**Утилиты:**
- camelCase для файлов: `cn.ts`, `formatDate.ts`

## Change Log
| Date       | Version | Description                          | Author        |
|------------|---------|--------------------------------------|---------------|
| 2025-11-15 | 1.0     | Initial story creation               | Bob (SM)      |
| 2025-11-16 | 1.1     | Added Edge Cases and Error Handling section, updated Task 6 with edge case tests | Bob (SM)      |

## Dev Agent Record
_This section will be populated by the development agent during implementation._

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes List
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

## QA Results
_This section will be populated by QA Agent after story completion._
