# Story 26.3: Cart Summary & Checkout CTA

## Status

Ready for Review

## Story

**–ö–∞–∫** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å,  
**–Ø —Ö–æ—á—É** –≤–∏–¥–µ—Ç—å –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É –∑–∞–∫–∞–∑–∞ –∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é,  
**–ß—Ç–æ–±—ã** –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø–æ–∫—É–ø–∫—É.

## Dependencies

> [!NOTE]
> **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
>
> - [Story 26.1: CartPageLayout](26.1.cart-page-layout.md#relevant-source-tree): Cart Page Layout
> - [Story 26.2: CartItemCard](26.2.cart-item-card.md#cartitemcard-layout): Cart Item Card
> - [Story 26.4: PromoCodeIntegration](26.4.promo-code-integration.md#cartstore-promo-state-example): Promo Code (–ø–ª–∞—Ü–µ—Ö–æ–ª–¥–µ—Ä –≤ —ç—Ç–æ–π —Å—Ç–æ—Ä–∏)

## Acceptance Criteria

1. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ "–ò—Ç–æ–≥–∏ –∑–∞–∫–∞–∑–∞"
2. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è "–¢–æ–≤–∞—Ä—ã –Ω–∞ —Å—É–º–º—É" —Å –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é —Ç–æ–≤–∞—Ä–æ–≤ (`totalPrice` –∏–∑ cartStore)
3. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è "–°–∫–∏–¥–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É" (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω—ë–Ω –ø—Ä–æ–º–æ–∫–æ–¥) ‚Äî **placeholder –¥–ª—è Story 26.4**
4. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è "–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ" —Å —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—É–º–º–æ–π
5. –ü–æ–ª–µ –≤–≤–æ–¥–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ —Å –∫–Ω–æ–ø–∫–æ–π "–ü—Ä–∏–º–µ–Ω–∏—Ç—å" (placeholder –¥–ª—è Story 26.4)
6. –ö–Ω–æ–ø–∫–∞ "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑" (primary, height: 56px)
7. –ö–Ω–æ–ø–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞ –µ—Å–ª–∏ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞ (`items.length === 0`)
8. Sticky –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ desktop (top: 96px)
9. –ù–∞ mobile –±–ª–æ–∫ –Ω–µ sticky, —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –ø–æ–¥ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤
10. Hydration: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å Zustand persist (–ø–∞—Ç—Ç–µ—Ä–Ω `mounted`)
11. Accessibility: `aria-live="polite"` –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Å—É–º–º

## Tasks / Subtasks

- [x] –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç CartSummary (AC: 1-7, 10-11)
  - [x] –°–æ–∑–¥–∞—Ç—å `frontend/src/components/cart/CartSummary.tsx`
  - [x] –î–æ–±–∞–≤–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–∏–≤—É `'use client'`
  - [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cartStore –Ω–∞–ø—Ä—è–º—É—é: `items`, `totalPrice`, `totalItems`
  - [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ hydration: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω `mounted` state
  - [x] Layout: white card —Å shadow
  - [x] –ó–∞–≥–æ–ª–æ–≤–æ–∫ "–ò—Ç–æ–≥–∏ –∑–∞–∫–∞–∑–∞" (title-m)
  - [x] –î–æ–±–∞–≤–∏—Ç—å `aria-live="polite"` –¥–ª—è –±–ª–æ–∫–∞ —Å —Å—É–º–º–∞–º–∏
  - [x] –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –≤ `frontend/src/components/cart/index.ts` (barrel export)

- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Price Summary (AC: 2-4)
  - [x] –°—Ç—Ä–æ–∫–∞ "–¢–æ–≤–∞—Ä—ã –Ω–∞ —Å—É–º–º—É" + `totalPrice` (–∏–∑ cartStore)
  - [x] –°—Ç—Ä–æ–∫–∞ "–°–∫–∏–¥–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É" ‚Äî **placeholder, —Å–∫—Ä—ã—Ç–∞ –¥–æ Story 26.4**
  - [x] –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å (divider)
  - [x] –°—Ç—Ä–æ–∫–∞ "–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ" (headline-m, bold) ‚Äî —Ä–∞–≤–Ω–∞ `totalPrice` (–±–µ–∑ —Å–∫–∏–¥–∫–∏ –¥–æ 26.4)
  - [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `formatPrice` –∏–∑ `@/utils/pricing`

- [x] –î–æ–±–∞–≤–∏—Ç—å Promo Code Placeholder (AC: 5)
  - [x] –°–æ–∑–¥–∞—Ç—å `frontend/src/components/cart/PromoCodeInput.tsx`
  - [x] –î–æ–±–∞–≤–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–∏–≤—É `'use client'`
  - [x] Input + Button –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–∞ (UI –≥–æ—Ç–æ–≤)
  - [x] –õ–æ–≥–∏–∫–∞ ‚Äî **stub/TODO** –¥–æ Story 26.4
  - [x] –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –≤ `frontend/src/components/cart/index.ts`

- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Checkout CTA (AC: 6-7)
  - [x] –ö–Ω–æ–ø–∫–∞ "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑" primary large (height: 56px)
  - [x] ‚ö†Ô∏è **–í–ê–ñ–ù–û**: `<Link>` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `disabled` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥:
    - –ï—Å–ª–∏ `items.length > 0`: `<Link href="/checkout">`
    - –ï—Å–ª–∏ `items.length === 0`: `<button disabled>`
  - [x] `aria-disabled={isEmpty}` –¥–ª—è accessibility

- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Sticky Positioning (AC: 8-9)
  - [x] Desktop: `lg:sticky lg:top-24` (96px = 6rem)
  - [x] Mobile: –æ–±—ã—á–Ω—ã–π flow (–±–µ–∑ sticky)

- [x] –û–±–Ω–æ–≤–∏—Ç—å persist –≤ cartStore –¥–ª—è promo state (MEDIUM)
  - [x] –î–æ–±–∞–≤–ª–µ–Ω–æ `promoCode`, `discountType`, `discountValue` –≤ `partialize` ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ cartStore.ts
  - [x] Promo state —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage —á–µ—Ä–µ–∑ Zustand persist middleware

- [x] –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã
  - [x] –¢–µ—Å—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤
  - [x] –¢–µ—Å—Ç disabled state –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –ø—É—Å—Ç–æ–π –∫–æ—Ä–∑–∏–Ω–µ
  - [x] –¢–µ—Å—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–∞ /checkout
  - [x] –¢–µ—Å—Ç hydration (–Ω–µ—Ç mismatch warnings)
  - [x] –¢–µ—Å—Ç promo code placeholder

## Dev Notes

### Relevant Source Tree

```
frontend/src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ cart/
‚îÇ       ‚îú‚îÄ‚îÄ CartSummary.tsx             (NEW)
‚îÇ       ‚îú‚îÄ‚îÄ PromoCodeInput.tsx          (NEW - placeholder/stub)
‚îÇ       ‚îú‚îÄ‚îÄ index.ts                    (UPDATE - barrel export)
‚îÇ       ‚îî‚îÄ‚îÄ __tests__/
‚îÇ           ‚îî‚îÄ‚îÄ CartSummary.test.tsx    (NEW)
‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îî‚îÄ‚îÄ cartStore.ts                    (EXISTS - items, totalPrice, totalItems)
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ pricing.ts                      (EXISTS - formatPrice)
```

> [!IMPORTANT]
> **–í cartStore –ù–ï–¢ `promoDiscount`!**
> –°–∫–∏–¥–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ Story 26.4.
> –í —ç—Ç–æ–π –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç—Ä–æ–∫–∞ "–°–∫–∏–¥–∫–∞" —Å–∫—Ä—ã—Ç–∞ (`promoDiscount = 0`).

> [!WARNING]
> **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ: –ø–µ—Ä–µ—Å—á—ë—Ç —Å–∫–∏–¥–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã**
>
> –ü—Ä–∏ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–º —Ç–∏–ø–µ —Å–∫–∏–¥–∫–∏ `promoDiscount` —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.
> –ï—Å–ª–∏ `totalPrice` –∏–∑–º–µ–Ω–∏—Ç—Å—è (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤), —Å–∫–∏–¥–∫–∞ –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç—Å—è.
>
> **–†–µ—à–µ–Ω–∏–µ –¥–ª—è Story 26.4:**
>
> - –•—Ä–∞–Ω–∏—Ç—å `discountType` + `discountValue` –≤–º–µ—Å—Ç–æ –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ `promoDiscount`
> - –í—ã—á–∏—Å–ª—è—Ç—å —Å–∫–∏–¥–∫—É –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤ getter/selector
> - –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å `promoDiscount` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `items`

### CartSummary Layout

```tsx
// CartSummary.tsx - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ globals.css
'use client';

import { useEffect, useState } from 'react';
import Link from 'next/link';
import { useCartStore } from '@/stores/cartStore';
import { formatPrice } from '@/utils/pricing';
import { cn } from '@/utils/cn';
import PromoCodeInput from './PromoCodeInput';

export const CartSummary = () => {
  // Hydration –ø–∞—Ç—Ç–µ—Ä–Ω
  const [mounted, setMounted] = useState(false);
  const { items, totalPrice } = useCartStore();
  
  useEffect(() => {
    setMounted(true);
  }, []);
  
  const isEmpty = !mounted || items.length === 0;
  
  // Placeholder –¥–ª—è Story 26.4
  const promoDiscount = 0;
  const finalTotal = totalPrice - promoDiscount;

  return (
    <div 
      className="bg-[var(--bg-panel)] rounded-[var(--radius-lg)] p-6
                 shadow-[0_18px_40px_rgba(0,55,166,0.12)] lg:sticky lg:top-24"
      data-testid="cart-summary"
    >
      <h2 className="text-title-m font-semibold text-[var(--color-text-primary)] mb-6">
        –ò—Ç–æ–≥–∏ –∑–∞–∫–∞–∑–∞
      </h2>
      
      {/* Price Breakdown - —Å aria-live –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π */}
      <div className="space-y-3 mb-6" aria-live="polite">
        <div className="flex justify-between text-body-m">
          <span className="text-[var(--color-text-secondary)]">–¢–æ–≤–∞—Ä—ã –Ω–∞ —Å—É–º–º—É</span>
          <span className="text-[var(--color-text-primary)] font-medium" data-testid="subtotal-amount">
            {mounted ? formatPrice(totalPrice) : '‚Äî'}
          </span>
        </div>
        
        {/* –°–∫–∏–¥–∫–∞ - —Å–∫—Ä—ã—Ç–∞ –¥–æ Story 26.4 */}
        {promoDiscount > 0 && (
          <div className="flex justify-between text-body-m">
            <span className="text-[var(--color-accent-success)]">–°–∫–∏–¥–∫–∞ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É</span>
            <span className="text-[var(--color-accent-success)] font-medium" data-testid="promo-discount-amount">
              -{formatPrice(promoDiscount)}
            </span>
          </div>
        )}
      </div>
      
      {/* Divider */}
      <div className="border-t border-[var(--color-neutral-300)] my-4" />
      
      {/* Total */}
      <div className="flex justify-between items-center mb-6">
        <span className="text-title-m font-semibold text-[var(--color-text-primary)]">
          –ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ
        </span>
        <span className="text-headline-m font-bold text-[var(--color-text-primary)]" data-testid="total-amount">
          {mounted ? formatPrice(finalTotal) : '‚Äî'}
        </span>
      </div>
      
      {/* Promo Code (placeholder –¥–ª—è Story 26.4) */}
      <PromoCodeInput />
      
      {/* Checkout Button - —É—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ Link/button */}
      {isEmpty ? (
        <button
          disabled
          className={cn(
            "w-full h-14 flex items-center justify-center",
            "bg-[var(--color-primary)] text-[var(--color-text-inverse)]",
            "rounded-[var(--radius-md)] text-body-l font-medium",
            "opacity-50 cursor-not-allowed"
          )}
          data-testid="checkout-button"
          aria-disabled="true"
        >
          üõí –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
        </button>
      ) : (
        <Link
          href="/checkout"
          className={cn(
            "w-full h-14 flex items-center justify-center",
            "bg-[var(--color-primary)] text-[var(--color-text-inverse)]",
            "rounded-[var(--radius-md)] text-body-l font-medium",
            "hover:bg-[var(--color-primary-hover)] transition-colors"
          )}
          data-testid="checkout-button"
        >
          üõí –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
        </Link>
      )}
    </div>
  );
};
```

### PromoCodeInput Placeholder

```tsx
// PromoCodeInput.tsx - placeholder –¥–ª—è Story 26.4
// –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ globals.css
const PromoCodeInput = () => {
  const [code, setCode] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  
  const handleApply = async () => {
    // Placeholder - –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ Story 26.4
    setIsLoading(true);
    // TODO: Implement promo code validation
    setTimeout(() => setIsLoading(false), 500);
  };
  
  return (
    <div className="flex gap-2 mb-4" data-testid="promo-code-section">
      <input
        type="text"
        value={code}
        onChange={(e) => setCode(e.target.value)}
        placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥"
        className="flex-1 h-10 px-3 border border-[var(--color-neutral-400)] rounded-[var(--radius-sm)]
                   text-body-m focus:outline-none focus:ring-[var(--focus-ring)] 
                   focus:border-[var(--color-primary)] bg-[var(--bg-panel)]"
        data-testid="promo-code-input"
      />
      <button
        onClick={handleApply}
        disabled={!code || isLoading}
        className="px-4 h-10 bg-[var(--color-primary-subtle)] text-[var(--color-primary)] 
                   rounded-[var(--radius-sm)] text-body-m font-medium 
                   hover:bg-[var(--color-primary)] hover:text-[var(--color-text-inverse)]
                   disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        data-testid="apply-promo-button"
      >
        {isLoading ? '–ü—Ä–æ–≤–µ—Ä–∫–∞...' : '–ü—Ä–∏–º–µ–Ω–∏—Ç—å'}
      </button>
    </div>
  );
};

export default PromoCodeInput;
```

### Data Test IDs

| –≠–ª–µ–º–µ–Ω—Ç | data-testid | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-------------|----------|
| –ë–ª–æ–∫ –∏—Ç–æ–≥–æ–≤ | `cart-summary` | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–ª–æ–∫–∞ |
| –°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤ | `subtotal-amount` | –°—É–º–º–∞ –¥–æ —Å–∫–∏–¥–∫–∏ |
| –°–∫–∏–¥–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ | `promo-discount-amount` | –°—É–º–º–∞ —Å–∫–∏–¥–∫–∏ |
| –ò—Ç–æ–≥–æ | `total-amount` | –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ |
| –ü–æ–ª–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞ | `promo-code-input` | Input –¥–ª—è –∫–æ–¥–∞ |
| –ö–Ω–æ–ø–∫–∞ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å" | `apply-promo-button` | –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ |
| –ö–Ω–æ–ø–∫–∞ "–û—Ñ–æ—Ä–º–∏—Ç—å" | `checkout-button` | CTA –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è |

### Design System References

```json
// –ò–∑ design-system.json
{
  "components": {
    "ProductSummary": {
      "priceBlock": {
        "background": "#FFFFFF",
        "radius": 20,
        "shadow": "0 18px 40px rgba(0, 55, 166, 0.12)",
        "padding": 24
      },
      "ctaPrimary": {
        "background": "#0060FF",
        "hover": "#0047CC",
        "textColor": "#FFFFFF",
        "radius": 16,
        "height": 56,
        "font": "body-l"
      }
    }
  }
}
```

### Sticky Positioning

```css
/* Desktop: sticky */
@media (min-width: 1024px) {
  .cart-summary {
    position: sticky;
    top: 96px; /* Header height (60px) + padding (36px) */
  }
}

/* Mobile: normal flow */
@media (max-width: 1023px) {
  .cart-summary {
    position: relative;
    top: auto;
  }
}
```

### Price Formatting Utility

```typescript
// utils/formatPrice.ts
export const formatPrice = (price: number): string => {
  return new Intl.NumberFormat('ru-RU', {
    style: 'currency',
    currency: 'RUB',
    minimumFractionDigits: 0,
    maximumFractionDigits: 0,
  }).format(price);
};

// –ü—Ä–∏–º–µ—Ä: formatPrice(15732) ‚Üí "15 732 ‚ÇΩ"
```

## Testing

**Framework:** Vitest + React Testing Library

**–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**

1. **Render with items:** –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ –∏—Ç–æ–≥–æ–≤
2. **Empty cart:** –ö–Ω–æ–ø–∫–∞ "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑" disabled
3. **With promo:** –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Å–∫–∏–¥–∫–∏
4. **Price formatting:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É–º–º
5. **Checkout navigation:** –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É ‚Üí redirect to `/checkout`

### Mock Cart Data

```typescript
// –ü—Ä–∏–º–µ—Ä mock –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è CartSummary
const mockCartItems = [
  {
    id: 1,
    variant_id: 101,
    product: {
      id: 10,
      name: '–ú—è—á —Ñ—É—Ç–±–æ–ª—å–Ω—ã–π Nike',
      slug: 'myach-futbolniy-nike',
      image: '/images/products/ball.jpg',
    },
    variant: {
      sku: 'BALL-001',
      color_name: '–ë–µ–ª—ã–π',
      size_value: '5',
    },
    quantity: 2,
    unit_price: '2500',
    total_price: '5000',
    added_at: '2025-12-07T10:00:00Z',
  },
  {
    id: 2,
    variant_id: 102,
    product: {
      id: 11,
      name: '–ë—É—Ç—Å—ã Adidas Predator',
      slug: 'butsy-adidas-predator',
      image: '/images/products/boots.jpg',
    },
    variant: {
      sku: 'BOOTS-002',
      color_name: '–ß—ë—Ä–Ω—ã–π',
      size_value: '42',
    },
    quantity: 1,
    unit_price: '8990',
    total_price: '8990',
    added_at: '2025-12-07T10:05:00Z',
  },
];

// Mock cartStore state
const mockCartStore = {
  items: mockCartItems,
  totalItems: 3,            // 2 + 1
  totalPrice: 13990,        // 5000 + 8990
  isLoading: false,
  error: null,
};

// Mock –¥–ª—è –ø—É—Å—Ç–æ–π –∫–æ—Ä–∑–∏–Ω—ã
const mockEmptyCartStore = {
  items: [],
  totalItems: 0,
  totalPrice: 0,
  isLoading: false,
  error: null,
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–∞—Ö
vi.mock('@/stores/cartStore', () => ({
  useCartStore: vi.fn(() => mockCartStore),
}));
```

## Definition of Done

- [x] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] –ò—Ç–æ–≥–∏ –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É—è cartStore.totalPrice)
- [x] Hydration —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ mismatch warnings
- [x] Sticky —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ desktop (lg:sticky lg:top-24)
- [x] –ö–Ω–æ–ø–∫–∞ disabled –ø—Ä–∏ –ø—É—Å—Ç–æ–π –∫–æ—Ä–∑–∏–Ω–µ (—É—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ Link/button)
- [x] PromoCodeInput placeholder –≥–æ—Ç–æ–≤ –¥–ª—è Story 26.4
- [x] Barrel exports –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ index.ts
- [x] Unit —Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã (36 —Ç–µ—Å—Ç–æ–≤, 100% pass rate)
- [x] Accessibility: aria-live="polite", —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4 (Cascade)

### Debug Log References

N/A - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º

### Completion Notes

- ‚úÖ CartSummary.tsx —Å–æ–∑–¥–∞–Ω —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π hydration (mounted pattern)
- ‚úÖ PromoCodeInput.tsx —Å–æ–∑–¥–∞–Ω –∫–∞–∫ placeholder –¥–ª—è Story 26.4
- ‚úÖ –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ Link/button –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã disabled state
- ‚úÖ Sticky positioning —á–µ—Ä–µ–∑ Tailwind –∫–ª–∞—Å—Å—ã lg:sticky lg:top-24
- ‚úÖ Accessibility: aria-live="polite" –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Å—É–º–º, aria-disabled –¥–ª—è –∫–Ω–æ–ø–∫–∏
- ‚úÖ 36 unit —Ç–µ—Å—Ç–æ–≤ (19 –¥–ª—è CartSummary, 17 –¥–ª—è PromoCodeInput) - –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –†–µ–≥—Ä–µ—Å—Å–∏—è: –≤—Å–µ 157 —Ç–µ—Å—Ç–æ–≤ –∫–æ—Ä–∑–∏–Ω—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ Persist –¥–ª—è promo state —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (promoCode, discountType, discountValue –≤ partialize)

### File List

| File | Action | Description |
|------|--------|-------------|
| `frontend/src/components/cart/CartSummary.tsx` | NEW | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∏—Ç–æ–≥–æ–≤ –∫–æ—Ä–∑–∏–Ω—ã |
| `frontend/src/components/cart/PromoCodeInput.tsx` | NEW | Placeholder –¥–ª—è –≤–≤–æ–¥–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ |
| `frontend/src/components/cart/index.ts` | MODIFIED | –î–æ–±–∞–≤–ª–µ–Ω—ã barrel exports |
| `frontend/src/components/cart/__tests__/CartSummary.test.tsx` | NEW | Unit —Ç–µ—Å—Ç—ã CartSummary |
| `frontend/src/components/cart/__tests__/PromoCodeInput.test.tsx` | NEW | Unit —Ç–µ—Å—Ç—ã PromoCodeInput |

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-07 | 1.0 | Initial story creation | Sarah (PO) |
| 2025-12-07 | 1.1 | –î–æ–±–∞–≤–ª–µ–Ω—ã: hydration –ø–∞—Ç—Ç–µ—Ä–Ω, —É—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ Link/button, barrel exports, aria-live, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞ | Bob (SM) |
| 2025-12-07 | 1.2 | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–µ–∫—Ü–∏–∏ –≤ Dependencies, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ persist –¥–ª—è promo state, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ TODO –æ –ø–µ—Ä–µ—Å—á—ë—Ç–µ —Å–∫–∏–¥–∫–∏ | Sarah (PO) |
| 2025-12-07 | 1.3 | –î–æ–±–∞–≤–ª–µ–Ω—ã mock cart data –≤ —Å–µ–∫—Ü–∏—é Testing | Sarah (PO) |
| 2025-12-07 | 1.4 | **IMPLEMENTATION COMPLETE** - CartSummary, PromoCodeInput —Å–æ–∑–¥–∞–Ω—ã, 36 —Ç–µ—Å—Ç–æ–≤, –≤—Å–µ AC –≤—ã–ø–æ–ª–Ω–µ–Ω—ã | James (Dev) |
| 2025-12-07 | 1.5 | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ persist –¥–ª—è promo state, –æ–±–Ω–æ–≤–ª–µ–Ω—ã —á–µ–∫–±–æ–∫—Å—ã –ø–æ–¥–∑–∞–¥–∞—á [N/A] ‚Üí [x] | James (Dev) |

## QA Results

### Review Date: 2025-12-07

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**Overall: EXCELLENT** ‚Äî –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤—ã—Å–æ–∫–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –∫–∞—á–µ—Å—Ç–≤–∞.

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**

- ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è hydration –ø–∞—Ç—Ç–µ—Ä–Ω–∞ —á–µ—Ä–µ–∑ `mounted` state
- ‚úÖ –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ Link/button ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã disabled Link
- ‚úÖ –ì—Ä–∞–º–æ—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ design-system
- ‚úÖ –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ (19 —Ç–µ—Å—Ç–æ–≤ CartSummary + 17 —Ç–µ—Å—Ç–æ–≤ PromoCodeInput)
- ‚úÖ Accessibility: `aria-live="polite"`, `aria-label`, `aria-disabled`
- ‚úÖ Keyboard navigation (Enter –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å cartStore (items, totalPrice)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**

- ‚úÖ `getPromoDiscount()` –≤ cartStore –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å–∫–∏–¥–∫—É ‚Äî –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–µ–π–ª –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã
- ‚úÖ Persist middleware –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç promo state (promoCode, discountType, discountValue)
- ‚úÖ Barrel exports –≤ index.ts –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —á–∏—Å—Ç—ã–µ –∏–º–ø–æ—Ä—Ç—ã

### Refactoring Performed

–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è ‚Äî –∫–æ–¥ –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞.

### Compliance Check

- Coding Standards: ‚úì –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –ø—Ä–æ–µ–∫—Ç–∞
- Project Structure: ‚úì –§–∞–π–ª—ã —Ä–∞–∑–º–µ—â–µ–Ω—ã –ø–æ source tree –∏–∑ story
- Testing Strategy: ‚úì Unit —Ç–µ—Å—Ç—ã —Å Vitest + RTL, proper mocking
- All ACs Met: ‚úì –í—Å–µ 11 acceptance criteria –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

### Improvements Checklist

- [x] Hydration –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ Link/button –¥–ª—è disabled state
- [x] Accessibility: aria-live, aria-label, aria-disabled
- [x] Sticky positioning: lg:sticky lg:top-24
- [x] PromoCodeInput placeholder –≥–æ—Ç–æ–≤ –¥–ª—è Story 26.4
- [x] Barrel exports –¥–æ–±–∞–≤–ª–µ–Ω—ã

### Security Review

**Status: PASS** ‚Äî –ù–µ—Ç security concerns –¥–ª—è UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.

### Performance Considerations

**Status: PASS**

- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π re-render –±–ª–∞–≥–æ–¥–∞—Ä—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ù–µ—Ç —Ç—è–∂—ë–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- formatPrice –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Intl.NumberFormat

### Files Modified During Review

–ù–µ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π ‚Äî –∫–æ–¥ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### Gate Status

Gate: **PASS** ‚Üí `docs/qa/gates/26.3-cart-summary.yml`

### Recommended Status

‚úì **Ready for Done** ‚Äî –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, code quality excellent, —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç.
