# Story 12.2: Выбор опций товара (размер, цвет)

## Status
Draft

## Story
**Как** покупатель,
**Я хочу** выбирать размер и цвет товара перед добавлением в корзину,
**Чтобы** заказать именно тот вариант, который мне нужен.

## Acceptance Criteria
1. Селектор размеров отображается если товар имеет варианты размеров
2. Селектор цветов отображается если товар доступен в разных цветах
3. Недоступные опции (нет в наличии) визуально отключены
4. При выборе опции обновляется основное изображение товара (если есть)
5. При выборе опции обновляется информация о наличии
6. Выбранные опции сохраняются при добавлении в корзину
7. Валидация: нельзя добавить в корзину без выбора обязательных опций

## Tasks / Subtasks

- [ ] Создать компонент ProductOptions (AC: 1, 2, 3, 7)
  - [ ] Создать `src/components/product/ProductOptions.tsx`
  - [ ] Создать интерфейс `ProductOption` (id, name, type: size|color, available)
  - [ ] Отобразить группу опций размеров (Chip компоненты)
  - [ ] Отобразить группу опций цветов (Chip с цветовыми индикаторами)
  - [ ] Визуально отключить недоступные опции (opacity 0.5, cursor not-allowed)
  - [ ] Добавить состояние selectedOptions (useState)

- [ ] Реализовать логику выбора опций (AC: 4, 5, 6)
  - [ ] Обработчик onClick для выбора размера
  - [ ] Обработчик onClick для выбора цвета
  - [ ] Обновить основное изображение при выборе цвета (если доступно)
  - [ ] Обновить информацию о наличии при выборе опций
  - [ ] Сохранять selectedOptions в локальное состояние компонента

- [ ] Интеграция с ProductSummary (AC: 6, 7)
  - [ ] Передать selectedOptions в ProductSummary через props
  - [ ] Валидация перед добавлением в корзину (проверить обязательные опции)
  - [ ] Показать ошибку если обязательные опции не выбраны
  - [ ] Передать selectedOptions в cartItem при добавлении

- [ ] Дизайн опций согласно дизайн-системе
  - [ ] Chip для размеров: radius 16px, border-neutral-400
  - [ ] Selected state: bg-primary, text-inverse
  - [ ] Disabled state: opacity 0.5
  - [ ] Цветовые опции с круглым индикатором цвета (16px)

- [ ] Написать unit тесты
  - [ ] Тест отображения опций размеров
  - [ ] Тест отображения опций цветов
  - [ ] Тест отключения недоступных опций
  - [ ] Тест выбора опций и обновления состояния
  - [ ] Тест валидации обязательных опций
  - [ ] Тест обновления изображения при выборе цвета

## Dev Notes

### Relevant Source Tree
```
frontend/src/
├── components/
│   └── product/
│       ├── ProductOptions.tsx     (NEW)
│       └── __tests__/
│           └── ProductOptions.test.tsx  (NEW)
└── types/
    └── product.ts  (UPDATE - добавить ProductOption interface)
```

### TypeScript Interfaces
```typescript
export interface ProductOption {
  id: string;
  name: string;
  type: 'size' | 'color';
  value: string;
  available: boolean;
  image_url?: string; // для цветовых вариантов
  color_hex?: string; // HEX код цвета
}

export interface SelectedOptions {
  size?: string;
  color?: string;
}
```

### Компонент дизайн-системы
- **Chip:** используется для отображения опций
  - Default: bg-neutral-100, border-neutral-400
  - Selected: bg-primary, text-inverse
  - Disabled: opacity 0.5, cursor not-allowed
  - Radius: 16px, padding 8px 16px

### Логика обновления изображения
```typescript
function updateImageOnColorChange(color: ProductOption) {
  if (color.image_url) {
    // Обновить основное изображение в ProductGallery
    setSelectedImage(color.image_url);
  }
}
```

### Валидация опций
```typescript
function validateOptions(selectedOptions: SelectedOptions, product: ProductDetail): boolean {
  const requiredOptions = product.options.filter(opt => opt.required);

  for (const option of requiredOptions) {
    if (option.type === 'size' && !selectedOptions.size) return false;
    if (option.type === 'color' && !selectedOptions.color) return false;
  }

  return true;
}
```

### Testing

#### Test file location
- `src/components/product/__tests__/ProductOptions.test.tsx`

#### Test cases
```typescript
describe('ProductOptions', () => {
  it('renders size options when available', () => {});
  it('renders color options when available', () => {});
  it('disables unavailable options', () => {});
  it('updates selected state on option click', () => {});
  it('validates required options before add to cart', () => {});
  it('updates image on color selection', () => {});
  it('shows error when required option not selected', () => {});
});
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-30 | 1.0 | Создание story 12.2 на основе Epic 12 | Sarah (PO) |

## Dev Agent Record
(Заполняется dev-агентом)

## QA Results
(Заполняется QA-агентом)
