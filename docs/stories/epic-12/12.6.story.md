# Story 12.6: Модальные окна и уведомления

## Status

Draft

## Prerequisites

- **Story 12.1 (Обновление дизайн-токенов)** - CSS переменные и Tailwind конфигурация должны быть обновлены
- **Story 12.2 (Миграция базовых UI компонентов)** - Button должен быть обновлен под новую палитру

## Story

**As a** Frontend разработчик,
**I want** создать компоненты Modal, Toast, Dialog и SizeChartModal согласно Design System v2.0,
**so that** пользователи FREESPORT получали информативную обратную связь через модальные окна и уведомления с единообразным визуальным стилем и качественным UX.

## Acceptance Criteria

1. Компонент Modal создан с поддержкой размеров:
   - Размеры: sm (400px), md (560px), lg (720px), xl (960px), full (100%)
   - Backdrop с blur эффектом и затемнением
   - Закрытие по клику на backdrop и по Escape
   - Структура: header (title + close button), content, footer
   - Border radius: 24px
   - Shadow: modal (0 24px 64px rgba(15, 23, 42, 0.24))
   - Close button: контейнер 44px, radius 12px, hover bg #E3E8F2
   - Анимация появления/закрытия (fade + scale)

2. Компонент Toast (уведомления) создан с вариантами:
   - Варианты: success, error, warning, info
   - Позиционирование: top-right (default), bottom-right, top-center, bottom-center
   - Auto-dismiss таймер (default 5 секунд)
   - Кнопка закрытия
   - Иконки для каждого варианта (Check, X, AlertTriangle, Info)
   - Стилизация по вариантам:
     - success: bg #E0F5E0, border #1F7A1F, icon color #1F7A1F
     - error: bg #FFE1E1, border #C23B3B, icon color #C23B3B
     - warning: bg #FFF1CC, border #B07600, icon color #B07600
     - info: bg #E1F0FF, border #0F5DA3, icon color #0F5DA3
   - Border radius: 12px
   - Shadow: 0 8px 24px rgba(15, 23, 42, 0.12)

3. Компонент ToastProvider и useToast hook созданы:
   - ToastProvider для рендеринга toasts на верхнем уровне
   - useToast hook для programmatic вызова toast
   - Поддержка очереди уведомлений
   - Stack toast'ов с gap: 12px
   - Maximum visible toasts: 5

4. Компонент ConfirmDialog создан:
   - Наследует Modal с размером sm
   - Props: title, message, confirmText, cancelText, variant
   - Варианты: default, danger
   - Кнопки: Cancel (tertiary), Confirm (primary/danger)
   - Promise-based API для async/await usage

5. Компонент SizeChartModal создан:
   - Таблица размеров для товаров (размерная сетка)
   - Наследует Modal с размером lg
   - Табличное представление размеров
   - Поддержка разных категорий (одежда, обувь)
   - Стилизация таблицы:
     - Header: bg #F5F7FB, font-weight 600
     - Zebra striping для строк
     - Border: 1px solid #E3E8F2

6. Trap focus внутри модальных окон:
   - Focus переходит к первому focusable элементу при открытии
   - Tab/Shift+Tab циклически навигирует внутри модального окна
   - Focus возвращается к trigger элементу при закрытии

7. Все компоненты проходят accessibility проверку:
   - role="dialog" и aria-modal="true"
   - aria-labelledby для заголовка
   - aria-describedby для описания
   - Keyboard navigation (Escape закрывает)
   - Screen reader announcements для toast

8. Анимации соответствуют Design System:
   - Duration: 180ms
   - Easing: cubic-bezier(0.4, 0, 0.2, 1)
   - Modal: fade backdrop + scale content
   - Toast: slide in from right + fade

9. Тесты созданы и проходят успешно:
   - Unit тесты для каждого компонента
   - Тесты открытия/закрытия
   - Тесты keyboard interaction
   - Тесты accessibility атрибутов
   - Покрытие >= 80%

10. Документация компонентов обновлена:
    - JSDoc комментарии
    - Props interfaces с описаниями
    - Примеры использования

## Tasks / Subtasks

- [ ] Task 1: Создание компонента Modal (AC: 1, 6, 7, 8)
  - [ ] 1.1 Создать директорию `frontend/src/components/ui/Modal/`
  - [ ] 1.2 Создать файл `Modal.tsx` с интерфейсом:
    ```typescript
    interface ModalProps {
      isOpen: boolean
      onClose: () => void
      title?: string
      size?: 'sm' | 'md' | 'lg' | 'xl' | 'full'
      children: ReactNode
      footer?: ReactNode
      closeOnBackdrop?: boolean
      closeOnEscape?: boolean
      showCloseButton?: boolean
      className?: string
    }
    ```
  - [ ] 1.3 Создать Portal для рендеринга модала
  - [ ] 1.4 Стилизовать backdrop:
    - bg-black/50
    - backdrop-blur-sm
    - fixed inset-0
    - z-50
    - transition-opacity duration-[180ms]
  - [ ] 1.5 Стилизовать modal container:
    - bg-white (neutral-100)
    - rounded-3xl (24px)
    - shadow-modal
    - Размеры по size prop:
      - sm: max-w-[400px]
      - md: max-w-[560px]
      - lg: max-w-[720px]
      - xl: max-w-[960px]
      - full: max-w-full m-4
  - [ ] 1.6 Создать header секцию:
    - flex justify-between items-center
    - p-6
    - border-b border-[#E3E8F2]
    - title: title-m (20px, weight 600)
  - [ ] 1.7 Создать close button:
    - w-11 h-11 (44px)
    - rounded-xl (12px)
    - hover:bg-[#E3E8F2]
    - Icon: X, size 40px
    - transition-colors duration-[180ms]
  - [ ] 1.8 Создать content секцию:
    - p-6
    - overflow-y-auto
    - max-h-[calc(100vh-200px)]
  - [ ] 1.9 Создать footer секцию:
    - p-6
    - border-t border-[#E3E8F2]
    - flex justify-end gap-3
  - [ ] 1.10 Добавить анимации:
    - Backdrop: opacity 0 -> 1
    - Content: scale 0.95 -> 1, opacity 0 -> 1
    - cubic-bezier(0.4, 0, 0.2, 1)
  - [ ] 1.11 Реализовать focus trap:
    - Использовать useFocusTrap hook
    - Tab/Shift+Tab циклическая навигация
  - [ ] 1.12 Добавить Escape handler
  - [ ] 1.13 Добавить accessibility атрибуты:
    - role="dialog"
    - aria-modal="true"
    - aria-labelledby={titleId}
    - aria-describedby={descriptionId}
  - [ ] 1.14 Создать index.ts для экспорта
  - [ ] 1.15 Реализовать body scroll lock при открытом модале

- [ ] Task 2: Создание компонента Toast (AC: 2, 8)
  - [ ] 2.1 Создать директорию `frontend/src/components/ui/Toast/`
  - [ ] 2.2 Создать файл `Toast.tsx` с интерфейсом:
    ```typescript
    interface ToastProps {
      id: string
      variant: 'success' | 'error' | 'warning' | 'info'
      title?: string
      message: string
      duration?: number
      onClose: (id: string) => void
      position?: ToastPosition
    }

    type ToastPosition = 'top-right' | 'top-center' | 'bottom-right' | 'bottom-center'
    ```
  - [ ] 2.3 Определить цветовые схемы:
    ```typescript
    const TOAST_VARIANTS = {
      success: {
        bg: '#E0F5E0',
        border: '#1F7A1F',
        icon: CheckCircle,
        iconColor: '#1F7A1F'
      },
      error: {
        bg: '#FFE1E1',
        border: '#C23B3B',
        icon: XCircle,
        iconColor: '#C23B3B'
      },
      warning: {
        bg: '#FFF1CC',
        border: '#B07600',
        icon: AlertTriangle,
        iconColor: '#B07600'
      },
      info: {
        bg: '#E1F0FF',
        border: '#0F5DA3',
        icon: Info,
        iconColor: '#0F5DA3'
      }
    }
    ```
  - [ ] 2.4 Стилизовать toast container:
    - rounded-xl (12px)
    - shadow-[0_8px_24px_rgba(15,23,42,0.12)]
    - p-4
    - min-w-[320px]
    - max-w-[420px]
    - border-l-4
  - [ ] 2.5 Создать layout:
    - flex gap-3
    - Icon (24px) слева
    - Content (title + message) по центру
    - Close button справа
  - [ ] 2.6 Стилизовать typography:
    - title: body-m, font-weight 600
    - message: body-s
  - [ ] 2.7 Добавить close button:
    - X icon, size 16px
    - hover: opacity-70
  - [ ] 2.8 Реализовать auto-dismiss:
    - useEffect с setTimeout
    - Progress bar опционально
  - [ ] 2.9 Добавить enter/exit анимации:
    - Enter: slide from right, fade in
    - Exit: slide to right, fade out
    - Duration: 180ms
  - [ ] 2.10 Accessibility:
    - role="alert"
    - aria-live="polite"
  - [ ] 2.11 Создать index.ts

- [ ] Task 3: Создание ToastProvider и useToast (AC: 3)
  - [ ] 3.1 Создать файл `ToastProvider.tsx`:
    ```typescript
    interface ToastContextValue {
      toast: (options: ToastOptions) => string
      success: (message: string, title?: string) => string
      error: (message: string, title?: string) => string
      warning: (message: string, title?: string) => string
      info: (message: string, title?: string) => string
      dismiss: (id: string) => void
      dismissAll: () => void
    }

    interface ToastOptions {
      variant?: ToastVariant
      title?: string
      message: string
      duration?: number
      position?: ToastPosition
    }
    ```
  - [ ] 3.2 Создать ToastContext
  - [ ] 3.3 Реализовать state management для toasts queue
  - [ ] 3.4 Ограничить максимум видимых toasts (5)
  - [ ] 3.5 Создать ToastContainer для рендеринга:
    - fixed positioning по position prop
    - z-[100]
    - flex flex-col gap-3
  - [ ] 3.6 Создать useToast hook:
    ```typescript
    export const useToast = () => {
      const context = useContext(ToastContext)
      if (!context) {
        throw new Error('useToast must be used within ToastProvider')
      }
      return context
    }
    ```
  - [ ] 3.7 Добавить в App layout provider

- [ ] Task 4: Создание компонента ConfirmDialog (AC: 4)
  - [ ] 4.1 Создать директорию `frontend/src/components/ui/ConfirmDialog/`
  - [ ] 4.2 Создать файл `ConfirmDialog.tsx`:
    ```typescript
    interface ConfirmDialogProps {
      isOpen: boolean
      onClose: () => void
      onConfirm: () => void | Promise<void>
      title: string
      message: string
      confirmText?: string
      cancelText?: string
      variant?: 'default' | 'danger'
      isLoading?: boolean
    }
    ```
  - [ ] 4.3 Использовать Modal как базу с size="sm"
  - [ ] 4.4 Создать content layout:
    - Icon по варианту (AlertTriangle для danger)
    - Title: title-m
    - Message: body-m, text-secondary
  - [ ] 4.5 Создать footer с кнопками:
    - Cancel: Button variant="tertiary"
    - Confirm: Button variant="primary" или variant="danger"
  - [ ] 4.6 Добавить loading state для async operations
  - [ ] 4.7 Создать utility function:
    ```typescript
    export const confirm = (options: ConfirmOptions): Promise<boolean>
    ```
  - [ ] 4.8 Создать index.ts

- [ ] Task 5: Создание компонента SizeChartModal (AC: 5)
  - [ ] 5.1 Создать директорию `frontend/src/components/business/SizeChartModal/`
  - [ ] 5.2 Создать файл `SizeChartModal.tsx`:
    ```typescript
    interface SizeChartModalProps {
      isOpen: boolean
      onClose: () => void
      category: 'clothing' | 'shoes' | 'gloves'
      gender?: 'men' | 'women' | 'unisex'
    }

    interface SizeRow {
      size: string
      chest?: string
      waist?: string
      hips?: string
      eu?: string
      us?: string
      uk?: string
      cm?: string
    }
    ```
  - [ ] 5.3 Использовать Modal с size="lg"
  - [ ] 5.4 Создать Tabs для переключения категорий
  - [ ] 5.5 Создать таблицу размеров:
    - Стилизация table:
      - w-full
      - border-collapse
    - Header: bg-[#F5F7FB], font-weight 600, text-body-s
    - Cells: p-3, border border-[#E3E8F2]
    - Zebra striping: even:bg-[#FAFBFC]
  - [ ] 5.6 Определить данные размерных сеток:
    ```typescript
    const CLOTHING_SIZES = [
      { size: 'XS', chest: '82-86', waist: '62-66', hips: '87-90' },
      { size: 'S', chest: '86-90', waist: '66-70', hips: '90-94' },
      // ...
    ]

    const SHOE_SIZES = [
      { eu: '36', us: '6', uk: '3.5', cm: '22.5' },
      { eu: '37', us: '7', uk: '4', cm: '23' },
      // ...
    ]
    ```
  - [ ] 5.7 Добавить инструкции по измерению
  - [ ] 5.8 Создать index.ts

- [ ] Task 6: Создание useFocusTrap hook (AC: 6)
  - [ ] 6.1 Создать файл `frontend/src/hooks/useFocusTrap.ts`
  - [ ] 6.2 Реализовать логику:
    ```typescript
    export const useFocusTrap = (ref: RefObject<HTMLElement>, isActive: boolean) => {
      // Find all focusable elements
      // Handle Tab and Shift+Tab
      // Return focus to trigger on close
    }
    ```
  - [ ] 6.3 Определить focusable elements selector
  - [ ] 6.4 Сохранить и восстановить активный элемент

- [ ] Task 7: Создание тестов (AC: 9)
  - [ ] 7.1 Создать тесты для Modal:
    - `frontend/src/components/ui/Modal/__tests__/Modal.test.tsx`
    - Тесты: render, open/close, backdrop click, escape key, focus trap
  - [ ] 7.2 Создать тесты для Toast:
    - `frontend/src/components/ui/Toast/__tests__/Toast.test.tsx`
    - Тесты: render variants, auto-dismiss, close click
  - [ ] 7.3 Создать тесты для ToastProvider:
    - `frontend/src/components/ui/Toast/__tests__/ToastProvider.test.tsx`
    - Тесты: toast(), success(), error(), dismiss()
  - [ ] 7.4 Создать тесты для ConfirmDialog:
    - `frontend/src/components/ui/ConfirmDialog/__tests__/ConfirmDialog.test.tsx`
    - Тесты: render, confirm, cancel, loading
  - [ ] 7.5 Создать тесты для SizeChartModal:
    - `frontend/src/components/business/SizeChartModal/__tests__/SizeChartModal.test.tsx`
    - Тесты: render, tabs, table data
  - [ ] 7.6 Запустить тесты и проверить покрытие >= 80%

- [ ] Task 8: Документация и интеграция (AC: 10)
  - [ ] 8.1 Добавить JSDoc комментарии ко всем компонентам
  - [ ] 8.2 Добавить примеры использования
  - [ ] 8.3 Экспортировать компоненты из `frontend/src/components/ui/index.ts`
  - [ ] 8.4 Экспортировать SizeChartModal из `frontend/src/components/business/index.ts`
  - [ ] 8.5 Добавить ToastProvider в root layout
  - [ ] 8.6 Визуальная проверка всех компонентов в dev режиме

## Dev Notes

### Расположение компонентов [Source: docs/architecture/source-tree.md]

```
frontend/src/
├── components/
│   ├── ui/
│   │   ├── Modal/
│   │   │   ├── Modal.tsx              # СОЗДАТЬ
│   │   │   ├── index.ts               # СОЗДАТЬ
│   │   │   └── __tests__/
│   │   │       └── Modal.test.tsx     # СОЗДАТЬ
│   │   ├── Toast/
│   │   │   ├── Toast.tsx              # СОЗДАТЬ
│   │   │   ├── ToastProvider.tsx      # СОЗДАТЬ
│   │   │   ├── index.ts               # СОЗДАТЬ
│   │   │   └── __tests__/
│   │   │       ├── Toast.test.tsx     # СОЗДАТЬ
│   │   │       └── ToastProvider.test.tsx # СОЗДАТЬ
│   │   ├── ConfirmDialog/
│   │   │   ├── ConfirmDialog.tsx      # СОЗДАТЬ
│   │   │   ├── index.ts               # СОЗДАТЬ
│   │   │   └── __tests__/
│   │   │       └── ConfirmDialog.test.tsx # СОЗДАТЬ
│   │   └── index.ts                   # Добавить экспорты
│   └── business/
│       ├── SizeChartModal/
│       │   ├── SizeChartModal.tsx     # СОЗДАТЬ
│       │   ├── index.ts               # СОЗДАТЬ
│       │   └── __tests__/
│       │       └── SizeChartModal.test.tsx # СОЗДАТЬ
│       └── index.ts                   # Добавить экспорт
└── hooks/
    └── useFocusTrap.ts                # СОЗДАТЬ
```

### Ключевые цвета Design System v2.0 [Source: docs/frontend/design-system.json]

```scss
// Primary (для кнопок, акцентов)
$primary-default: #1F1F1F;
$primary-hover: #3A3A3A;

// Neutral (для фонов, бордеров)
$neutral-100: #FFFFFF;
$neutral-200: #F5F5F5;
$neutral-300: #E0E0E0;

// Text
$text-primary: #1B1B1B;
$text-secondary: #4D4D4D;
$text-muted: #7A7A7A;

// Toast variants
$toast-success-bg: #E0F5E0;
$toast-success-border: #1F7A1F;
$toast-error-bg: #FFE1E1;
$toast-error-border: #C23B3B;
$toast-warning-bg: #FFF1CC;
$toast-warning-border: #B07600;
$toast-info-bg: #E1F0FF;
$toast-info-border: #0F5DA3;
```

### Modal спецификация [Source: docs/frontend/design-system.json#components.Modal]

```typescript
// Modal from design-system.json
{
  description: "Центрированное окно с backdrop blur",
  structure: ["header с title и кнопкой закрытия", "content area", "необязательный footer"],
  tokens: ["bg-neutral-100", "rounded-xl", "shadow-modal"],
  dimensions: {
    radius: 24,
    maxWidth: 560  // default md size
  },
  closeIcon: {
    container: { size: 44, radius: 12, hoverBackground: "#E3E8F2" },
    iconSize: 40
  },
  behavior: "Backdrop закрывает при клике, кнопка X использует hover bg #E3E8F2"
}
```

### Shadows [Source: docs/frontend/design-system.json#foundations.shadows]

```typescript
// Shadows
shadow-default: "0 8px 24px rgba(15, 23, 42, 0.08)"
shadow-hover: "0 10px 32px rgba(15, 23, 42, 0.12)"
shadow-modal: "0 24px 64px rgba(15, 23, 42, 0.24)"

// Toast shadow
shadow-toast: "0 8px 24px rgba(15, 23, 42, 0.12)"
```

### Border-l-4 в Toast компонентах

В спецификации Toast компонентов используется класс `border-l-4` (строка 218), который создает левую границу толщиной 4px. Это ключевая визуальная характеристика компонента Toast:

**Назначение:**
- **Визуальный индикатор статуса:** Левая граница служит цветовым кодировщиком типа уведомления
- **Быстрая идентификация:** Пользователь мгновенно определяет тип сообщения (success, error, warning, info) по цвету левой границы
- **Улучшение иерархии:** Создает визуальный акцент, отделяющий уведомление от фона

**Цвета для каждого варианта:**
```typescript
const TOAST_BORDER_COLORS = {
  success: '#1F7A1F',    // Зеленый - успешное действие
  error: '#C23B3B',      // Красный - ошибка
  warning: '#B07600',    // Оранжевый - предупреждение
  info: '#0F5DA3'        // Синий - информационное сообщение
}
```

**Техническая реализация в Tailwind:**
```css
/* Для каждого варианта Toast */
.toast-success {
  @apply border-l-4;
  border-color: #1F7A1F;
}

.toast-error {
  @apply border-l-4;
  border-color: #C23B3B;
}

.toast-warning {
  @apply border-l-4;
  border-color: #B07600;
}

.toast-info {
  @apply border-l-4;
  border-color: #0F5DA3;
}
```

**Преимущества подхода:**
1. **Консистентность:** Все Toast используют одинаковую толщину границы (4px)
2. **Доступность:** Цветовая кодировка соответствует стандартным значениям (зеленый=успех, красный=ошибка)
3. **Визуальный баланс:** Толщина 4px обеспечивает достаточную контрастность без перегрузки интерфейса
4. **Соответствие Design System:** Цвета полностью совпадают с палитрой Badge компонентов

### Motion [Source: docs/frontend/design-system.json#foundations.motion]

```typescript
// Motion
duration: {
  short: 120,
  medium: 180
}
easing: "cubic-bezier(0.4, 0, 0.2, 1)"
rules: [
  "Анимации не более 200ms",
  "Использовать плавные fade/slide без резких скачков"
]
```

### Типографика [Source: docs/frontend/design-system.json#foundations.typography]

```typescript
// Для модальных окон и toast
title-m: { size: 20, lineHeight: 28, weight: 600 }  // Modal title
body-m: { size: 16, lineHeight: 24, weight: 500 }   // Content, messages
body-s: { size: 14, lineHeight: 20, weight: 500 }   // Secondary text
```

### Badge tokens для toast variants [Source: docs/frontend/design-system.json#components.Badge.tokens]

```typescript
// Используем те же цвета что и Badge варианты
delivered: { background: "#E0F5E0", textColor: "#1F7A1F" }  // success
transit: { background: "#FFF1CC", textColor: "#B07600" }    // warning
cancelled: { background: "#FFE1E1", textColor: "#C23B3B" }  // error
new: { background: "#E1F0FF", textColor: "#0F5DA3" }        // info
```

### Accessibility requirements [Source: docs/frontend/design-system.json#accessibility]

```typescript
// Modal accessibility
{
  focus: "Все интерактивные элементы имеют focus:ring 2px primary",
  keyboard: "Модальные окна должны ловить фокус внутри, ESC закрывает",
  aria: [
    "aria-label для кнопок без текста",
    "aria-expanded для Toggle где применимо"
  ]
}
```

### React Portal для модальных окон

```typescript
// Создание Portal для рендеринга вне DOM дерева
import { createPortal } from 'react-dom'

const Modal = ({ isOpen, children }) => {
  if (!isOpen) return null

  return createPortal(
    <div className="modal-overlay">
      {children}
    </div>,
    document.body
  )
}
```

### Пример Focus Trap реализации

```typescript
// useFocusTrap.ts
const FOCUSABLE_ELEMENTS = [
  'button',
  '[href]',
  'input',
  'select',
  'textarea',
  '[tabindex]:not([tabindex="-1"])'
].join(',')

export const useFocusTrap = (ref: RefObject<HTMLElement>, isActive: boolean) => {
  const previousActiveElement = useRef<HTMLElement | null>(null)

  useEffect(() => {
    if (!isActive || !ref.current) return

    // Save current active element
    previousActiveElement.current = document.activeElement as HTMLElement

    // Focus first focusable element
    const focusableElements = ref.current.querySelectorAll(FOCUSABLE_ELEMENTS)
    const firstElement = focusableElements[0] as HTMLElement
    firstElement?.focus()

    // Handle Tab
    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.key !== 'Tab') return

      const elements = Array.from(focusableElements) as HTMLElement[]
      const first = elements[0]
      const last = elements[elements.length - 1]

      if (e.shiftKey && document.activeElement === first) {
        e.preventDefault()
        last.focus()
      } else if (!e.shiftKey && document.activeElement === last) {
        e.preventDefault()
        first.focus()
      }
    }

    document.addEventListener('keydown', handleKeyDown)

    return () => {
      document.removeEventListener('keydown', handleKeyDown)
      previousActiveElement.current?.focus()
    }
  }, [isActive, ref])
}
```

### Зависимости

- **lucide-react**: X, Check, CheckCircle, XCircle, AlertTriangle, Info
- **React 19.1.0**: createPortal, forwardRef
- **Tailwind CSS 4.0**: Стилизация
- **@headlessui/react** (опционально): Transition для анимаций

### Technical Constraints

- **TypeScript**: Строгая типизация всех props
- **Accessibility**: WCAG 2.1 AA compliance
- **Performance**: Lazy loading для модальных окон
- **Browser Support**: Chrome, Firefox, Safari, Edge
- **Body scroll lock**: Предотвращение скролла при открытом модале
- **Modal stacking**: При открытии нескольких модалов одновременно, каждый следующий отображается поверх предыдущего. Закрытие происходит в обратном порядке (LIFO). Рекомендуется избегать вложенных модалов где возможно.

### Z-Index система

```typescript
// Централизованная система z-index для модальных компонентов
const Z_INDEX = {
  modal: 50,           // Backdrop модального окна
  modalContent: 51,    // Контент модального окна
  toast: 100,          // Toast уведомления (всегда поверх модалов)
}
```

### Integration Notes

ToastProvider должен быть добавлен в root layout:

```typescript
// app/layout.tsx
import { ToastProvider } from '@/components/ui/Toast'

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        <ToastProvider>
          {children}
        </ToastProvider>
      </body>
    </html>
  )
}
```

Использование useToast:

```typescript
// В любом компоненте
const { toast, success, error } = useToast()

// Вызов
success('Товар добавлен в корзину')
error('Ошибка при оформлении заказа')
toast({ variant: 'info', title: 'Информация', message: 'Текст' })
```

## Testing

**Test file locations:**
- `frontend/src/components/ui/Modal/__tests__/Modal.test.tsx`
- `frontend/src/components/ui/Toast/__tests__/Toast.test.tsx`
- `frontend/src/components/ui/Toast/__tests__/ToastProvider.test.tsx`
- `frontend/src/components/ui/ConfirmDialog/__tests__/ConfirmDialog.test.tsx`
- `frontend/src/components/business/SizeChartModal/__tests__/SizeChartModal.test.tsx`

**Testing frameworks** [Source: CLAUDE.md]:
- Vitest 2.1.5 для unit тестов
- @testing-library/react 16.3.0 для компонентных тестов

**Test standards:**
- Каждый компонент тестируется отдельно
- Тестировать все interactive states
- Тестировать keyboard navigation
- Тестировать accessibility атрибуты
- Тестировать edge cases

**Coverage requirements:**
- Минимум 80% покрытие для всех компонентов

**Test commands:**
```bash
# Запуск тестов
npm test

# Запуск тестов с покрытием
npm run test:coverage

# Запуск конкретного теста
npx vitest run src/components/ui/Modal/__tests__/Modal.test.tsx
```

**Пример теста Modal:**
```typescript
// Modal.test.tsx
import { render, screen, fireEvent } from '@testing-library/react'
import userEvent from '@testing-library/user-event'
import { Modal } from '../Modal'

describe('Modal', () => {
  const onClose = vi.fn()

  beforeEach(() => {
    onClose.mockClear()
  })

  it('renders when open', () => {
    render(
      <Modal isOpen={true} onClose={onClose} title="Test Modal">
        <p>Modal content</p>
      </Modal>
    )

    expect(screen.getByRole('dialog')).toBeInTheDocument()
    expect(screen.getByText('Test Modal')).toBeInTheDocument()
    expect(screen.getByText('Modal content')).toBeInTheDocument()
  })

  it('does not render when closed', () => {
    render(
      <Modal isOpen={false} onClose={onClose} title="Test Modal">
        <p>Modal content</p>
      </Modal>
    )

    expect(screen.queryByRole('dialog')).not.toBeInTheDocument()
  })

  it('closes on backdrop click', async () => {
    render(
      <Modal isOpen={true} onClose={onClose} title="Test Modal">
        <p>Modal content</p>
      </Modal>
    )

    const backdrop = screen.getByTestId('modal-backdrop')
    await userEvent.click(backdrop)
    expect(onClose).toHaveBeenCalled()
  })

  it('closes on Escape key', async () => {
    render(
      <Modal isOpen={true} onClose={onClose} title="Test Modal">
        <p>Modal content</p>
      </Modal>
    )

    await userEvent.keyboard('{Escape}')
    expect(onClose).toHaveBeenCalled()
  })

  it('closes on close button click', async () => {
    render(
      <Modal isOpen={true} onClose={onClose} title="Test Modal">
        <p>Modal content</p>
      </Modal>
    )

    const closeButton = screen.getByLabelText('Close modal')
    await userEvent.click(closeButton)
    expect(onClose).toHaveBeenCalled()
  })

  it('has correct accessibility attributes', () => {
    render(
      <Modal isOpen={true} onClose={onClose} title="Test Modal">
        <p>Modal content</p>
      </Modal>
    )

    const dialog = screen.getByRole('dialog')
    expect(dialog).toHaveAttribute('aria-modal', 'true')
    expect(dialog).toHaveAttribute('aria-labelledby')
  })

  it('traps focus inside modal', async () => {
    render(
      <Modal isOpen={true} onClose={onClose} title="Test Modal">
        <button>First</button>
        <button>Second</button>
      </Modal>
    )

    const firstButton = screen.getByText('First')
    const secondButton = screen.getByText('Second')

    firstButton.focus()
    await userEvent.tab()
    expect(secondButton).toHaveFocus()

    await userEvent.tab()
    // Should cycle back (to close button or first element)
  })
})
```

**Пример теста ToastProvider:**
```typescript
// ToastProvider.test.tsx
import { render, screen, act } from '@testing-library/react'
import { ToastProvider, useToast } from '../ToastProvider'

const TestComponent = () => {
  const { success, error, dismiss } = useToast()

  return (
    <div>
      <button onClick={() => success('Success message')}>Show Success</button>
      <button onClick={() => error('Error message')}>Show Error</button>
    </div>
  )
}

describe('ToastProvider', () => {
  it('shows success toast', async () => {
    render(
      <ToastProvider>
        <TestComponent />
      </ToastProvider>
    )

    await act(async () => {
      screen.getByText('Show Success').click()
    })

    expect(screen.getByText('Success message')).toBeInTheDocument()
  })

  it('shows error toast', async () => {
    render(
      <ToastProvider>
        <TestComponent />
      </ToastProvider>
    )

    await act(async () => {
      screen.getByText('Show Error').click()
    })

    expect(screen.getByText('Error message')).toBeInTheDocument()
  })

  it('auto-dismisses toast after duration', async () => {
    vi.useFakeTimers()

    render(
      <ToastProvider>
        <TestComponent />
      </ToastProvider>
    )

    await act(async () => {
      screen.getByText('Show Success').click()
    })

    expect(screen.getByText('Success message')).toBeInTheDocument()

    await act(async () => {
      vi.advanceTimersByTime(5000)
    })

    expect(screen.queryByText('Success message')).not.toBeInTheDocument()

    vi.useRealTimers()
  })
})
```

## Change Log

| Date       | Version | Description                              | Author       |
|------------|---------|------------------------------------------|--------------|
| 2025-11-19 | 1.0     | Создание story на основе Epic 12.6       | Bob (SM)     |
| 2025-11-19 | 1.1     | Валидация PO: добавлены body scroll lock, aria-describedby, z-index система, modal stacking, исправлен путь useFocusTrap | Sarah (PO)   |

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_To be filled by QA agent_
