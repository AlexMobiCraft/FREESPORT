# Story 12.5: Блок рекомендаций похожих товаров

## Status
Draft

## Story
**Как** покупатель,
**Я хочу** видеть рекомендации похожих товаров,
**Чтобы** найти альтернативы или дополнить свой заказ.

## Acceptance Criteria
1. Секция "Похожие товары" отображается под основным контентом
2. Показывается 6 товаров в горизонтальной галерее
3. Используется компонент RecommendationsRow из дизайн-системы
4. Карточки товаров содержат: изображение, название, цену, рейтинг
5. При клике на карточку — переход на страницу товара
6. Данные загружаются из поля `related_products` API `/products/{id}`
7. Если похожих товаров нет — секция скрывается

## Tasks / Subtasks

- [ ] Создать компонент RelatedProducts (AC: 1, 2, 7)
  - [ ] Создать `src/components/product/RelatedProducts.tsx`
  - [ ] Проверить наличие related_products в данных
  - [ ] Если пусто — вернуть null (не рендерить секцию)
  - [ ] Заголовок секции: "Похожие товары" (typography: title-m)
  - [ ] Обёртка с отступами: padding 32px 0

- [ ] Использовать RecommendationsRow компонент (AC: 3)
  - [ ] Импортировать RecommendationsRow из дизайн-системы
  - [ ] Передать related_products как props
  - [ ] Настроить maxVisibleCards: 6
  - [ ] cardGap: 16px, cardWidth: 180px

- [ ] Реализовать ProductCard компонент (AC: 4)
  - [ ] Создать `src/components/product/ProductCard.tsx` (если еще не создан)
  - [ ] Отобразить изображение товара (180x180px)
  - [ ] Название товара (typography: body-m, 2 lines ellipsis)
  - [ ] Цена (typography: body-m, font-weight 600)
  - [ ] Рейтинг (Star иконки + reviews_count, caption)
  - [ ] Badge (hit/new/sale) если доступен

- [ ] Навигация по товарам (AC: 5)
  - [ ] Обернуть карточку в Link (Next.js)
  - [ ] href: `/product/${product.slug}`
  - [ ] Hover effect: shadow-hover, transform translateY(-2px)
  - [ ] Transition: duration-120

- [ ] Scroll behavior для горизонтальной галереи (AC: 2)
  - [ ] Overflow-x: scroll
  - [ ] Scroll-snap-type: x mandatory
  - [ ] Scroll-snap-align: start для карточек
  - [ ] Скрыть scrollbar (scrollbar-hide)

- [ ] Адаптивность для mobile
  - [ ] Mobile: показывать 2-3 карточки с swipe
  - [ ] Tablet: показывать 4 карточки
  - [ ] Desktop: показывать 6 карточек
  - [ ] Touch gestures для навигации

- [ ] Написать unit тесты
  - [ ] Тест рендеринга секции с похожими товарами
  - [ ] Тест скрытия секции если related_products пуст
  - [ ] Тест отображения 6 карточек
  - [ ] Тест навигации по клику на карточку
  - [ ] Тест hover эффектов

## Dev Notes

### Relevant Source Tree
```
frontend/src/
├── components/
│   └── product/
│       ├── RelatedProducts.tsx       (NEW)
│       ├── ProductCard.tsx           (NEW/UPDATE)
│       └── __tests__/
│           ├── RelatedProducts.test.tsx (NEW)
│           └── ProductCard.test.tsx     (NEW)
```

### RelatedProducts Компонент
```typescript
'use client';

import Link from 'next/link';
import { Product } from '@/types/product';
import ProductCard from './ProductCard';

interface RelatedProductsProps {
  products: Product[];
}

export default function RelatedProducts({ products }: RelatedProductsProps) {
  if (!products || products.length === 0) {
    return null;
  }

  return (
    <section className="py-8 bg-canvas">
      <div className="container mx-auto px-6">
        <h2 className="text-title-m text-primary mb-6">Похожие товары</h2>

        <div className="flex gap-4 overflow-x-scroll scrollbar-hide snap-x snap-mandatory">
          {products.slice(0, 6).map((product) => (
            <Link
              key={product.id}
              href={`/product/${product.slug}`}
              className="flex-shrink-0 w-[180px] snap-start"
            >
              <ProductCard product={product} />
            </Link>
          ))}
        </div>
      </div>
    </section>
  );
}
```

### ProductCard Компонент
```typescript
'use client';

import Image from 'next/image';
import { Star } from 'lucide-react';
import { Product } from '@/types/product';
import Badge from '@/components/ui/Badge';

interface ProductCardProps {
  product: Product;
}

export default function ProductCard({ product }: ProductCardProps) {
  return (
    <div className="bg-white rounded-md shadow-default hover:shadow-hover hover:-translate-y-0.5 transition-all duration-120 p-3">
      {/* Image */}
      <div className="relative w-full h-[180px] rounded-md overflow-hidden mb-3">
        <Image
          src={product.images[0]?.image || '/placeholder-product.png'}
          alt={product.name}
          fill
          className="object-cover"
          sizes="180px"
        />
      </div>

      {/* Title */}
      <h3 className="text-body-m text-primary mb-2 line-clamp-2">{product.name}</h3>

      {/* Rating */}
      {product.rating && (
        <div className="flex items-center gap-1 mb-2">
          <Star size={12} className="text-warning fill-warning" />
          <span className="text-caption text-secondary">
            {product.rating} ({product.reviews_count})
          </span>
        </div>
      )}

      {/* Price */}
      <p className="text-body-m font-semibold text-primary mb-2">
        {product.price.current.toLocaleString('ru-RU')} ₽
      </p>

      {/* Badge */}
      {product.badge && (
        <Badge variant={product.badge} />
      )}
    </div>
  );
}
```

### Дизайн-система спецификация
**RecommendationsRow:**
- layout: Горизонтальная галерея на 6 карточек с scroll-snap
- cardSpacing: 16px
- sectionPadding: 32px 24px
- titleStyle: title-m
- background: transparent

**ProductCard tokens:**
- maxVisibleCards: 6
- cardGap: 16px
- cardWidth: 180px
- rating: caption
- badge: component Badge, supportedVariants: hit, new, promo, sale

### API Data
Данные берутся из `product.related_products` массива:
```typescript
related_products: Product[];  // Массив из Product schema
```

### Важные замечания
- Если related_products пустой — не рендерить секцию вообще
- Ограничить до 6 товаров (slice(0, 6))
- Использовать scroll-snap для плавной навигации
- Lazy loading для изображений карточек
- Hover эффекты: shadow + translateY

### Testing

#### Test file location
- `src/components/product/__tests__/RelatedProducts.test.tsx`
- `src/components/product/__tests__/ProductCard.test.tsx`

#### Test cases
```typescript
describe('RelatedProducts', () => {
  it('renders section with related products', () => {});
  it('hides section when no related products', () => {});
  it('shows maximum 6 products', () => {});
  it('navigates to product page on card click', () => {});
});

describe('ProductCard', () => {
  it('renders product image', () => {});
  it('renders product name with ellipsis', () => {});
  it('renders price', () => {});
  it('renders rating if available', () => {});
  it('renders badge if available', () => {});
  it('applies hover effects', () => {});
});
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-30 | 1.0 | Создание story 12.5 на основе Epic 12 | Sarah (PO) |

## Dev Agent Record
(Заполняется dev-агентом)

## QA Results
(Заполняется QA-агентом)
