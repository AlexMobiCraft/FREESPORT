# Story 13.4: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ production

## Status
Draft

## Story
**–ö–∞–∫** DevOps –∏–Ω–∂–µ–Ω–µ—Ä,
**–Ø —Ö–æ—á—É** –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é production –ë–î —Å backup –∏ rollback –ø–ª–∞–Ω–æ–º,
**–ß—Ç–æ–±—ã** –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤–Ω–µ–¥—Ä–∏—Ç—å ProductVariant –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö.

## Acceptance Criteria

1. Pre-migration backup –ë–î —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ `pg_dump` (NFR3)
2. –ú–∏–≥—Ä–∞—Ü–∏—è Django –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤ production –±–µ–∑ –æ—à–∏–±–æ–∫
3. –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ Products –æ—á–∏—â–µ–Ω—ã —á–µ—Ä–µ–∑ management command
4. –ü–æ–ª–Ω—ã–π –∏–º–ø–æ—Ä—Ç –∫–∞—Ç–∞–ª–æ–≥–∞ –∏–∑ 1–° –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
5. –í–∞–ª–∏–¥–∞—Ü–∏—è: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö Product –∏ ProductVariant —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É
6. Rollback –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ staging
7. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: migration guide, admin guide (NFR9)

## Integration Verification
- IV1: –¢–∞–±–ª–∏—Ü—ã orders, order_items, cart_items –æ—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- IV2: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∑–∞–∫–∞–∑—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- IV3: API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

## Tasks / Subtasks

- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ staging environment (AC: 6)
  - [ ] –°–æ–∑–¥–∞—Ç—å –∫–æ–ø–∏—é production –ë–î –Ω–∞ staging
  - [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å backup –Ω–∞ staging: `pg_restore`
  - [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ staging –∏–¥–µ–Ω—Ç–∏—á–µ–Ω production

- [ ] –¢–µ—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ staging (AC: 2, 6)
  - [ ] Deploy –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –∫–æ–¥–∞ –Ω–∞ staging
  - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ Django: `python manage.py migrate`
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–∏
  - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç –∏–∑ 1–°: `python manage.py import_products_from_1c`
  - [ ] –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ Product –∏ ProductVariant

- [ ] –¢–µ—Å—Ç rollback –Ω–∞ staging (AC: 6)
  - [ ] –°–æ–∑–¥–∞—Ç—å backup staging –ë–î –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏
  - [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å rollback: restore from pre-migration backup
  - [ ] Revert code –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É release
  - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É API
  - [ ] –ò–∑–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è rollback (~15 min —Å–æ–≥–ª–∞—Å–Ω–æ PRD)

- [ ] –°–æ–∑–¥–∞–Ω–∏–µ pre-migration backup production (AC: 1, NFR3)
  - [ ] –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Celery workers (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è backup)
  - [ ] –°–æ–∑–¥–∞—Ç—å backup –ë–î: `pg_dump -Fc freesport_prod > backup_pre_migration_YYYYMMDD.dump`
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä backup —Ñ–∞–π–ª–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º)
  - [ ] –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å backup –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (S3/–¥—Ä—É–≥–æ–µ)
  - [ ] –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Celery workers

- [ ] Production deployment (AC: 2, 3, 4)
  - [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å maintenance mode (2AM-4AM window)
  - [ ] Deploy –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –∫–æ–¥–∞
  - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ Django: `python manage.py migrate`
  - [ ] –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ: `python manage.py flush_products` (management command)
  - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π –∏–º–ø–æ—Ä—Ç –∏–∑ 1–°: `python manage.py import_products_from_1c --full`
  - [ ] –°–Ω—è—Ç—å maintenance mode

- [ ] Post-migration validation (AC: 5, IV1, IV2, IV3)
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ Product –≤ –ë–î —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ ProductVariant —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É
  - [ ] Smoke test API endpoints:
    - GET `/products/` - —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
    - GET `/products/{slug}/` - –¥–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞ —Å variants
    - GET `/categories/` - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  - [ ] IV1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã orders, order_items, cart_items –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã
  - [ ] IV2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ User –∏ Order –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
  - [ ] IV3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å frontend –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏

- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ post-migration (24h)
  - [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ error rate –≤ –ª–æ–≥–∞—Ö (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å < 1%)
  - [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ response time API (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å < 500ms)
  - [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ CPU/Memory (–¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã)
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Slack #tech-alerts –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (AC: 7, NFR9)
  - [ ] Migration Guide –¥–ª—è dev team:
    - –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
    - Rollback –ø—Ä–æ—Ü–µ–¥—É—Ä–∞
    - Troubleshooting
  - [ ] Admin Guide –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
    - –ö–∞–∫ –∑–∞–ø–æ–ª–Ω—è—Ç—å ColorMapping
    - –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–ø–æ—Ä—Ç –∏–∑ 1–°
    - FAQ –ø–æ ProductVariant

- [ ] –°–æ–∑–¥–∞–Ω–∏–µ management command flush_products (AC: 3)
  - [ ] –°–æ–∑–¥–∞—Ç—å `apps/products/management/commands/flush_products.py`
  - [ ] –û—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü: Product, ProductVariant, ColorMapping (–∫—Ä–æ–º–µ 20 –±–∞–∑–æ–≤—ã—Ö —Ü–≤–µ—Ç–æ–≤)
  - [ ] –î–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ `--confirm` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  - [ ] –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π

## Dev Notes

### Relevant Source Tree
```
backend/apps/products/
‚îú‚îÄ‚îÄ management/commands/
‚îÇ   ‚îî‚îÄ‚îÄ flush_products.py       (NEW - –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

docs/
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îú‚îÄ‚îÄ migration-guide.md      (NEW - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è dev team)
‚îÇ   ‚îî‚îÄ‚îÄ admin-guide.md          (NEW - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤)

scripts/
‚îú‚îÄ‚îÄ backup_production_db.sh     (NEW - —Å–∫—Ä–∏–ø—Ç backup –ë–î)
‚îî‚îÄ‚îÄ rollback_production.sh      (NEW - —Å–∫—Ä–∏–ø—Ç rollback)
```

### Pre-Migration Backup Script

**backup_production_db.sh:**

```bash
#!/bin/bash
# Backup production –ë–î –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π

set -e

BACKUP_DIR="/backups/freesport"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/backup_pre_migration_$TIMESTAMP.dump"

echo "=== Starting production backup ==="
echo "Timestamp: $TIMESTAMP"

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Celery workers
echo "Stopping Celery workers..."
supervisorctl stop celery:*

# –°–æ–∑–¥–∞—Ç—å backup
echo "Creating backup..."
pg_dump -h localhost -U freesport_user -Fc freesport_prod > "$BACKUP_FILE"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä backup
BACKUP_SIZE=$(du -h "$BACKUP_FILE" | cut -f1)
echo "Backup created: $BACKUP_FILE ($BACKUP_SIZE)"

# –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ S3 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# aws s3 cp "$BACKUP_FILE" s3://freesport-backups/

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Celery
echo "Restarting Celery workers..."
supervisorctl start celery:*

echo "=== Backup completed successfully ==="
```

### Rollback Script

**rollback_production.sh:**

```bash
#!/bin/bash
# Rollback production –∫ pre-migration —Å–æ—Å—Ç–æ—è–Ω–∏—é

set -e

BACKUP_FILE=$1

if [ -z "$BACKUP_FILE" ]; then
  echo "Usage: ./rollback_production.sh <backup_file>"
  exit 1
fi

echo "=== Starting rollback ==="
echo "Backup file: $BACKUP_FILE"

# –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
read -p "Are you sure you want to rollback? (yes/no): " CONFIRM
if [ "$CONFIRM" != "yes" ]; then
  echo "Rollback cancelled"
  exit 0
fi

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
echo "Stopping application..."
supervisorctl stop freesport:*

# Restore –ë–î
echo "Restoring database..."
dropdb freesport_prod
createdb freesport_prod
pg_restore -h localhost -U freesport_user -d freesport_prod "$BACKUP_FILE"

# Revert code –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É release
echo "Reverting code..."
cd /var/www/freesport
git checkout <previous-release-tag>

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
echo "Restarting application..."
supervisorctl start freesport:*

echo "=== Rollback completed successfully ==="
echo "Total time: ~15 minutes"
```

### Management Command: flush_products

**apps/products/management/commands/flush_products.py:**

```python
from django.core.management.base import BaseCommand
from apps.products.models import Product, ProductVariant, ColorMapping

class Command(BaseCommand):
    help = 'Flush —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö Products –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π'

    def add_arguments(self, parser):
        parser.add_argument(
            '--confirm',
            action='store_true',
            help='–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)',
        )

    def handle(self, *args, **options):
        if not options['confirm']:
            self.stdout.write(
                self.style.ERROR('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ: --confirm')
            )
            return

        # –£–¥–∞–ª–∏—Ç—å ProductVariant
        variant_count = ProductVariant.objects.count()
        ProductVariant.objects.all().delete()
        self.stdout.write(f'Deleted {variant_count} ProductVariants')

        # –£–¥–∞–ª–∏—Ç—å Products
        product_count = Product.objects.count()
        Product.objects.all().delete()
        self.stdout.write(f'Deleted {product_count} Products')

        # ColorMapping –ù–ï —É–¥–∞–ª—è–µ–º (20 –±–∞–∑–æ–≤—ã—Ö —Ü–≤–µ—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è)
        color_count = ColorMapping.objects.count()
        self.stdout.write(f'Kept {color_count} ColorMappings')

        self.stdout.write(self.style.SUCCESS('Flush completed successfully'))
```

### Migration Timeline (Production Deployment)

**Deployment Window: 2AM-4AM MSK (—Å–æ–≥–ª–∞—Å–Ω–æ PRD Section 4.4):**

| Time | Action | Duration | Owner |
|------|--------|----------|-------|
| 01:45 | Pre-deployment meeting | 15 min | Team |
| 02:00 | Enable maintenance mode | 2 min | DevOps |
| 02:02 | Create pre-migration backup | 10 min | DevOps |
| 02:12 | Deploy new code | 5 min | DevOps |
| 02:17 | Run Django migrations | 3 min | DevOps |
| 02:20 | Flush old products | 2 min | DevOps |
| 02:22 | Import catalog from 1C | 30 min | Backend |
| 02:52 | Post-migration validation | 5 min | QA |
| 02:57 | Disable maintenance mode | 2 min | DevOps |
| 02:59 | Smoke tests | 10 min | QA |
| 03:09 | Monitoring setup | 5 min | DevOps |
| 03:14 | **Deployment complete** | - | - |

**Total deployment time:** ~1h 15min (buffer –¥–æ 4AM)

### Validation Queries

**SQL queries –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–∏:**

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ Products
SELECT COUNT(*) FROM products;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ ProductVariants
SELECT COUNT(*) FROM product_variants;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Products –Ω–µ –∏–º–µ—é—Ç —Ü–µ–Ω/–æ—Å—Ç–∞—Ç–∫–æ–≤
SELECT column_name FROM information_schema.columns
WHERE table_name = 'products'
  AND column_name IN ('retail_price', 'stock_quantity');
-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã orders/cart_items –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
SELECT COUNT(*) FROM orders;
SELECT COUNT(*) FROM cart_items;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ColorMapping
SELECT COUNT(*) FROM color_mappings;
-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å >= 20
```

### Rollback Decision Matrix

**–ö–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å rollback:**

| –ü—Ä–æ–±–ª–µ–º–∞ | Severity | Rollback? | Action |
|----------|----------|-----------|--------|
| –ú–∏–≥—Ä–∞—Ü–∏—è Django failed | üî¥ Critical | ‚úÖ YES | Immediate rollback |
| –ò–º–ø–æ—Ä—Ç 1–° failed | üî¥ Critical | ‚úÖ YES | Rollback + investigate |
| Response time > 1000ms | üü° High | ‚ö†Ô∏è MAYBE | Monitor 1h, then decide |
| Error rate > 5% | üî¥ Critical | ‚úÖ YES | Immediate rollback |
| Error rate 1-5% | üü° High | ‚ö†Ô∏è MAYBE | Monitor + hotfix |
| Missing ColorMapping | üü¢ Low | ‚ùå NO | Hotfix (add colors) |

### Documentation Structure

#### Migration Guide (migration-guide.md)

```markdown
# Migration Guide: ProductVariant System

## Pre-Migration Checklist
- [ ] Staging migration tested
- [ ] Rollback tested on staging
- [ ] Backup created
- [ ] Team notified

## Migration Steps
1. Enable maintenance mode
2. Create backup
3. Deploy code
4. Run migrations
5. Flush old products
6. Import from 1C
7. Validate
8. Disable maintenance mode

## Rollback Procedure
1. Stop application
2. Restore database from backup
3. Revert code
4. Restart application

## Troubleshooting
...
```

#### Admin Guide (admin-guide.md)

```markdown
# Admin Guide: ProductVariant Management

## ColorMapping Administration

### Adding New Color
1. Open Django Admin
2. Navigate to Products ‚Üí Color Mappings
3. Click "Add Color Mapping"
4. Enter name (from 1C) and hex code
5. Save

### Checking Import Status
1. Check logs: /var/log/freesport/import_products.log
2. Verify count: Products vs ProductVariants
3. Check warnings for missing colors

## FAQ
...
```

### Testing Standards

**–ò–∑ CLAUDE.md Section: –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

#### Test environments
- **Staging:** –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ + rollback
- **Production:** Smoke tests –ø–æ—Å–ª–µ deployment

#### Validation checklist
- [ ] –ë–î backup —Å–æ–∑–¥–∞–Ω –∏ –≤–∞–ª–∏–¥–µ–Ω
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –ò–º–ø–æ—Ä—Ç –∏–∑ 1–° –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ
- [ ] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ Product/ProductVariant —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É
- [ ] API endpoints –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [ ] Frontend –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤
- [ ] Rollback –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-30 | 1.0 | –°–æ–∑–¥–∞–Ω–∏–µ Story 13.4 –Ω–∞ –æ—Å–Ω–æ–≤–µ Epic 13 PRD | Sarah (PO) |

## Dev Agent Record
(–ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è dev-–∞–≥–µ–Ω—Ç–æ–º)

## QA Results
(–ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è QA-–∞–≥–µ–Ω—Ç–æ–º)
