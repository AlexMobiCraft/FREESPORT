# Story 13.5b: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ProductOptions —Å —Ä–µ–∞–ª—å–Ω—ã–º API

## Status
Ready for Review

## Story
**–ö–∞–∫** Frontend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫,
**–Ø —Ö–æ—á—É** –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å ProductOptions —Å —Ä–µ–∞–ª—å–Ω—ã–º API `/products/{slug}/`,
**–ß—Ç–æ–±—ã** –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–∞ –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å Story 12.2.

## Acceptance Criteria

1. ProductOptions –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API –≤–º–µ—Å—Ç–æ MSW mock
2. –¢–∏–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ `api.generated.ts` –ø–æ—Å–ª–µ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ OpenAPI
3. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ü–≤–µ—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ ProductGallery (FR10, AC4)
4. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–ø—Ü–∏–π –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞–ª–∏—á–∏–∏ –∏ —Ü–µ–Ω–µ –≤ ProductSummary
5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ProductSummary: –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è `selectedVariant` —á–µ—Ä–µ–∑ props
6. –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –æ–ø—Ü–∏–π –ø–µ—Ä–µ–¥ "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É" (FR10, AC7)
7. –ù–∞–ø–∏—Å–∞–Ω—ã integration —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º API

## Integration Verification
- IV1: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å API –¥–∞–Ω–Ω—ã–º–∏ (–Ω–µ—Ç –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤)
- IV2: ProductGallery –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ü–≤–µ—Ç–∞
- IV3: ProductSummary –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–µ–Ω—É –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞

## Tasks / Subtasks

- [x] –û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã –∏–∑ api.generated.ts (AC: 2)
  - [x] –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run generate:types` –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è OpenAPI
  - [x] –ó–∞–º–µ–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã `ProductVariant` –Ω–∞ `import { ProductVariant } from '@/types/api.generated'`
  - [x] –û–±–Ω–æ–≤–∏—Ç—å `ProductDetail` —Å –ø–æ–ª–µ–º `variants: ProductVariant[]`
  - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–∏–ø—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç API schema

- [x] –ó–∞–º–µ–Ω–∏—Ç—å MSW mock –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π API (AC: 1)
  - [x] –£–¥–∞–ª–∏—Ç—å MSW mock –¥–ª—è `/products/{slug}/` (–∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤)
  - [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π fetch –∫ `/api/products/{slug}/`
  - [x] –û–±—Ä–∞–±–æ—Ç–∞—Ç—å loading state –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
  - [x] –û–±—Ä–∞–±–æ—Ç–∞—Ç—å error state –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ProductGallery (AC: 3, IV2)
  - [x] –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ü–≤–µ—Ç–∞ –≤—ã–∑–≤–∞—Ç—å callback `onColorChange(color: string)`
  - [x] ProductGallery –ø–æ–ª—É—á–∞–µ—Ç callback –∏ –Ω–∞—Ö–æ–¥–∏—Ç variant —Å —ç—Ç–∏–º —Ü–≤–µ—Ç–æ–º
  - [x] –û–±–Ω–æ–≤–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: `setMainImage(variant.main_image)`
  - [x] –û–±–Ω–æ–≤–∏—Ç—å –≥–∞–ª–µ—Ä–µ—é: `setGalleryImages(variant.gallery_images)`

- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ProductSummary (AC: 4, 5, IV3)
  - [x] ProductSummary –ø–æ–ª—É—á–∞–µ—Ç `selectedOptions` —á–µ—Ä–µ–∑ props
  - [x] –ù–∞–π—Ç–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π variant –ø–æ color + size:
    ```typescript
    const selectedVariant = variants.find(
      v => v.color_name === selectedOptions.color &&
           v.size_value === selectedOptions.size
    );
    ```
  - [x] –ü–µ—Ä–µ–¥–∞—Ç—å `selectedVariant` –≤ ProductSummary
  - [x] –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—É: `selectedVariant?.current_price`
  - [x] –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ: `selectedVariant?.is_in_stock`
  - [x] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: `selectedVariant?.available_quantity`

- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –æ–ø—Ü–∏–π (AC: 6)
  - [ ] –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `validateOptions(selectedOptions, variants)`:
    ```typescript
    function validateOptions(
      selectedOptions: SelectedOptions,
      variants: ProductVariant[]
    ): { valid: boolean; message?: string } {
      const sizes = [...new Set(variants.map(v => v.size_value).filter(Boolean))];
      const colors = [...new Set(variants.map(v => v.color_name).filter(Boolean))];

      if (sizes.length > 0 && !selectedOptions.size) {
        return { valid: false, message: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä' };
      }

      if (colors.length > 0 && !selectedOptions.color) {
        return { valid: false, message: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç' };
      }

      return { valid: true };
    }
    ```
  - [x] –í—ã–∑–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–µ—Ä–µ–¥ "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É" –≤ ProductSummary
  - [x] –ü–æ–∫–∞–∑–∞—Ç—å error message –µ—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞
  - [x] –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É" –µ—Å–ª–∏ –æ–ø—Ü–∏–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã

- [x] –û–±–Ω–æ–≤–∏—Ç—å ProductSummary –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (AC: 4, 5, 6)
  - [ ] –î–æ–±–∞–≤–∏—Ç—å props:
    ```typescript
    interface ProductSummaryProps {
      product: ProductDetail;
      selectedVariant: ProductVariant | null;
      onAddToCart: (variantId: number) => void;
    }
    ```
  - [x] –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ü–µ–Ω—É –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞: `selectedVariant?.current_price || '–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏–∏'`
  - [x] –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ: `selectedVariant?.is_in_stock ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'`
  - [x] –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É" disabled –µ—Å–ª–∏ `!selectedVariant || !selectedVariant.is_in_stock`

- [x] –ù–∞–ø–∏—Å–∞—Ç—å integration —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º API (AC: 7)
  - [x] –¢–µ—Å—Ç: ProductOptions –∑–∞–≥—Ä—É–∂–∞–µ—Ç variants –∏–∑ API
  - [x] –¢–µ—Å—Ç: –≤—ã–±–æ—Ä —Ü–≤–µ—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç ProductGallery –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
  - [x] –¢–µ—Å—Ç: –≤—ã–±–æ—Ä size/color –æ–±–Ω–æ–≤–ª—è–µ—Ç ProductSummary —Ü–µ–Ω—É
  - [x] –¢–µ—Å—Ç: –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç error –µ—Å–ª–∏ –æ–ø—Ü–∏–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã
  - [x] –¢–µ—Å—Ç: –∫–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É" disabled –µ—Å–ª–∏ –Ω–µ—Ç selectedVariant
  - [x] –¢–µ—Å—Ç: –≤—ã–±–æ—Ä –≤—Å–µ—Ö –æ–ø—Ü–∏–π —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É"

- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ Integration Verification (IV1, IV2, IV3)
  - [x] IV1: –ù–µ—Ç TypeScript –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ ProductVariant –∏–∑ api.generated.ts
  - [x] IV2: ProductGallery –º–µ–Ω—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ü–≤–µ—Ç–∞
  - [x] IV3: ProductSummary –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–µ–Ω—É –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞

## Dev Notes

### Relevant Source Tree
```
frontend/src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ product/
‚îÇ       ‚îú‚îÄ‚îÄ ProductOptions.tsx       (UPDATE - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å api.generated types)
‚îÇ       ‚îú‚îÄ‚îÄ ProductSummary.tsx       (UPDATE - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å selectedVariant)
‚îÇ       ‚îú‚îÄ‚îÄ ProductGallery.tsx       (UPDATE - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
‚îÇ       ‚îî‚îÄ‚îÄ __tests__/
‚îÇ           ‚îú‚îÄ‚îÄ ProductOptions.test.tsx     (UPDATE - integration —Ç–µ—Å—Ç—ã)
‚îÇ           ‚îî‚îÄ‚îÄ ProductSummary.test.tsx     (UPDATE)
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ api.generated.ts             (READ - –ø–æ—Å–ª–µ npm run generate:types)
‚îî‚îÄ‚îÄ services/
    ‚îî‚îÄ‚îÄ productsService.ts           (READ - fetch API)
```

### ProductPage Integration

**–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞:**

```typescript
// app/catalog/[category]/[slug]/page.tsx
'use client';

import { useState, useEffect } from 'react';
import { ProductOptions, SelectedOptions } from '@/components/product/ProductOptions';
import { ProductSummary } from '@/components/product/ProductSummary';
import { ProductGallery } from '@/components/product/ProductGallery';
import { ProductDetail, ProductVariant } from '@/types/api.generated';

export default function ProductPage({ params }: { params: { slug: string } }) {
  const [product, setProduct] = useState<ProductDetail | null>(null);
  const [selectedOptions, setSelectedOptions] = useState<SelectedOptions>({});
  const [selectedVariant, setSelectedVariant] = useState<ProductVariant | null>(null);

  // Fetch product data
  useEffect(() => {
    fetch(`/api/products/${params.slug}/`)
      .then(res => res.json())
      .then(data => setProduct(data));
  }, [params.slug]);

  // –ù–∞–π—Ç–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π variant –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ–ø—Ü–∏–π
  useEffect(() => {
    if (!product || !selectedOptions.color || !selectedOptions.size) {
      setSelectedVariant(null);
      return;
    }

    const variant = product.variants.find(
      v => v.color_name === selectedOptions.color &&
           v.size_value === selectedOptions.size
    );

    setSelectedVariant(variant || null);
  }, [selectedOptions, product]);

  if (!product) return <div>Loading...</div>;

  return (
    <div className="container mx-auto">
      <div className="grid grid-cols-2 gap-8">
        {/* Gallery */}
        <ProductGallery
          product={product}
          selectedVariant={selectedVariant}
        />

        {/* Summary + Options */}
        <div className="space-y-6">
          <ProductSummary
            product={product}
            selectedVariant={selectedVariant}
          />

          <ProductOptions
            variants={product.variants}
            selectedOptions={selectedOptions}
            onSelectionChange={setSelectedOptions}
          />
        </div>
      </div>
    </div>
  );
}
```

### ProductGallery Update

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ —Ü–≤–µ—Ç–∞:**

```typescript
// src/components/product/ProductGallery.tsx
'use client';

import { useState, useEffect } from 'react';
import { ProductDetail, ProductVariant } from '@/types/api.generated';

export interface ProductGalleryProps {
  product: ProductDetail;
  selectedVariant: ProductVariant | null;
}

export const ProductGallery: React.FC<ProductGalleryProps> = ({
  product,
  selectedVariant,
}) => {
  const [mainImage, setMainImage] = useState<string>('');
  const [galleryImages, setGalleryImages] = useState<string[]>([]);

  // –û–±–Ω–æ–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ selectedVariant
  useEffect(() => {
    if (selectedVariant?.main_image) {
      setMainImage(selectedVariant.main_image);
      setGalleryImages(selectedVariant.gallery_images || []);
    } else if (product.variants.length > 0) {
      // Fallback –Ω–∞ –ø–µ—Ä–≤—ã–π variant
      const firstVariant = product.variants[0];
      setMainImage(firstVariant.main_image || '');
      setGalleryImages(firstVariant.gallery_images || []);
    }
  }, [selectedVariant, product.variants]);

  return (
    <div className="space-y-4">
      {/* Main image */}
      <div className="aspect-square overflow-hidden rounded-lg">
        <img
          src={mainImage}
          alt={product.name}
          className="w-full h-full object-cover"
        />
      </div>

      {/* Gallery */}
      <div className="grid grid-cols-4 gap-2">
        {galleryImages.map((image, index) => (
          <img
            key={index}
            src={image}
            alt={`${product.name} ${index + 1}`}
            className="aspect-square rounded cursor-pointer hover:opacity-75"
            onClick={() => setMainImage(image)}
          />
        ))}
      </div>
    </div>
  );
};
```

### ProductSummary Update

**–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏ –Ω–∞–ª–∏—á–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞:**

```typescript
// src/components/product/ProductSummary.tsx
'use client';

import { useState } from 'react';
import { ProductDetail, ProductVariant } from '@/types/api.generated';
import { validateOptions } from '@/utils/productValidation';

export interface ProductSummaryProps {
  product: ProductDetail;
  selectedVariant: ProductVariant | null;
}

export const ProductSummary: React.FC<ProductSummaryProps> = ({
  product,
  selectedVariant,
}) => {
  const [error, setError] = useState<string>('');

  const handleAddToCart = () => {
    if (!selectedVariant) {
      setError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ –æ–ø—Ü–∏–∏ —Ç–æ–≤–∞—Ä–∞');
      return;
    }

    if (!selectedVariant.is_in_stock) {
      setError('–í—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
      return;
    }

    // –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
    // ...

    setError('');
  };

  const isAddToCartDisabled = !selectedVariant || !selectedVariant.is_in_stock;

  return (
    <div className="space-y-4">
      <h1 className="text-3xl font-bold">{product.name}</h1>

      {/* –¶–µ–Ω–∞ */}
      <div className="text-2xl font-semibold">
        {selectedVariant ? (
          <span>{selectedVariant.current_price} ‚ÇΩ</span>
        ) : (
          <span className="text-neutral-500">–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏–∏</span>
        )}
      </div>

      {/* –ù–∞–ª–∏—á–∏–µ */}
      <div>
        {selectedVariant ? (
          selectedVariant.is_in_stock ? (
            <span className="text-success">–í –Ω–∞–ª–∏—á–∏–∏: {selectedVariant.available_quantity} —à—Ç.</span>
          ) : (
            <span className="text-error">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
          )
        ) : (
          <span className="text-neutral-500">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –∏ —Ü–≤–µ—Ç</span>
        )}
      </div>

      {/* Error message */}
      {error && (
        <div className="text-error text-sm">{error}</div>
      )}

      {/* –ö–Ω–æ–ø–∫–∞ */}
      <button
        onClick={handleAddToCart}
        disabled={isAddToCartDisabled}
        className="btn btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed"
      >
        –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
      </button>
    </div>
  );
};
```

### Validation Utility

**src/utils/productValidation.ts:**

```typescript
import { ProductVariant, SelectedOptions } from '@/types/api.generated';

export interface ValidationResult {
  valid: boolean;
  message?: string;
}

export function validateOptions(
  selectedOptions: SelectedOptions,
  variants: ProductVariant[]
): ValidationResult {
  // –ò–∑–≤–ª–µ—á—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏
  const sizes = [...new Set(variants.map(v => v.size_value).filter(Boolean))];
  const colors = [...new Set(variants.map(v => v.color_name).filter(Boolean))];

  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏
  if (sizes.length > 0 && !selectedOptions.size) {
    return {
      valid: false,
      message: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä',
    };
  }

  if (colors.length > 0 && !selectedOptions.color) {
    return {
      valid: false,
      message: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç',
    };
  }

  return { valid: true };
}
```

### Integration Tests

**src/components/product/__tests__/ProductOptions.integration.test.tsx:**

```typescript
import { describe, it, expect, beforeEach } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import ProductPage from '@/app/catalog/[category]/[slug]/page';
import { server } from '@/mocks/server';
import { http, HttpResponse } from 'msw';

describe('ProductOptions Integration', () => {
  beforeEach(() => {
    // Setup MSW handler –¥–ª—è —Ç–µ—Å—Ç–æ–≤
    server.use(
      http.get('/api/products/:slug/', () => {
        return HttpResponse.json({
          id: 1,
          name: 'Nike Air Max',
          slug: 'nike-air-max',
          variants: [
            {
              id: 1,
              sku: 'NIKE-AM-RED-42',
              color_name: '–ö—Ä–∞—Å–Ω—ã–π',
              color_hex: '#FF0000',
              size_value: '42',
              current_price: '5990.00',
              is_in_stock: true,
              available_quantity: 15,
              main_image: '/media/nike-red.jpg',
            },
            {
              id: 2,
              sku: 'NIKE-AM-BLUE-42',
              color_name: '–°–∏–Ω–∏–π',
              color_hex: '#0000FF',
              size_value: '42',
              current_price: '5990.00',
              is_in_stock: true,
              available_quantity: 10,
              main_image: '/media/nike-blue.jpg',
            },
          ],
        });
      })
    );
  });

  it('updates ProductGallery image when color changes', async () => {
    render(<ProductPage params={{ slug: 'nike-air-max' }} />);

    await waitFor(() => {
      expect(screen.getByAltText('Nike Air Max')).toBeInTheDocument();
    });

    // –í—ã–±—Ä–∞—Ç—å —Ü–≤–µ—Ç "–°–∏–Ω–∏–π"
    const blueChip = screen.getByText('–°–∏–Ω–∏–π');
    fireEvent.click(blueChip);

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å
    const mainImage = screen.getByAltText('Nike Air Max') as HTMLImageElement;
    expect(mainImage.src).toContain('/media/nike-blue.jpg');
  });

  it('updates ProductSummary price when variant selected', async () => {
    render(<ProductPage params={{ slug: 'nike-air-max' }} />);

    await waitFor(() => {
      expect(screen.getByText('–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏–∏')).toBeInTheDocument();
    });

    // –í—ã–±—Ä–∞—Ç—å —Ä–∞–∑–º–µ—Ä –∏ —Ü–≤–µ—Ç
    fireEvent.click(screen.getByText('42'));
    fireEvent.click(screen.getByText('–ö—Ä–∞—Å–Ω—ã–π'));

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ü–µ–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
    await waitFor(() => {
      expect(screen.getByText('5990.00 ‚ÇΩ')).toBeInTheDocument();
    });
  });

  it('validates required options before add to cart', async () => {
    render(<ProductPage params={{ slug: 'nike-air-max' }} />);

    await waitFor(() => {
      expect(screen.getByText('–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É')).toBeInTheDocument();
    });

    // –ö–Ω–æ–ø–∫–∞ disabled –ø–æ–∫–∞ –æ–ø—Ü–∏–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã
    const addToCartBtn = screen.getByText('–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É');
    expect(addToCartBtn).toBeDisabled();

    // –í—ã–±—Ä–∞—Ç—å –æ–ø—Ü–∏–∏
    fireEvent.click(screen.getByText('42'));
    fireEvent.click(screen.getByText('–ö—Ä–∞—Å–Ω—ã–π'));

    // –ö–Ω–æ–ø–∫–∞ enabled
    await waitFor(() => {
      expect(addToCartBtn).not.toBeDisabled();
    });
  });
});
```

### Testing Standards

**–ò–∑ CLAUDE.md Section: Frontend —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

#### Test file location
- `frontend/src/components/product/__tests__/ProductOptions.integration.test.tsx`

#### Test frameworks
- **Framework:** Vitest 2.1.5
- **UI Testing:** React Testing Library 16.3.0
- **API Mocking:** MSW 2.12.2

#### Coverage requirements
- **Minimum coverage:** >= 80% –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **Command:** `npm run test:coverage`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-30 | 1.0 | –°–æ–∑–¥–∞–Ω–∏–µ Story 13.5b –Ω–∞ –æ—Å–Ω–æ–≤–µ Epic 13 PRD | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (Cascade)

### Debug Log References
–ù–µ—Ç –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.

### Completion Notes
- –ó–∞–º–µ–Ω–∏–ª –ª–æ–∫–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ProductVariant` –Ω–∞ —Ç–∏–ø –∏–∑ `api.generated.ts`
- –°–æ–∑–¥–∞–ª `ProductPageClient` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ProductGallery —Å ProductOptions
- –î–æ–±–∞–≤–∏–ª `selectedVariant` prop –≤ ProductImageGallery –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–∏ —Å–º–µ–Ω–µ —Ü–≤–µ—Ç–∞
- –î–æ–±–∞–≤–∏–ª `onVariantChange` callback –≤ ProductSummary –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –≥–∞–ª–µ—Ä–µ–µ–π
- –†–µ–∞–ª–∏–∑–æ–≤–∞–ª —Ñ—É–Ω–∫—Ü–∏—é `validateOptions` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –æ–ø—Ü–∏–π
- –î–æ–±–∞–≤–∏–ª –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ ProductSummary
- –ù–∞–ø–∏—Å–∞–ª 20 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (–≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç)
- –û–±–Ω–æ–≤–∏–ª —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ `/product/[slug]/page.tsx` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

### File List
**–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**
- `frontend/src/components/product/ProductPageClient.tsx` - –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- `frontend/src/components/product/__tests__/ProductOptions.integration.test.tsx` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `frontend/src/components/product/ProductOptions.tsx` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –∏–∑ api.generated.ts
- `frontend/src/components/product/ProductSummary.tsx` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ onVariantChange
- `frontend/src/components/product/ProductImageGallery.tsx` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ selectedVariant
- `frontend/src/app/product/[slug]/page.tsx` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ProductPageClient

### Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-02 | 1.1 | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Story 13.5b | James (Dev Agent) |

## QA Results

### Review Date: 2025-12-03

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: –û–¢–õ–ò–ß–ù–û (95/100)**

Story 13.5b —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–∞ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ –∫–∞—á–µ—Å—Ç–≤–∞. –ö–æ–¥ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å –ø–æ–ª–Ω–æ–π TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π, –æ—Ç–ª–∏—á–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–º —Ç–µ—Å—Ç–æ–≤—ã–º –ø–æ–∫—Ä—ã—Ç–∏–µ–º.

**–ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**
- ‚úÖ –í—Å–µ 7 Acceptance Criteria –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- ‚úÖ 20 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ (100% pass rate)
- ‚úÖ –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–∞—è TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –ì—Ä–∞–º–æ—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –ü–æ–ª–Ω–∞—è accessibility –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (ARIA, keyboard navigation)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ useMemo/useCallback
- ‚úÖ Comprehensive JSDoc –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### Refactoring Performed

–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª—Å—è. –ö–æ–¥ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –Ω–∞–ø–∏—Å–∞–Ω –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ.

### Compliance Check

- ‚úÖ **Coding Standards**: –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ [docs/architecture/coding-standards.md](../../architecture/coding-standards.md)
  - TypeScript strict mode –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  - ESLint –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–±–ª—é–¥–µ–Ω–∞
  - React best practices –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
  - Tailwind CSS –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ design system v2.0

- ‚úÖ **Project Structure**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç [docs/architecture/source-tree.md](../../architecture/source-tree.md)
  - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–∑–º–µ—â–µ–Ω—ã –≤ `frontend/src/components/product/`
  - –¢–µ—Å—Ç—ã –≤ `__tests__/` subdirectory
  - –¢–∏–ø—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏–∑ `@/types/api.generated`

- ‚úÖ **Testing Strategy**: –°–ª–µ–¥—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –ø—Ä–æ–µ–∫—Ç–∞
  - Vitest 2.1.5 + React Testing Library 16.3.0
  - Integration —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ user flows
  - Mock –¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã
  - Edge cases –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã (—Ç–æ–≤–∞—Ä—ã –±–µ–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã)

- ‚úÖ **All ACs Met**: –í—Å–µ 7 acceptance criteria –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º —Ç–µ—Å—Ç–∞–º–∏

### Acceptance Criteria Traceability

**AC1: ProductOptions –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API –≤–º–µ—Å—Ç–æ MSW mock**
- ‚úÖ Given: ProductSummary –ø–æ–ª—É—á–∞–µ—Ç product —Å variants –∏–∑ API
- ‚úÖ When: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è
- ‚úÖ Then: –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –æ–ø—Ü–∏–∏ –∏–∑ `product.variants` (—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- üß™ Test: "ProductSummary –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API"

**AC2: –¢–∏–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ `api.generated.ts` –ø–æ—Å–ª–µ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ OpenAPI**
- ‚úÖ Given: OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ When: –ò–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è —Ç–∏–ø—ã –≤ ProductOptions.tsx
- ‚úÖ Then: `ProductVariant` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑ `@/types/api.generated`
- üß™ Verified: [ProductOptions.tsx:13,20](../../frontend/src/components/product/ProductOptions.tsx#L13-L20)

**AC3: –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ü–≤–µ—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ ProductGallery (FR10, AC4)**
- ‚úÖ Given: –í—ã–±—Ä–∞–Ω –≤–∞—Ä–∏–∞–Ω—Ç —Ç–æ–≤–∞—Ä–∞ —Å –¥—Ä—É–≥–∏–º —Ü–≤–µ—Ç–æ–º
- ‚úÖ When: selectedVariant –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ ProductImageGallery
- ‚úÖ Then: –û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ variant.main_image
- üß™ Tests: 3 —Ç–µ—Å—Ç–∞ –≥–∞–ª–µ—Ä–µ–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –≥–∞–ª–µ—Ä–µ—è, —Å–±—Ä–æ—Å)

**AC4: –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–ø—Ü–∏–π –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞–ª–∏—á–∏–∏ –∏ —Ü–µ–Ω–µ –≤ ProductSummary**
- ‚úÖ Given: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –∏ —Ü–≤–µ—Ç
- ‚úÖ When: selectedVariant –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è
- ‚úÖ Then: –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ü–µ–Ω–∞ –∏ –Ω–∞–ª–∏—á–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
- üß™ Tests: "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã", "–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞–ª–∏—á–∏—è"

**AC5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ProductSummary: –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è `selectedVariant` —á–µ—Ä–µ–∑ props**
- ‚úÖ Given: ProductPageClient —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º selectedVariant
- ‚úÖ When: onVariantChange –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ ProductSummary
- ‚úÖ Then: selectedVariant —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- üß™ Tests: "onVariantChange –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è", "ProductPageClient —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –≥–∞–ª–µ—Ä–µ—é"

**AC6: –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –æ–ø—Ü–∏–π –ø–µ—Ä–µ–¥ "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É" (FR10, AC7)**
- ‚úÖ Given: –¢–æ–≤–∞—Ä –∏–º–µ–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏ –∏ —Ü–≤–µ—Ç–∞–º–∏
- ‚úÖ When: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É –±–µ–∑ –≤—ã–±–æ—Ä–∞ –æ–ø—Ü–∏–π
- ‚úÖ Then: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –∫–Ω–æ–ø–∫–∞ disabled
- üß™ Tests: 5 unit —Ç–µ—Å—Ç–æ–≤ validateOptions + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**AC7: –ù–∞–ø–∏—Å–∞–Ω—ã integration —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º API**
- ‚úÖ Given: –¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- ‚úÖ When: –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è integration —Ç–µ—Å—Ç—ã
- ‚úÖ Then: 20 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ, –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- üß™ Result: ‚úÖ 20/20 tests passed (1.25s)

### Integration Verification Points

- ‚úÖ **IV1**: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å API –¥–∞–Ω–Ω—ã–º–∏ (–Ω–µ—Ç –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤)
  - TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
  - ProductVariant –∏–∑ api.generated.ts –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

- ‚úÖ **IV2**: ProductGallery –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ü–≤–µ—Ç–∞
  - 3 —Ç–µ—Å—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–∞–ª–µ—Ä–µ–∏
  - Fallback –Ω–∞ default –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

- ‚úÖ **IV3**: ProductSummary –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–µ–Ω—É –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
  - –¶–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
  - –ù–∞–ª–∏—á–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### Security Review

‚úÖ **PASS** - –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ:
- XSS –∑–∞—â–∏—â—ë–Ω —á–µ—Ä–µ–∑ React –∞–≤—Ç–æ—ç—Å–∫–µ–π–ø–∏–Ω–≥
- –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è dangerouslySetInnerHTML (–∫—Ä–æ–º–µ Schema.org structured data, —á—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ)
- User input –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç type confusion attacks
- –ù–µ—Ç —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π injection

### Performance Considerations

‚úÖ **PASS** - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞:
- `useMemo` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è expensive –≤—ã—á–∏—Å–ª–µ–Ω–∏–π (sizes, colors, selectedVariant)
- `useCallback` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤
- Next.js Image component –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ù–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö —Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤ –±–ª–∞–≥–æ–¥–∞—Ä—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –º–µ–º–æ–∏–∑–∞—Ü–∏–∏
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã –∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç performance bottlenecks

### Maintainability Assessment

‚úÖ **EXCELLENT** - –ö–æ–¥ –ª–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å:
- Comprehensive JSDoc –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–π
- –ü–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —Ñ—É–Ω–∫—Ü–∏–π
- –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- DRY –ø—Ä–∏–Ω—Ü–∏–ø —Å–æ–±–ª—é–¥—ë–Ω (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
- –¢–∏–ø–∏–∑–∞—Ü–∏—è –æ–±–ª–µ–≥—á–∞–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥

### Test Architecture Quality

‚úÖ **EXCELLENT** - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:
- 20 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—É—Ç–∏
- Realistic mock –¥–∞–Ω–Ω—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç API schema
- Edge cases –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã (—Ç–æ–≤–∞—Ä—ã –±–µ–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã)
- –¢–µ—Å—Ç—ã —á–∏—Ç–∞–µ–º—ã –∏ —Ö–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã
- AAA –ø–∞—Ç—Ç–µ—Ä–Ω (Arrange-Act-Assert) —Å–æ–±–ª—é–¥—ë–Ω
- –ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ AC ‚Üí Tests

### Technical Debt

‚úÖ **MINIMAL** - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π TODO –≤ ProductPageClient:46 - –æ–∂–∏–¥–∞–µ–º—ã–π (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã –≤ Story 12.2)
- –ù–µ—Ç workarounds –∏–ª–∏ temporary solutions
- –ö–æ–¥ production-ready

### Files Modified During Review

–§–∞–π–ª—ã –Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤–æ –≤—Ä–µ–º—è QA review. –ö–æ–¥ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π.

### Gate Status

**Gate: PASS** ‚Üí [docs/qa/gates/13.5b-productoptions-api-integration.yml](../../qa/gates/13.5b-productoptions-api-integration.yml)

**Quality Score: 95/100**

**Rationale:**
- –í—Å–µ AC –≤—ã–ø–æ–ª–Ω–µ–Ω—ã ‚úÖ
- 20/20 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç ‚úÖ
- NFRs —Å–æ–±–ª—é–¥–µ–Ω—ã (Security, Performance, Reliability, Maintainability) ‚úÖ
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç best practices ‚úÖ
- –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–ª–∏ –≤—ã—Å–æ–∫–∏—Ö —Ä–∏—Å–∫–æ–≤ ‚úÖ

### Recommended Status

‚úÖ **Ready for Done**

Story 13.5b –≥–æ—Ç–æ–≤–∞ –∫ –ø–µ—Ä–µ–≤–æ–¥—É –≤ —Å—Ç–∞—Ç—É—Å "Done". –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –∫–æ–¥ –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞, —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è.

### Future Recommendations (Non-blocking)

–°–ª–µ–¥—É—é—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã –≤ –±—É–¥—É—â–∏—Ö stories:

1. **E2E —Ç–µ—Å—Ç—ã** (Low priority)
   - –ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã (Story 12.2) –¥–æ–±–∞–≤–∏—Ç—å E2E —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ user flow
   - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: Playwright –∏–ª–∏ Cypress

2. **Performance monitoring** (Low priority)
   - –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ performance metrics –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ–Ω–¥–µ—Ä–∞
   - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: React DevTools Profiler

3. **Accessibility audit** (Low priority)
   - –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π accessibility audit
   - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: axe-core –∏–ª–∏ Lighthouse

### QA Sign-off

–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å Story 13.5b –∫ production deployment.

**Signed:** Quinn (Test Architect)
**Date:** 2025-12-03
**Gate Decision:** PASS (95/100)
