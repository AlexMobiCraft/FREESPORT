# История 28.1: Базовая аутентификация и регистрация B2C

**Эпик**: [28: Реализация системы аутентификации](../../epics/epic-28/epic-28-authentication.md)
**Статус**: Черновик
**Приоритет**: Высокий

## Пользовательская история (User Story)

**Как** B2C клиент,
**Я хочу** зарегистрироваться и войти в систему,
**Чтобы** получить доступ к своему профилю и истории заказов.

## Контекст истории

**Интеграция с существующей системой:**

- **Интегрируется с**: `authService`, `authStore` (фундамент Эпика 10), Backend API
- **Технологии**: Next.js 14 App Router, TypeScript, Tailwind CSS, Zustand, React Hook Form, Zod
- **Паттерны**: Паттерн Service-Repository для вызовов API, Zustand для глобального состояния
- **Точки взаимодействия**:
  - `src/app/(auth)/login/page.tsx`
  - `src/app/(auth)/register/page.tsx`
  - `src/services/authService.ts`
  - `src/store/authStore.ts`

## Критерии приемки (Acceptance Criteria)

### Функциональные требования

1. **Поток входа (Login Flow):**
   - Пользователь вводит Email и Пароль.
   - При успехе (200 OK) происходит перенаправление на ранее запрошенный URL или на Главную страницу.
   - `authStore` обновляется статусом пользователя (isAuthenticated: true).

2. **Поток регистрации (B2C Registration Flow):**
   - Пользователь вводит Имя, Email, Пароль, Подтверждение пароля.
   - При успехе (201 Created) происходит автоматический вход ИЛИ перенаправление на вход с сообщением об успехе.
   - Валидация совпадения полей "Пароль" и "Подтверждение пароля".

3. **Валидация и обработка ошибок:**
   - Клиентская валидация формата Email и длины пароля (мин. 8 символов).
   - Отображение понятных сообщений для ошибок API: 401 (Неверные учетные данные), 409 (Пользователь уже существует), 500 (Ошибка сервера).
   - UI показывает состояние загрузки во время запросов (блокировка кнопок, спиннер).

### Требования к интеграции

4. Использование методов `authService` для всех сетевых запросов.
5. Компоненты используют дизайн-систему (Input, Button), определенную в `frontend/docs/design-system.json`.
6. Адаптивный дизайн, соответствующий теме сайта.

### Требования к качеству

7. Unit-тесты для логики валидации `LoginForm` и `RegisterForm`.
8. Компонентные тесты, проверяющие корректное отображение состояний ошибок.
9. Доступность (Accessibility): Поля форм имеют правильные лейблы, сообщения об ошибках связаны через `aria-describedby`.

## Технические заметки

- **Подход к интеграции**: Подключить UI формы к `src/services/authService.ts`. Убедиться, что экшены `authStore` типизированы корректно.
- **Ключевые ограничения**:
  - Обязательно использование `React Hook Form` + `Zod`.
  - Пароли должны передаваться по HTTPS (обеспечивается инфраструктурой, но помнить при локальной разработке).
  - JWT токены обрабатываются перехватчиками Axios (NFR в Эпике), эта история только вызывает сервис.

## Критерии готовности (Definition of Done)

- [ ] Страница входа реализована и функционирует
- [ ] Страница регистрации реализована и функционирует
- [ ] Валидация форм (Zod) покрывает все поля
- [ ] Обработка ошибок выводит понятные пользователю сообщения
- [ ] `authStore` корректно обновляется при успехе
- [ ] Unit/Component тесты пройдены
- [ ] Проведен обзор на соответствие Дизайн-системе
