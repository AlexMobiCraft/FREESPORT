# Story 3.1.3: test-catalog-loading

## Status

Ready for Development

## Story

**As a** Product Owner,
**I want** загрузить полный каталог товаров с корректными ценами,
**so that** фронтенд может отображать актуальные данные для всех типов пользователей.

## Acceptance Criteria

1. Загружен полный каталог тестовых данных (≥500 товаров, ≥50 категорий, ≥20 брендов).
2. Корректно установлены цены для всех 7 ролей, включая fallback-логику.
3. Заполнены технические характеристики товаров.
4. Обеспечена целостность данных и связей между сущностями.

### Детальные задачи

- [ ] **Реализовать генерацию тестовых товаров (AC: 1, 3) в `load_test_catalog`**
  - [ ] Реализовать генерацию ≥500 товаров с использованием параметра `--count`.
  - [ ] Генерировать реалистичные названия, описания и артикулы.
  - [ ] Генерировать JSON-структуру для поля `specifications` (размеры, цвета, материалы).
  - [ ] Привязывать к товарам заглушки изображений.
  - **Решение Architect (22.09.2025):** Использовать внешний сервис `https://placehold.co/` (например, `https://placehold.co/600x400`).

- [ ] **Реализовать генерацию цен для всех ролей (AC: 2) в `load_test_catalog`**
  - [ ] Генерировать базовую `retail_price`.
  - [ ] Рассчитывать и генерировать цены для всех 6 оптовых/специальных ролей на основе `retail_price`.
  - [ ] Реализовать логику fallback: если для какой-то роли цена не сгенерирована, `get_price_for_user` должен возвращать `retail_price`.

- [ ] **Реализовать генерацию иерархии категорий (AC: 1) в `load_test_catalog`**
  - [ ] Реализовать генерацию ≥50 категорий при использовании флага `--with-categories`.
  - [ ] Создавать как минимум 3 уровня вложенности (например, "Обувь" -> "Беговая обувь" -> "Марафонки").
  - [ ] Случайным образом присваивать товары созданным категориям.

- [ ] **Реализовать генерацию брендов (AC: 1) в `load_test_catalog`**
  - [ ] Реализовать генерацию ≥20 брендов при использовании флага `--with-brands`.
  - [ ] Случайным образом присваивать товары созданным брендам.

- [ ] **Обеспечить целостность сгенерированных данных (AC: 4)**
  - [ ] Убедиться, что все сгенерированные товары корректно связаны с категориями и брендами.
  - [ ] Проверить, что у каждого сгенерированного товара есть уникальный `onec_id` (может быть сгенерирован как UUID).

## Definition of Done

- [ ] API `/products/` возвращает корректные данные для всех ролей
- [ ] Каталог отображается в админке Django
- [ ] Все товары имеют цены и доступны для заказа
- [ ] Фронтенд может отображать каталог без ошибок
- [ ] Проведены smoke тесты интеграции

## Dev Notes

### Story Context

**Data Volume Requirements:**

- Минимум 500 товаров для реалистичного тестирования
- 50+ категорий для проверки иерархии и навигации
- 20+ брендов для тестирования фильтрации
- Все 7 ролей должны получать корректные цены

### Ролевое ценообразование

```python
# Пример структуры цен в БД
product = {
    'name': 'Nike Air Max',
    'retail_price': 15000.00,      # Розница
    'opt1_price': 13500.00,        # Опт 1 (-10%)
    'opt2_price': 12750.00,        # Опт 2 (-15%)
    'opt3_price': 12000.00,        # Опт 3 (-20%)
    'trainer_price': 11250.00,     # Тренеры (-25%)
    'federation_price': 10500.00,  # Федерации (-30%)
    'admin_price': 9000.00,        # Админ (себестоимость)
}
```

### Sample Data Structure

```json
{
  "specifications": {
    "size": ["40", "41", "42", "43", "44"],
    "color": ["black", "white", "red"],
    "material": "synthetic leather",
    "weight": "350g",
    "sport": "football"
  }
}
```

### API Testing

```bash
# Тестирование API для разных ролей
curl -H "Authorization: Bearer <retail_token>" /api/products/1/
curl -H "Authorization: Bearer <trainer_token>" /api/products/1/
curl -H "Authorization: Bearer <federation_token>" /api/products/1/
```

### Dependencies

- **Depends on:** Story 3.1.1, 3.1.2 (import infrastructure)
- **Blocks:** Frontend integration, Story 3.1.4 (stocks)
- **Related:** User role management, pricing logic

## Story Points

**3** (Low complexity, mostly data preparation)

## Priority

**High** - Критично для начала frontend разработки

## Labels

`epic-3` `test-data` `catalog` `role-pricing` `frontend-ready`
