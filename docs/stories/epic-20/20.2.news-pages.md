# Story 20.2: Frontend страницы новостей

<!-- Powered by BMAD™ Core -->

## Status

**Draft**

---

## Story

**As a** посетитель сайта,
**I want** просматривать список новостей и детальные страницы новостей,
**so that** я могу быть в курсе актуальных событий и акций компании.

---

## Acceptance Criteria

1. **AC1:** Создана страница `/news` со списком опубликованных новостей
2. **AC2:** Создана страница `/news/[slug]` для детальной новости
3. **AC3:** Страница списка отображает карточки новостей (изображение, заголовок, дата, excerpt)
4. **AC4:** На странице списка реализована пагинация (12 новостей на страницу)
5. **AC5:** Страница детальной новости отображает полный контент, изображение, дату, автора
6. **AC6:** Breadcrumb навигация на обеих страницах
7. **AC7:** SEO метаданные для обеих страниц (title, description, OpenGraph)
8. **AC8:** Динамическое SEO для детальной страницы (generateMetadata)
9. **AC9:** Responsive дизайн (mobile, tablet, desktop)
10. **AC10:** Обработка ошибок (404 для несуществующей новости)
11. **AC11:** Unit-тесты с покрытием ≥70%

---

## Dependencies

> [!IMPORTANT]
> **Блокирующая зависимость:** Эта история требует завершения **Story 20.1** (Backend API для детальной новости).
> Endpoint `GET /api/v1/news/{slug}/` должен быть реализован.

---

## Tasks / Subtasks

### Task 1: Расширить newsService.ts (AC: 2, 4, 10)

- [ ] 1.1 Добавить функцию `getNewsBySlug(slug: string): Promise<NewsItem>`
- [ ] 1.2 Добавить обработку 404 ошибки (throw Error если не найдено)
- [ ] 1.3 Обновить `getNews()` — изменить `page_size` по умолчанию на 12 для страницы списка
- [ ] 1.4 Добавить параметр `getNewsList(params)` с полной пагинацией (count, next, previous)

### Task 2: Создать страницу /news (AC: 1, 3, 4, 6, 7, 9)

- [ ] 2.1 Создать `frontend/src/app/news/page.tsx`
- [ ] 2.2 Server Component с fetch данных через newsService
- [ ] 2.3 SEO metadata: title="Новости | FREESPORT", description
- [ ] 2.4 Breadcrumb: Главная → Новости
- [ ] 2.5 Использовать существующий `NewsCard` из `@/components/home`
- [ ] 2.6 Grid карточек новостей (3 колонки desktop, 2 tablet, 1 mobile)
- [ ] 2.7 Пагинация через searchParams (page=1, 2, ...)
- [ ] 2.8 Empty state если новостей нет

### Task 3: Создать страницу /news/[slug] (AC: 2, 5, 6, 8, 9, 10)

- [ ] 3.1 Создать `frontend/src/app/news/[slug]/page.tsx`
- [ ] 3.2 Server Component с fetch данных по slug
- [ ] 3.3 Динамический SEO через `generateMetadata()`
- [ ] 3.4 Breadcrumb: Главная → Новости → {Заголовок новости}
- [ ] 3.5 Отображать: изображение, заголовок, дата, автор, content (HTML)
- [ ] 3.6 Обработка notFound() если новость не существует
- [ ] 3.7 Кнопка «Назад к новостям»

### Task 4: Unit-тесты для страниц (AC: 11)

- [ ] 4.1 Создать `frontend/src/app/news/__tests__/page.test.tsx`
- [ ] 4.2 Создать `frontend/src/app/news/[slug]/__tests__/page.test.tsx`
- [ ] 4.3 Тесты: рендеринг списка новостей
- [ ] 4.4 Тесты: breadcrumb навигация
- [ ] 4.5 Тесты: пагинация
- [ ] 4.6 Тесты: рендеринг детальной страницы
- [ ] 4.7 Мокировать newsService

### Task 5: Верификация интеграции

- [ ] 5.1 Проверить переходы между страницами
- [ ] 5.2 Проверить responsive на всех breakpoints
- [ ] 5.3 Запустить все тесты: `npm test -- news`
- [ ] 5.4 Проверить ESLint: `npm run lint`

---

## Dev Notes

### Existing Code Context

**NewsCard** (`frontend/src/components/home/NewsCard.tsx`) — **УЖЕ СУЩЕСТВУЕТ:**

```typescript
import { NewsCard } from '@/components/home/NewsCard';

// Props:
interface NewsCardProps {
  title: string;
  excerpt: string;
  image: string;
  publishedAt: string;
}

// Использование:
<Link href={`/news/${news.slug}`}>
  <NewsCard
    title={news.title}
    excerpt={news.excerpt}
    image={news.image || '/images/placeholder.jpg'}
    publishedAt={news.published_at}
  />
</Link>
```

[Source: frontend/src/components/home/NewsCard.tsx]

---

**newsService.ts** (`frontend/src/services/newsService.ts`) — текущий код:

```typescript
export const newsService = {
  async getNews(params?: GetNewsParams): Promise<NewsItem[]> {
    const { data } = await apiClient.get<NewsList>('/news', {
      params: { page_size: 3, ...params },
    });
    return data.results;
  },
  
  // ДОБАВИТЬ:
  async getNewsBySlug(slug: string): Promise<NewsItem> {
    const { data } = await apiClient.get<NewsItem>(`/news/${slug}/`);
    return data;
  },
  
  // ДОБАВИТЬ для пагинации:
  async getNewsList(params?: GetNewsParams): Promise<NewsList> {
    const { data } = await apiClient.get<NewsList>('/news', {
      params: { page_size: 12, ...params },
    });
    return data;
  },
};
```

[Source: frontend/src/services/newsService.ts]

**NewsItem type** (`frontend/src/types/api.ts`, lines 229-241):

```typescript
export interface NewsItem {
  id: number;
  title: string;
  slug: string;
  excerpt: string;
  content?: string;
  image: string | null;
  published_at: string;
  created_at: string;
  updated_at: string;
  author?: string;
  category?: string;
}
```

[Source: frontend/src/types/api.ts#NewsItem]

### Reference: About Page Pattern

Использовать паттерн из Story 19.3 (`frontend/src/app/about/page.tsx`):

- Server Component с metadata export
- Breadcrumb в начале страницы
- Секции с `max-w-7xl mx-auto px-4 sm:px-6 lg:px-8`
- Responsive grid классы

[Source: Story 19.3, docs/stories/epic-19/19.3.about-page.md]

### File Locations

| Файл | Действие |
|------|----------|
| `frontend/src/services/newsService.ts` | Добавить `getNewsBySlug()`, `getNewsList()` |
| `frontend/src/components/home/NewsCard.tsx` | [EXISTS] Использовать существующий |
| `frontend/src/app/news/page.tsx` | [NEW] Страница списка |
| `frontend/src/app/news/[slug]/page.tsx` | [NEW] Детальная страница |
| `frontend/src/app/news/__tests__/page.test.tsx` | [NEW] Тесты |
| `frontend/src/app/news/[slug]/__tests__/page.test.tsx` | [NEW] Тесты |

### NewsCard Component (Existing)

> [!NOTE]
> Компонент `NewsCard` уже реализован. Использовать as-is, обернув в `<Link>`.

```typescript
// Существующий компонент в frontend/src/components/home/NewsCard.tsx
interface NewsCardProps {
  title: string;
  excerpt: string;
  image: string;
  publishedAt: string;
}

// Структура карточки (уже реализовано):
// ┌─────────────────────────┐
// │       [Image]           │  ← Next.js Image с hover scale
// ├─────────────────────────┤
// │ 26 декабря 2025         │  ← publishedAt (formatted via Intl)
// │ Заголовок новости       │  ← title (line-clamp-2)
// │ Краткое описание...     │  ← excerpt (line-clamp-2)
// └─────────────────────────┘
```

### Page /news Layout

```
┌─────────────────────────────────────────────────────────────┐
│ Главная / Новости                            [Breadcrumb]  │
├─────────────────────────────────────────────────────────────┤
│                       Новости                               │
│                                                             │
│ ┌──────────┐ ┌──────────┐ ┌──────────┐                     │
│ │ NewsCard │ │ NewsCard │ │ NewsCard │                     │
│ └──────────┘ └──────────┘ └──────────┘                     │
│ ┌──────────┐ ┌──────────┐ ┌──────────┐                     │
│ │ NewsCard │ │ NewsCard │ │ NewsCard │                     │
│ └──────────┘ └──────────┘ └──────────┘                     │
│                                                             │
│              [← Prev] [1] [2] [3] [Next →]                  │
└─────────────────────────────────────────────────────────────┘
```

### Page /news/[slug] Layout

```
┌─────────────────────────────────────────────────────────────┐
│ Главная / Новости / Заголовок               [Breadcrumb]   │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────┐ │
│ │                    [Hero Image]                         │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ 26.12.2025 • Автор                                         │
│                                                             │
│ # Заголовок новости                                        │
│                                                             │
│ Полный текст новости здесь. Может содержать HTML           │
│ контент с форматированием.                                  │
│                                                             │
│ [← Назад к новостям]                                        │
└─────────────────────────────────────────────────────────────┘
```

### SEO Metadata

**Страница /news:**

```typescript
export const metadata: Metadata = {
  title: 'Новости | FREESPORT',
  description: 'Новости компании FREESPORT. Акции, события, обновления каталога.',
  openGraph: {
    title: 'Новости | FREESPORT',
    description: 'Новости компании FREESPORT',
  },
};
```

**Страница /news/[slug] (динамический):**

```typescript
export async function generateMetadata({ params }: Props): Promise<Metadata> {
  const news = await newsService.getNewsBySlug(params.slug);
  return {
    title: `${news.title} | Новости FREESPORT`,
    description: news.excerpt,
    openGraph: {
      title: news.title,
      description: news.excerpt,
      images: news.image ? [news.image] : [],
    },
  };
}
```

### Date Formatting

```typescript
// Использовать Intl.DateTimeFormat для локализации
const formatDate = (dateString: string): string => {
  return new Intl.DateTimeFormat('ru-RU', {
    day: 'numeric',
    month: 'long',
    year: 'numeric',
  }).format(new Date(dateString));
};
// Output: "26 декабря 2025"
```

---

## Testing

### Testing Standards

- **Framework:** Vitest + React Testing Library
- **Расположение:** рядом с компонентами в `__tests__/`
- **Mocking:** MSW или vi.mock для newsService

### Test Commands

```bash
# Запуск тестов для этой истории
npm test -- news

# С покрытием
npm run test:coverage -- --testPathPattern=news

# Watch mode
npm test -- news --watch
```

### Key Test Cases

```typescript
// news/page.test.tsx
describe('NewsListPage', () => {
  it('renders breadcrumb');
  it('renders news grid with NewsCard components');
  it('renders empty state when no news');
  it('renders pagination controls');
  it('passes correct props to NewsCard');
});

// news/[slug]/page.test.tsx
describe('NewsDetailPage', () => {
  it('renders breadcrumb with news title');
  it('renders news image');
  it('renders news content as HTML');
  it('renders back link to /news');
  it('calls notFound() for non-existent slug');
});
```

> [!NOTE]
> `NewsCard` уже покрыт тестами (если есть) или тестируется интеграционно через страницы.

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-26 | 1.0 | Initial story draft | Bob (SM) |
| 2025-12-26 | 1.1 | PO validation: исправлено использование существующего NewsCard, обновлены tasks | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent_

---

## QA Results

_To be filled by QA Agent_
