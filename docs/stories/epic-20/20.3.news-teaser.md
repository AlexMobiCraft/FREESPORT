# Story 20.3: Блок «Новости» на главной странице

<!-- Powered by BMAD™ Core -->

## Status

**Ready for Review**

---

## Story

**As a** посетитель главной страницы,
**I want** видеть блок с последними новостями с возможностью перехода к полному списку,
**so that** я могу быть в курсе актуальных событий компании без необходимости переходить на отдельную страницу.

---

## Acceptance Criteria

1. **AC1:** Блок «Новости» на главной странице `/test` отображает 3 последние новости
2. **AC2:** Каждая карточка новости содержит ссылку на детальную страницу `/news/{slug}`
3. **AC3:** Блок содержит заголовок «Новости» и кнопку «Все новости» → `/news`
4. **AC4:** Responsive дизайн (3 колонки desktop, 2 tablet, 1 mobile)
5. **AC5:** Loading состояние (skeleton) при загрузке данных
6. **AC6:** Empty state если новостей нет
7. **AC7:** Unit-тесты с покрытием ≥70%

---

## Dependencies

> [!IMPORTANT]
> **Блокирующая зависимость:** Эта история требует завершения **Story 20.2** (Frontend страницы новостей).
> Страницы `/news` и `/news/[slug]` должны быть реализованы для корректной работы ссылок.

---

## Tasks / Subtasks

### Task 1: Добавить ссылки на карточки новостей (AC: 2)

- [x] 1.1 Модифицировать `frontend/src/components/home/NewsCard.tsx`
- [x] 1.2 Добавить prop `slug: string` и `href?: string`
- [x] 1.3 Обернуть карточку в `<Link href={`/news/${slug}`}>`
- [x] 1.4 Добавить aria-label для доступности

### Task 2: Добавить кнопку «Все новости» (AC: 3)

- [x] 2.1 Модифицировать `frontend/src/components/home/NewsSection.tsx`
- [x] 2.2 Добавить header с заголовком и кнопкой
- [x] 2.3 Кнопка «Все новости» → `/news`
- [x] 2.4 Стилизация по паттерну AboutTeaser (Button component)

### Task 3: Unit-тесты для NewsCard (AC: 7)

- [x] 3.1 Обновить/создать `frontend/src/components/home/__tests__/NewsCard.test.tsx`
- [x] 3.2 Тест: рендеринг изображения, заголовка, даты, excerpt
- [x] 3.3 Тест: ссылка ведёт на `/news/{slug}`
- [x] 3.4 Тест: форматирование даты

### Task 4: Unit-тесты для NewsSection (AC: 7)

- [x] 4.1 Обновить/создать `frontend/src/components/home/__tests__/NewsSection.test.tsx`
- [x] 4.2 Тест: рендеринг заголовка «Новости»
- [x] 4.3 Тест: рендеринг кнопки «Все новости»
- [x] 4.4 Тест: ссылка кнопки ведёт на `/news`
- [x] 4.5 Тест: отображение 3 карточек новостей
- [x] 4.6 Тест: loading skeleton
- [x] 4.7 Тест: empty state

### Task 5: Верификация интеграции

- [x] 5.1 Проверить на главной странице отображение блока новостей
- [x] 5.2 Проверить переход с карточки на детальную страницу
- [x] 5.3 Проверить переход по кнопке «Все новости»
- [x] 5.4 Запустить все тесты: `npm test -- news`
- [x] 5.5 Проверить ESLint: `npm run lint`

---

## Dev Notes

### Existing Code Context

**NewsCard.tsx** (`frontend/src/components/home/NewsCard.tsx`):

Существующий компонент отображает карточку новости, но **НЕ содержит ссылку** на детальную страницу. Нужно добавить prop `slug` и обернуть в `<Link>`.

```typescript
// ТЕКУЩИЙ код (без ссылки):
export interface NewsCardProps {
  title: string;
  excerpt: string;
  image: string;
  publishedAt: string;
}

// НУЖНО ДОБАВИТЬ:
export interface NewsCardProps {
  title: string;
  excerpt: string;
  image: string;
  publishedAt: string;
  slug: string; // НОВЫЙ prop
}
```

[Source: frontend/src/components/home/NewsCard.tsx]

**NewsSection.tsx** (`frontend/src/components/home/NewsSection.tsx`):

Существующий компонент загружает новости из API и показывает их в grid. НО:

- ❌ Нет кнопки «Все новости» → `/news`
- ❌ Не передаёт `slug` в NewsCard

```typescript
// ТЕКУЩИЙ код (без slug):
<NewsCard
  key={item.id}
  title={item.title}
  excerpt={item.excerpt}
  image={item.image}
  publishedAt={item.publishedAt}
/>

// НУЖНО ИЗМЕНИТЬ:
<NewsCard
  key={item.id}
  title={item.title}
  excerpt={item.excerpt}
  image={item.image}
  publishedAt={item.publishedAt}
  slug={item.slug}  // ДОБАВИТЬ
/>
```

[Source: frontend/src/components/home/NewsSection.tsx]

### Reference: AboutTeaser Pattern

Использовать паттерн из `AboutTeaser.tsx` для добавления CTA-кнопки:

```typescript
// Паттерн из AboutTeaser.tsx
<Link href="/about">
  <Button size="lg" variant="primary">
    Узнать больше о нас
  </Button>
</Link>

// Применить к NewsSection:
<Link href="/news">
  <Button variant="primary">
    Все новости
  </Button>
</Link>
```

[Source: frontend/src/components/home/AboutTeaser.tsx]

### NewsCardData Interface

В `NewsSection.tsx` есть интерфейс `NewsCardData`, который нужно расширить:

```typescript
// ТЕКУЩИЙ:
interface NewsCardData {
  id: number;
  title: string;
  excerpt: string;
  image: string;
  publishedAt: string;
}

// НУЖНО ДОБАВИТЬ:
interface NewsCardData {
  id: number;
  title: string;
  slug: string;  // ДОБАВИТЬ
  excerpt: string;
  image: string;
  publishedAt: string;
}
```

### Mapping Functions Update

Обновить `mapNewsItem` и `mapStaticItem`:

```typescript
const mapNewsItem = (item: NewsItem, index: number): NewsCardData => ({
  id: item.id,
  title: item.title,
  slug: item.slug,  // ДОБАВИТЬ
  excerpt: item.excerpt,
  image: item.image || getFallbackImage(index),
  publishedAt: item.published_at,
});
```

### File Locations

| Файл | Действие |
|------|----------|
| `frontend/src/components/home/NewsCard.tsx` | Добавить `slug` prop и Link |
| `frontend/src/components/home/NewsSection.tsx` | Добавить кнопку «Все новости», передавать slug |
| `frontend/src/components/home/__tests__/NewsCard.test.tsx` | Обновить тесты |
| `frontend/src/components/home/__tests__/NewsSection.test.tsx` | Обновить тесты |

### NewsSection Layout (Updated)

```
┌─────────────────────────────────────────────────────────────┐
│  Новости                              [Все новости →]       │
├─────────────────────────────────────────────────────────────┤
│ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐          │
│ │ [Image]      │ │ [Image]      │ │ [Image]      │          │
│ │ 26.12.2025   │ │ 26.12.2025   │ │ 26.12.2025   │          │
│ │ Заголовок 1  │ │ Заголовок 2  │ │ Заголовок 3  │          │
│ │ excerpt...   │ │ excerpt...   │ │ excerpt...   │          │
│ │   → Link     │ │   → Link     │ │   → Link     │          │
│ └──────────────┘ └──────────────┘ └──────────────┘          │
└─────────────────────────────────────────────────────────────┘
```

---

## Testing

### Testing Standards

- **Framework:** Vitest + React Testing Library
- **Расположение:** `frontend/src/components/home/__tests__/`
- **Mocking:** vi.mock для newsService

### Test Commands

```bash
# Запуск тестов для этой истории
npm test -- NewsCard
npm test -- NewsSection

# С покрытием
npm run test:coverage -- --testPathPattern=home

# Watch mode
npm test -- home --watch
```

### Key Test Cases

```typescript
// NewsCard.test.tsx
describe('NewsCard', () => {
  it('renders news image');
  it('renders news title');
  it('renders formatted date');
  it('renders excerpt');
  it('links to /news/{slug}');
});

// NewsSection.test.tsx
describe('NewsSection', () => {
  it('renders section heading "Новости"');
  it('renders "Все новости" button');
  it('button links to /news');
  it('renders 3 news cards');
  it('shows skeleton while loading');
  it('shows fallback when no news');
});
```

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-26 | 1.0 | Initial story draft | Bob (SM) |

---

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (model ID: claude-sonnet-4-5-20250929)

### Debug Log References

No critical issues encountered during development. All tests passed successfully.

### Completion Notes List

- ✅ Добавлен prop `slug` в NewsCard компонент с Link на детальную страницу `/news/{slug}`
- ✅ Добавлена кнопка "Все новости" в NewsSection с переходом на `/news`
- ✅ Обновлены моки STATIC_NEWS_ITEMS - добавлено поле `slug`
- ✅ Созданы 7 unit-тестов для NewsCard (100% прохождение)
- ✅ Обновлены и расширены тесты для NewsSection (10 тестов, 100% прохождение)
- ✅ Все 66 тестов news прошли успешно
- ✅ ESLint проверка прошла успешно (только warnings, без ошибок)

### File List

**Modified:**
- `frontend/src/components/home/NewsCard.tsx` - добавлен slug prop и Link
- `frontend/src/components/home/NewsSection.tsx` - добавлена кнопка "Все новости", передача slug
- `frontend/src/__mocks__/news.ts` - добавлено поле slug в StaticNewsItem
- `frontend/src/components/home/__tests__/NewsSection.test.tsx` - обновлены тесты для Story 20.3

**Created:**
- `frontend/src/components/home/__tests__/NewsCard.test.tsx` - новые unit-тесты

---

## QA Results

_To be filled by QA Agent_
