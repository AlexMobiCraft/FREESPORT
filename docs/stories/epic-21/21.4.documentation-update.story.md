# Story 21.4: Обновление документации

<!-- Powered by BMAD™ Core -->

## Status

Draft

---

## Story

**As a** разработчик или AI-ассистент,
**I want** найти актуальную информацию о модуле Blog в проектной документации,
**so that** я могу быстро понять архитектуру и использовать существующие паттерны.

---

## Acceptance Criteria

1. Обновлён `docs/architecture/source-tree.md` — добавлена информация о компонентах Blog (model, service, pages)
2. Обновлён `docs/architecture/03-api-specification.md` — добавлены endpoints `/api/v1/blog/` и `/api/v1/blog/{slug}/`
3. Обновлён `docs/architecture/02-data-models.md` — добавлено описание модели `BlogPost`
4. Обновлён `GEMINI.md` — добавлено краткое описание модуля Blog в разделе Django App Structure
5. Обновлён `CLAUDE.md` — добавлено краткое описание модуля Blog в разделе структуры приложений
6. Все изменения согласованы с фактической реализацией из Stories 21.1–21.3

---

## Tasks / Subtasks

- [ ] **Task 1: Обновить source-tree.md** (AC: 1)
  - [ ] Добавить модель `BlogPost` в секцию `backend/apps/common/` (рядом с `News`)
  - [ ] Добавить `blogService.ts` в секцию `frontend/src/services/`
  - [ ] Добавить страницы `/blog` и `/blog/[slug]` в секцию `frontend/src/app/`
  - [ ] Сохранить консистентность с существующим форматированием

- [ ] **Task 2: Обновить 03-api-specification.md** (AC: 2)
  - [ ] Добавить секцию `# Blog API` с endpoints:
    - `GET /api/v1/blog/` — список статей с пагинацией
    - `GET /api/v1/blog/{slug}/` — детальная статья
  - [ ] Добавить схемы `BlogPostList` и `BlogPostDetail` в components/schemas
  - [ ] Использовать паттерн существующих News endpoints как референс

- [ ] **Task 3: Обновить 02-data-models.md** (AC: 3)
  - [ ] Добавить секцию `### BlogPost Model` после секции `News`
  - [ ] Описать поля модели: title, slug, subtitle, excerpt, content, image, author, category, is_published, published_at, meta_title, meta_description, created_at, updated_at
  - [ ] Добавить модель в ER-диаграмму (mermaid)

- [ ] **Task 4: Обновить GEMINI.md** (AC: 4)
  - [ ] В секции `## **Django App Structure**` добавить строку:
    - `- apps/common/: Includes shared utilities, components, News and Blog models.`
  - [ ] Обновить существующее описание apps/common/ чтобы включить Blog

- [ ] **Task 5: Обновить CLAUDE.md** (AC: 5)
  - [ ] В секции `### **Структура приложений Django**` обновить apps/common/:
    - Добавить упоминание модели `BlogPost` и страниц `/blog`
  - [ ] Убедиться что формулировка согласована с GEMINI.md

- [ ] **Task 6: Верификация изменений** (AC: 6)
  - [ ] Проверить что все обновления соответствуют фактической реализации из Stories 21.1–21.3
  - [ ] Проверить корректность ссылок и форматирования
  - [ ] Запустить линтинг markdown если доступен

---

## Dev Notes

### Контекст из предыдущих историй (Epic 21)

История 21.4 следует за Stories 21.1–21.3, которые реализовали:

- **Story 21.1**: Модель `BlogPost` в `backend/apps/common/models.py`, Django Admin в `backend/apps/common/admin.py`
- **Story 21.2**: API endpoints `GET /api/v1/blog/` и `GET /api/v1/blog/{slug}/` с сериализаторами `BlogPostListSerializer`, `BlogPostDetailSerializer`
- **Story 21.3**: Frontend страницы `/blog`, `/blog/[slug]`, сервис `blogService.ts`, типы `BlogItem`, `BlogList`

[Source: docs/stories/epic-21/21.1, 21.2, 21.3]

### Поля модели BlogPost (из Story 21.1)

| Поле | Тип | Описание |
|------|-----|----------|
| title | CharField(200) | Заголовок статьи |
| slug | SlugField(200, unique) | URL-идентификатор |
| subtitle | CharField(200, blank) | Подзаголовок |
| excerpt | TextField(blank) | Краткое описание |
| content | TextField | Полное содержание |
| image | ImageField | Главное изображение |
| author | CharField(100, blank) | Имя автора |
| category | ForeignKey(Category) | Категория (nullable) |
| is_published | BooleanField | Флаг публикации |
| published_at | DateTimeField | Дата публикации |
| meta_title | CharField(200, blank) | SEO title |
| meta_description | TextField(blank) | SEO description |
| created_at | DateTimeField | Дата создания |
| updated_at | DateTimeField | Дата обновления |

[Source: docs/epics/epic-21/epic-21.blog-management.md#Story 21.1]

### API Endpoints (из Story 21.2)

```yaml
# GET /api/v1/blog/
# Список опубликованных статей с пагинацией
# Query params: page, page_size
# Response: { count, next, previous, results: BlogPostList[] }

# GET /api/v1/blog/{slug}/
# Детальная статья
# Response: BlogPostDetail (полный формат)
```

[Source: docs/stories/epic-21/21.2.backend-api-blogpost.story.md]

### Фактическое расположение файлов (после Stories 21.1–21.3)

```text
backend/apps/common/
├── models.py          # Содержит BlogPost модель
├── admin.py           # Содержит BlogPostAdmin
├── serializers.py     # BlogPostListSerializer, BlogPostDetailSerializer
├── views.py           # BlogPostListView, BlogPostDetailView
└── urls.py            # Маршруты /blog/

frontend/src/
├── app/blog/
│   ├── page.tsx       # Список статей (/blog)
│   ├── loading.tsx    # Skeleton loader
│   └── [slug]/
│       ├── page.tsx   # Детальная страница (/blog/[slug])
│       └── loading.tsx
├── services/
│   └── blogService.ts # API сервис
└── types/
    └── api.ts         # BlogItem, BlogList типы
```

[Source: docs/architecture/source-tree.md + Epic 21 Stories]

### Паттерн документации API (референс из News)

Используйте существующий паттерн News API в `03-api-specification.md` как референс для добавления Blog API. Формат включает:
- OpenAPI path definitions
- Request/Response schemas
- Query parameters documentation

[Source: docs/architecture/03-api-specification.md]

### Паттерн документации моделей (референс)

Используйте существующий паттерн описания моделей в `02-data-models.md`. Включает:
- Python код модели с docstrings
- Описание полей в виде комментариев
- Добавление в ER-диаграмму

[Source: docs/architecture/02-data-models.md]

---

## Testing

### Стратегия верификации

Это задача обновления документации — формальные unit-тесты не требуются.

**Верификация:**

1. Проверить что все ссылки в документации корректны
2. Убедиться что mermaid диаграммы рендерятся без ошибок
3. Проверить консистентность терминологии между документами
4. Сверить документацию с фактическим кодом из Stories 21.1–21.3

**Команды для проверки (опционально):**

```bash
# Валидация документации (если настроено)
make docs-validate

# Проверка ссылок
make docs-check-links
```

[Source: CLAUDE.md#Makefile команды]

---

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

---

## QA Results

_To be filled by QA agent_

---

## Change Log

| Date       | Version | Description             | Author             |
|------------|---------|-------------------------|--------------------
| 2025-12-27 | 1.0     | Initial story draft     | Bob (Scrum Master) |
