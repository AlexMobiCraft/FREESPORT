# Story 15.1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∏–º–ø–æ—Ä—Ç–∞ "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

> **Epic**: [Epic 15 - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å](../../epics/epic-15/epic-15.admin-image-update.md)
> **–°–æ–∑–¥–∞–Ω–æ**: 2025-11-26
> **–°—Ç–∞—Ç—É—Å**: üìã Ready

---

## Status

**Current Status**: Ready for Review

---

## Story

**As a** –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã,
**I want** –≤—ã–±—Ä–∞—Ç—å —Ç–∏–ø –∏–º–ø–æ—Ä—Ç–∞ "–¢–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤" –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ Django,
**so that** —è –º–æ–≥—É –æ–±–Ω–æ–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ 1–° –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –∫–∞—Ç–∞–ª–æ–≥–∞.

---

## Acceptance Criteria

1. Radio button "–¢–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–µ –∏–º–ø–æ—Ä—Ç–∞
2. –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –ë–î –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
3. –í—ã–±–æ—Ä —Ç–∏–ø–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã
4. –ù–æ–≤—ã–π —Ç–∏–ø `ImportType.IMAGES` –¥–æ–±–∞–≤–ª–µ–Ω –≤ –º–æ–¥–µ–ª—å `ImportSession`
5. –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–æ–≤–∞—Ä–æ–≤
6. UI —Å–ª–µ–¥—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

---

## Tasks / Subtasks

- [x] **Task 1: –†–∞—Å—à–∏—Ä–∏—Ç—å –º–æ–¥–µ–ª—å ImportSession** (AC: 4)
  - [x] –î–æ–±–∞–≤–∏—Ç—å `IMAGES = "images", "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤"` –≤ `ImportType` enum ([models.py:646-650](../../../backend/apps/products/models.py#L646-L650))
  - [x] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –Ω–æ–≤–æ–≥–æ enum –∑–Ω–∞—á–µ–Ω–∏—è
  - [x] –û–±–Ω–æ–≤–∏—Ç—å type hints –≤ –º–æ–¥–µ–ª–∏ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
  - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏

- [x] **Task 2: –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ä–º—É –∏–º–ø–æ—Ä—Ç–∞ –≤ views.py** (AC: 1, 3, 6)
  - [x] –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø –≤ —Å–ø–∏—Å–æ–∫ `import_types` –≤ `import_from_1c_view()` ([views.py:54-83](../../../backend/apps/integrations/views.py#L54-L83))
  - [x] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞:
    - `value: "images"`
    - `label: "–¢–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤"`
    - `description: "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ 1–° (main_image –∏ gallery_images)"`
    - `files: "data/import_1c/goods/import_files/**/*.jpg, **/*.png"`
    - `requires_catalog: True`
  - [x] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ—Ä—è–¥–æ–∫ —Ç–∏–ø–æ–≤ –ª–æ–≥–∏—á–µ–Ω (images –ø–æ—Å–ª–µ catalog, –ø–µ—Ä–µ–¥ stocks/prices)

- [x] **Task 3: –†–∞—Å—à–∏—Ä–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** (AC: 2, 5)
  - [x] –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `_validate_dependencies()` ([views.py:144-161](../../../backend/apps/integrations/views.py#L144-L161))
  - [x] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `if "images" in selected_types:`
  - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–æ–≤: `if not Product.objects.exists()`
  - [x] –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É: `"‚ö†Ô∏è –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ –ø—É—Å—Ç. –°–Ω–∞—á–∞–ª–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥."`
  - [x] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `import_files/` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è Story 15.3)

- [x] **Task 4: –û–±–Ω–æ–≤–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ —Ç–∏–ø–æ–≤ –≤ _create_and_run_import()** (AC: 3)
  - [x] –î–æ–±–∞–≤–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –≤ `session_type_map` ([views.py:229-239](../../../backend/apps/integrations/views.py#L229-L239)):
    ```python
    "images": ImportSession.ImportType.IMAGES,
    ```
  - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–∞–ø–ø–∏–Ω–≥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Å—Å–∏–∏

- [x] **Task 5: –û–±–Ω–æ–≤–∏—Ç—å template —Ñ–æ—Ä–º—ã –∏–º–ø–æ—Ä—Ç–∞ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)** (AC: 1, 6)
  - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ template `admin/integrations/import_1c.html`
  - [x] –ï—Å–ª–∏ template –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ - –æ–±–Ω–æ–≤–∏—Ç—å –µ–≥–æ
  - [x] –ï—Å–ª–∏ template –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç `import_types` –∏–∑ context - –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
  - [x] –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è —Ç–∏–ø–æ–≤ —Å `requires_catalog: True`

- [x] **Task 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (AC: –≤—Å–µ)
  - [x] **Unit-—Ç–µ—Å—Ç –¥–ª—è –º–æ–¥–µ–ª–∏ ImportSession:**
    - [x] –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é —Å —Ç–∏–ø–æ–º `IMAGES`
    - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `session.import_type == "images"`
    - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `session.get_import_type_display() == "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤"`

  - [x] **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–æ–≤–∞—Ä–æ–≤):**
    - [x] –û—á–∏—Å—Ç–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É Product
    - [x] –í—ã–∑–≤–∞—Ç—å `_validate_dependencies(["images"])`
    - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `is_valid == False`
    - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç "–∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ –ø—É—Å—Ç"

  - [x] **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (—Ç–æ–≤–∞—Ä—ã –µ—Å—Ç—å):**
    - [x] –°–æ–∑–¥–∞—Ç—å –º–∏–Ω–∏–º—É–º 1 —Ç–æ–≤–∞—Ä —á–µ—Ä–µ–∑ Factory
    - [x] –í—ã–∑–≤–∞—Ç—å `_validate_dependencies(["images"])`
    - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `is_valid == True`

  - [x] **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç —Ñ–æ—Ä–º—ã –∏–º–ø–æ—Ä—Ç–∞:**
    - [x] GET –∑–∞–ø—Ä–æ—Å –Ω–∞ `/admin/integrations/import_1c/`
    - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–∏–ø–∞ "images" –≤ context `import_types`
    - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `requires_catalog == True`

  - [x] **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç POST –∑–∞–ø—Ä–æ—Å–∞:**
    - [x] –°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ –ë–î
    - [x] POST –∑–∞–ø—Ä–æ—Å —Å `import_type=images`
    - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ `ImportSession` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ç–∏–ø–æ–º
    - [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–µ—Å—Å–∏–π

- [x] **Task 7: –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**
  - [x] –û–±–Ω–æ–≤–∏—Ç—å CLAUDE.md —Å –ø—Ä–∏–º–µ—Ä–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –∏–º–ø–æ—Ä—Ç–∞
  - [x] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ –≤ Epic 15 –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ Story 15.1

---

## Dev Notes

### Relevant Source Tree

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

```
backend/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ products/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py:646-650           # ImportSession.ImportType enum
‚îÇ   ‚îî‚îÄ‚îÄ integrations/
‚îÇ       ‚îú‚îÄ‚îÄ views.py:54-83              # import_types —Å–ø–∏—Å–æ–∫ –≤ —Ñ–æ—Ä–º–µ
‚îÇ       ‚îú‚îÄ‚îÄ views.py:144-161            # _validate_dependencies()
‚îÇ       ‚îú‚îÄ‚îÄ views.py:229-239            # session_type_map –º–∞–ø–ø–∏–Ω–≥
‚îÇ       ‚îî‚îÄ‚îÄ templates/
‚îÇ           ‚îî‚îÄ‚îÄ admin/integrations/
‚îÇ               ‚îî‚îÄ‚îÄ import_1c.html      # Template —Ñ–æ—Ä–º—ã (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
‚îî‚îÄ‚îÄ apps/integrations/tests/
    ‚îî‚îÄ‚îÄ test_views.py                   # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
- –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ enum –∑–Ω–∞—á–µ–Ω–∏—è `IMAGES`
- –¢–µ—Å—Ç—ã –≤ `test_views.py` –∏ `test_models.py`

---

### Existing System Integration

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:**

1. **–ú–æ–¥–µ–ª—å ImportSession** ([models.py:641-719](../../../backend/apps/products/models.py#L641-L719)):
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏–º–ø–æ—Ä—Ç–∞
   - –°–æ–¥–µ—Ä–∂–∏—Ç enum `ImportType` —Å —Ç–µ–∫—É—â–∏–º–∏ —Ç–∏–ø–∞–º–∏: CATALOG, STOCKS, PRICES, CUSTOMERS
   - –ù–æ–≤—ã–π —Ç–∏–ø IMAGES –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ —ç—Ç–æ—Ç enum

2. **View import_from_1c_view** ([views.py:29-85](../../../backend/apps/integrations/views.py#L29-L85)):
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ñ–æ—Ä–º—É –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∏–º–ø–æ—Ä—Ç–∞
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–∏—Å–æ–∫ `import_types` –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ radio buttons
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç POST –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ `_handle_import_request()`

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** ([views.py:144-161](../../../backend/apps/integrations/views.py#L144-L161)):
   - –§—É–Ω–∫—Ü–∏—è `_validate_dependencies()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç prerequisites
   - –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞: stocks –∏ prices —Ç—Ä–µ–±—É—é—Ç –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–æ–≤
   - –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞: images —Ç–∞–∫–∂–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–æ–≤

4. **–°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –∏–º–ø–æ—Ä—Ç–∞** ([views.py:164-258](../../../backend/apps/integrations/views.py#L164-L258)):
   - –§—É–Ω–∫—Ü–∏—è `_create_and_run_import()` —Å–æ–∑–¥–∞–µ—Ç ImportSession –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç Celery –∑–∞–¥–∞—á—É
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞–ø–ø–∏–Ω–≥ `session_type_map` –¥–ª—è —Å–≤—è–∑–∏ form value —Å enum
   - **–í–ê–ñ–ù–û**: Story 15.1 —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è–µ—Ç UI –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é, Celery –∑–∞–¥–∞—á–∞ –±—É–¥–µ—Ç –≤ Story 15.2

---

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

#### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∏–ø–æ–≤ –∏–º–ø–æ—Ä—Ç–∞ –≤ —Ñ–æ—Ä–º–µ

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: [views.py:54-83](../../../backend/apps/integrations/views.py#L54-L83)

**–ü–∞—Ç—Ç–µ—Ä–Ω**:
```python
"import_types": [
    {
        "value": "catalog",          # –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ImportType enum –∑–Ω–∞—á–µ–Ω–∏—é
        "label": "–ü–æ–ª–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥",   # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
        "description": "–ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö: —Ç–æ–≤–∞—Ä—ã, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –±—Ä–µ–Ω–¥—ã...",
        "files": "goods_*.xml, offers_*.xml, prices_*.xml...",  # –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
        "requires_catalog": False     # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤
    },
    # ... –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã
]
```

**–î–ª—è –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ "images"**:
```python
{
    "value": "images",
    "label": "–¢–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤",
    "description": "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ 1–° (main_image –∏ gallery_images)",
    "files": "data/import_1c/goods/import_files/**/*.jpg, **/*.png",
    "requires_catalog": True
}
```

---

#### 2. ImportType enum –≤ –º–æ–¥–µ–ª–∏

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: [models.py:646-650](../../../backend/apps/products/models.py#L646-L650)

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω**:
```python
class ImportType(models.TextChoices):
    CATALOG = "catalog", "–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤"
    STOCKS = "stocks", "–û—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤"
    PRICES = "prices", "–¶–µ–Ω—ã —Ç–æ–≤–∞—Ä–æ–≤"
    CUSTOMERS = "customers", "–ö–ª–∏–µ–Ω—Ç—ã"
```

**–î–æ–±–∞–≤–∏—Ç—å**:
```python
IMAGES = "images", "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤"
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è**:
- –ü–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `"images"` - –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ë–î (–¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `value` –≤ —Ñ–æ—Ä–º–µ)
- –í—Ç–æ—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤"` - human-readable –Ω–∞–∑–≤–∞–Ω–∏–µ
- –ü–æ—Ä—è–¥–æ–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –≤ –∞–¥–º–∏–Ω–∫–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ CATALOG)

---

#### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: [views.py:144-161](../../../backend/apps/integrations/views.py#L144-L161)

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω**:
```python
def _validate_dependencies(selected_types: list[str]) -> tuple[bool, str]:
    """
    –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏ –∏–º–ø–æ—Ä—Ç–∞.

    Returns:
        Tuple[bool, str]: (is_valid, error_message)
    """
    if "stocks" in selected_types or "prices" in selected_types:
        if not Product.objects.exists():
            return (
                False,
                "‚ö†Ô∏è –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏/—Ü–µ–Ω—ã: "
                "–∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ –ø—É—Å—Ç. –°–Ω–∞—á–∞–ª–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥.",
            )
    return True, ""
```

**–†–∞—Å—à–∏—Ä–∏—Ç—å –¥–ª—è "images"**:
```python
def _validate_dependencies(selected_types: list[str]) -> tuple[bool, str]:
    # –¢–∏–ø—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –≤ –ë–î
    catalog_dependent_types = ["stocks", "prices", "images"]

    if any(t in selected_types for t in catalog_dependent_types):
        if not Product.objects.exists():
            return (
                False,
                "‚ö†Ô∏è –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏/—Ü–µ–Ω—ã/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: "
                "–∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ –ø—É—Å—Ç. –°–Ω–∞—á–∞–ª–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥.",
            )
    return True, ""
```

---

#### 4. –ú–∞–ø–ø–∏–Ω–≥ —Ç–∏–ø–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–π

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: [views.py:229-239](../../../backend/apps/integrations/views.py#L229-L239)

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω**:
```python
# –ú–∞–ø–ø–∏–Ω–≥ —Ç–∏–ø–æ–≤ –∏–º–ø–æ—Ä—Ç–∞ –Ω–∞ —Ç–∏–ø—ã —Å–µ—Å—Å–∏–π
session_type_map = {
    "catalog": ImportSession.ImportType.CATALOG,
    "stocks": ImportSession.ImportType.STOCKS,
    "prices": ImportSession.ImportType.PRICES,
    "customers": ImportSession.ImportType.CUSTOMERS,
}

session_import_type = session_type_map.get(
    import_type, ImportSession.ImportType.CATALOG
)
```

**–î–æ–±–∞–≤–∏—Ç—å**:
```python
session_type_map = {
    "catalog": ImportSession.ImportType.CATALOG,
    "images": ImportSession.ImportType.IMAGES,  # ‚Üê –ù–æ–≤—ã–π –º–∞–ø–ø–∏–Ω–≥
    "stocks": ImportSession.ImportType.STOCKS,
    "prices": ImportSession.ImportType.PRICES,
    "customers": ImportSession.ImportType.CUSTOMERS,
}
```

---

### –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Story 15.1 –ù–ï –≤–∫–ª—é—á–∞–µ—Ç Celery –∑–∞–¥–∞—á—É**:
   - Story 15.1 —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è–µ—Ç UI –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é
   - –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±—É–¥–µ—Ç –≤ Story 15.2
   - –ü–æ—Å–ª–µ Story 15.1 –∞–¥–º–∏–Ω —Å–º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å —Ç–∏–ø "images", –Ω–æ –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π "Unknown import type"

2. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Ç–∏–ø–∞–º–∏**:
   - –ù–æ–≤—ã–π —Ç–∏–ø –Ω–µ –¥–æ–ª–∂–µ–Ω –≤–ª–∏—è—Ç—å –Ω–∞ —Ä–∞–±–æ—Ç—É catalog, stocks, prices, customers
   - Regression —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —Ç–∏–ø—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ

3. **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î**:
   - PostgreSQL –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ enum —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏—é
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `migrations.RunSQL` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è

4. **Template —Ñ–æ—Ä–º—ã**:
   - –ï—Å–ª–∏ template –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç `import_types` –∏–∑ context - –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
   - –ï—Å–ª–∏ template –∏—Å–ø–æ–ª—å–∑—É–µ—Ç hardcoded —Å–ø–∏—Å–æ–∫ - –æ–±–Ω–æ–≤–∏—Ç—å –µ–≥–æ

5. **Redis lock**:
   - –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º lock ([views.py:110-121](../../../backend/apps/integrations/views.py#L110-L121)) —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤
   - –ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

---

### Testing

#### Testing Standards

**Framework**: Pytest 7.4.3 + pytest-django 4.7.0

**Coverage target**: >= 80% –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞

**Test file locations**:
- `backend/apps/integrations/tests/test_views.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã views
- `backend/apps/products/tests/test_models.py` - unit-—Ç–µ—Å—Ç—ã –º–æ–¥–µ–ª–∏ ImportSession

---

#### Testing Patterns

**1. Unit-—Ç–µ—Å—Ç –¥–ª—è –º–æ–¥–µ–ª–∏ ImportSession**

```python
import pytest
from django.test import TestCase
from apps.products.models import ImportSession


@pytest.mark.unit
class TestImportSessionModel(TestCase):
    """–¢–µ—Å—Ç—ã –º–æ–¥–µ–ª–∏ ImportSession."""

    def test_import_type_images_choice_exists(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ IMAGES –≤ enum."""
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ IMAGES –¥–æ—Å—Ç—É–ø–µ–Ω –≤ choices
        choices_values = [choice[0] for choice in ImportSession.ImportType.choices]
        assert "images" in choices_values

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º human-readable –Ω–∞–∑–≤–∞–Ω–∏–µ
        images_label = dict(ImportSession.ImportType.choices)["images"]
        assert images_label == "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤"

    def test_create_session_with_images_type(self):
        """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏ —Å —Ç–∏–ø–æ–º IMAGES."""
        session = ImportSession.objects.create(
            import_type=ImportSession.ImportType.IMAGES,
            status=ImportSession.ImportStatus.STARTED
        )

        assert session.import_type == "images"
        assert session.get_import_type_display() == "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤"
        assert session.status == "started"
```

---

**2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**

```python
import pytest
from django.test import TestCase
from apps.products.models import Product
from apps.integrations.views import _validate_dependencies
from apps.products.tests.factories import ProductFactory


@pytest.mark.integration
class TestImportDependenciesValidation(TestCase):
    """–¢–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏ –∏–º–ø–æ—Ä—Ç–∞."""

    def test_images_requires_catalog_validation_fails_when_no_products(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞: images —Ç—Ä–µ–±—É–µ—Ç –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–æ–≤ - –æ—à–∏–±–∫–∞ –µ—Å–ª–∏ –Ω–µ—Ç."""
        # –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç
        Product.objects.all().delete()

        is_valid, error_message = _validate_dependencies(["images"])

        assert not is_valid
        assert "–∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ –ø—É—Å—Ç" in error_message
        assert "–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" in error_message.lower()

    def test_images_validation_passes_when_products_exist(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞: images –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –∫–æ–≥–¥–∞ —Ç–æ–≤–∞—Ä—ã –µ—Å—Ç—å."""
        # –°–æ–∑–¥–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä
        ProductFactory.create()

        is_valid, error_message = _validate_dependencies(["images"])

        assert is_valid
        assert error_message == ""

    def test_multiple_types_validation_with_images(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∏–ø–æ–≤ –≤–∫–ª—é—á–∞—è images."""
        ProductFactory.create()

        is_valid, error_message = _validate_dependencies(["catalog", "images"])

        assert is_valid
```

---

**3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç —Ñ–æ—Ä–º—ã –∏–º–ø–æ—Ä—Ç–∞ (GET –∑–∞–ø—Ä–æ—Å)**

```python
import pytest
from django.test import TestCase, Client
from django.contrib.auth import get_user_model
from django.urls import reverse

User = get_user_model()


@pytest.mark.integration
class TestImportFromView(TestCase):
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã view –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ 1–°."""

    def setUp(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö."""
        self.client = Client()
        # –°–æ–∑–¥–∞—Ç—å admin –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        self.admin_user = User.objects.create_superuser(
            email="admin@test.com",
            password="testpass123"
        )
        self.client.force_login(self.admin_user)

    def test_import_form_displays_images_type(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∏–ø–∞ 'images' –≤ —Ñ–æ—Ä–º–µ –∏–º–ø–æ—Ä—Ç–∞."""
        url = reverse("admin:integrations_import_from_1c")

        response = self.client.get(url)

        assert response.status_code == 200

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–∏–ø–∞ images –≤ context
        import_types = response.context["import_types"]
        images_type = next((t for t in import_types if t["value"] == "images"), None)

        assert images_type is not None
        assert images_type["label"] == "–¢–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤"
        assert images_type["requires_catalog"] is True
        assert "import_files" in images_type["files"]
```

---

**4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç POST –∑–∞–ø—Ä–æ—Å–∞ —Å —Ç–∏–ø–æ–º images**

```python
@pytest.mark.integration
class TestImportPostRequest(TestCase):
    """–¢–µ—Å—Ç—ã POST –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∑–∞–ø—É—Å–∫ –∏–º–ø–æ—Ä—Ç–∞."""

    def setUp(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö."""
        self.client = Client()
        self.admin_user = User.objects.create_superuser(
            email="admin@test.com",
            password="testpass123"
        )
        self.client.force_login(self.admin_user)

    @patch("apps.integrations.views.run_selective_import_task")
    def test_post_images_type_creates_session_with_correct_type(
        self, mock_task
    ):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏ —Å —Ç–∏–ø–æ–º IMAGES –ø—Ä–∏ POST –∑–∞–ø—Ä–æ—Å–µ."""
        # –°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        ProductFactory.create()

        # –ú–æ–∫–∏—Ä—É–µ–º Celery –∑–∞–¥–∞—á—É
        mock_task.delay.return_value.id = "test-task-id"

        url = reverse("admin:integrations_import_from_1c")

        response = self.client.post(url, {"import_type": "images"})

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç
        assert response.status_code == 302

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
        session = ImportSession.objects.filter(
            import_type=ImportSession.ImportType.IMAGES
        ).first()

        assert session is not None
        assert session.status == ImportSession.ImportStatus.STARTED
        assert session.celery_task_id == "test-task-id"

    def test_post_images_type_fails_when_no_products(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∏–º–ø–æ—Ä—Ç–∞ images –±–µ–∑ —Ç–æ–≤–∞—Ä–æ–≤."""
        Product.objects.all().delete()

        url = reverse("admin:integrations_import_from_1c")

        response = self.client.post(url, {"import_type": "images"})

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ —Ñ–æ—Ä–º—É
        assert response.status_code == 302

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–µ—Å—Å–∏—è –ù–ï —Å–æ–∑–¥–∞–Ω–∞
        assert not ImportSession.objects.filter(
            import_type=ImportSession.ImportType.IMAGES
        ).exists()
```

---

**5. Regression —Ç–µ—Å—Ç—ã –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∏–ø–æ–≤**

```python
@pytest.mark.integration
class TestExistingTypesRegression(TestCase):
    """Regression —Ç–µ—Å—Ç—ã: –Ω–æ–≤—ã–π —Ç–∏–ø –Ω–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ."""

    def setUp(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö."""
        self.client = Client()
        self.admin_user = User.objects.create_superuser(
            email="admin@test.com",
            password="testpass123"
        )
        self.client.force_login(self.admin_user)

    @patch("apps.integrations.views.run_selective_import_task")
    def test_catalog_type_still_works(self, mock_task):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞: —Ç–∏–ø catalog —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ."""
        mock_task.delay.return_value.id = "test-task-id"

        url = reverse("admin:integrations_import_from_1c")
        response = self.client.post(url, {"import_type": "catalog"})

        assert response.status_code == 302

        session = ImportSession.objects.filter(
            import_type=ImportSession.ImportType.CATALOG
        ).first()

        assert session is not None

    @patch("apps.integrations.views.run_selective_import_task")
    def test_stocks_type_still_requires_products(self, mock_task):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–∞–ª–∏–¥–∞—Ü–∏—è stocks –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å."""
        Product.objects.all().delete()

        url = reverse("admin:integrations_import_from_1c")
        response = self.client.post(url, {"import_type": "stocks"})

        # –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        assert response.status_code == 302
        assert not ImportSession.objects.filter(
            import_type=ImportSession.ImportType.STOCKS
        ).exists()
```

---

## Change Log

| Date       | Version | Description                                    | Author |
|------------|---------|------------------------------------------------|--------|
| 2025-11-26 | 1.0     | –°–æ–∑–¥–∞–Ω–∏–µ Story 15.1 –Ω–∞ –æ—Å–Ω–æ–≤–µ Epic 15          | Sarah (PO) |

---

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

–¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ:
- Unit-—Ç–µ—Å—Ç—ã –º–æ–¥–µ–ª–∏: 4/4 passed
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã views: 13/13 passed
- –ü–æ–ª–Ω–∞—è regression suite: 54/54 passed
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∏–ø—ã –∏–º–ø–æ—Ä—Ç–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### Completion Notes List

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ç–∏–ø IMAGES –≤ –º–æ–¥–µ–ª—å ImportSession.ImportType
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è 0023_add_images_import_type
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ–æ—Ä–º–∞ –∏–º–ø–æ—Ä—Ç–∞ –≤ views.py —Å –Ω–æ–≤—ã–º —Ç–∏–ø–æ–º "images"
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è _validate_dependencies() –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–∞–ø–ø–∏–Ω–≥ "images" –≤ session_type_map
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω template —Å emoji üñºÔ∏è –¥–ª—è —Ç–∏–ø–∞ images
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ goods/import_files/ –≤ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã –∏ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã 17 —Ç–µ—Å—Ç–æ–≤ (4 unit + 13 integration)
- ‚úÖ –í—Å–µ regression —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ (54/54 passed)
- ‚úÖ Story –≥–æ—Ç–æ–≤–∞ –∫ QA review –∏ merge

### File List

**Modified files:**
- backend/apps/products/models.py (–¥–æ–±–∞–≤–ª–µ–Ω IMAGES –≤ ImportType enum)
- backend/apps/integrations/views.py (–æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ–æ—Ä–º–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –º–∞–ø–ø–∏–Ω–≥)
- backend/templates/admin/integrations/import_1c.html (–¥–æ–±–∞–≤–ª–µ–Ω emoji –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)

**New files:**
- backend/apps/products/migrations/0023_add_images_import_type.py (–º–∏–≥—Ä–∞—Ü–∏—è)
- backend/apps/products/tests/test_import_session_model.py (unit-—Ç–µ—Å—Ç—ã)
- backend/apps/integrations/tests/__init__.py (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤)
- backend/apps/integrations/tests/test_views_images_import.py (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã)

---

## QA Results

_–ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ QA agent –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è_

---

## References

- [Epic 15: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å](../../epics/epic-15/epic-15.admin-image-update.md)
- [ImportSession Model](../../../backend/apps/products/models.py#L641-L719)
- [import_from_1c_view](../../../backend/apps/integrations/views.py#L29-L85)
- [_validate_dependencies()](../../../backend/apps/integrations/views.py#L144-L161)
- [Coding Standards](../../architecture/coding-standards.md)
