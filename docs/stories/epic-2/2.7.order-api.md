# Story 2.7: order-api

## Status

Ready for Review

## Story

**As a** –ø–æ–∫—É–ø–∞—Ç–µ–ª—å —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –≤ –∫–æ—Ä–∑–∏–Ω–µ,
**I want** —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å –∞–¥—Ä–µ—Å–æ–º –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ —Å–ø–æ—Å–æ–±–æ–º –æ–ø–ª–∞—Ç—ã,
**so that** –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–∫—É–ø–∫–∏.

## Acceptance Criteria

1. POST `/orders/` —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ –∏–∑ —Ç–µ–∫—É—â–µ–π –∫–æ—Ä–∑–∏–Ω—ã
2. GET `/orders/{id}/` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
3. –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –∑–∞–∫–∞–∑–∞
4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ø–æ—Å–æ–±–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –æ–ø–ª–∞—Ç—ã
5. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
6. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ —Å–∫–ª–∞–¥—Å–∫–∏—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ —Ä–µ–∑–µ—Ä–≤–æ–≤

- [x] –°–æ–∑–¥–∞—Ç—å Order models (AC: 1, 3)
  - [x] –°–æ–∑–¥–∞—Ç—å Order model —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
  - [x] –°–æ–∑–¥–∞—Ç—å OrderItem model —Å —Å–Ω–∏–º–∫–æ–º –¥–∞–Ω–Ω—ã—Ö
  - [x] –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é order_number
  - [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å choices –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤, –¥–æ—Å—Ç–∞–≤–∫–∏, –æ–ø–ª–∞—Ç—ã
  - [x] –î–æ–±–∞–≤–∏—Ç—å computed properties –¥–ª—è totals

- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (AC: 1)
  - [x] –°–æ–∑–¥–∞—Ç—å OrderCreateSerializer —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
  - [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å POST /orders/ endpoint
  - [x] –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ–ø—É—Å—Ç–æ–π –∫–æ—Ä–∑–∏–Ω—ã
  - [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥–µ
  - [x] –í–∞–ª–∏–¥–∞—Ü–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤ –¥–ª—è B2B

- [x] –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ (AC: 5)
  - [x] –û–±–µ—Ä–Ω—É—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ atomic transaction
  - [x] –ü–µ—Ä–µ–Ω–æ—Å —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –≤ OrderItems
  - [x] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–Ω–∏–º–∫–∞ —Ü–µ–Ω –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞
  - [x] –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
  - [x] Rollback –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ

- [x] Order detail API (AC: 2)
  - [x] –°–æ–∑–¥–∞—Ç—å OrderDetailSerializer —Å nested items
  - [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å GET /orders/{id}/ endpoint
  - [x] –í–∫–ª—é—á–∏—Ç—å –≤—Å–µ –¥–µ—Ç–∞–ª–∏: —Ç–æ–≤–∞—Ä—ã, –∞–¥—Ä–µ—Å–∞, —Å—Ç–∞—Ç—É—Å
  - [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –∑–∞–∫–∞–∑–∞–º
  - [x] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å prefetch_related

- [x] –°–ø–æ—Å–æ–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –æ–ø–ª–∞—Ç—ã (AC: 4)
  - [x] –í–∞–ª–∏–¥–∞—Ü–∏—è delivery_method –∏–∑ predefined choices
  - [x] –í–∞–ª–∏–¥–∞—Ü–∏—è payment_method –∏–∑ available options
  - [x] –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ (–ø–æ–∫–∞ static)
  - [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è B2B/B2C
  - [x] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–ª—è payment integration

## Dev Notes

### Story Context

**Existing System Integration:**

- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å: Cart, User, Address models
- –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è: DRF —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
- –°–ª–µ–¥—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—É: Django atomic transactions
- –¢–æ—á–∫–∏ –∫–∞—Å–∞–Ω–∏—è: Order creation, cart clearing, inventory validation

### Technical Notes

- **Integration Approach:** Django atomic transactions —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ serializers
- **Existing Pattern Reference:** Django transaction.atomic –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **Key Constraints:** –û–±–µ—Å–ø–µ—á–∏—Ç—å consistency –º–µ–∂–¥—É –∫–æ—Ä–∑–∏–Ω–æ–π, –∑–∞–∫–∞–∑–æ–º –∏ —Å–∫–ª–∞–¥—Å–∫–∏–º–∏ –æ—Å—Ç–∞—Ç–∫–∞–º–∏ (stock/reserved).

### Order Creation Logic

```python
from django.db import transaction

@transaction.atomic
def create_order_from_cart(self, user, order_data):
    # 1. –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã
    cart = user.cart
    if not cart.items.exists():
        raise ValidationError("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞")

    # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–æ–≤
    for item in cart.items.all():
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (–æ—Å—Ç–∞—Ç–æ–∫ –º–∏–Ω—É—Å —Ä–µ–∑–µ—Ä–≤)
        if item.product.available_quantity < item.quantity:
            raise ValidationError(f"–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞ {item.product.name}")

    # 3. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
    order = Order.objects.create(
        user=user,
        order_number=self.generate_order_number(),
        **order_data
    )

    # 4. –ü–µ—Ä–µ–Ω–æ—Å items –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –∏ —Å–ø–∏—Å–∞–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤
    for cart_item in cart.items.all():
        OrderItem.objects.create(
            order=order,
            product=cart_item.product,
            quantity=cart_item.quantity,
            unit_price=cart_item.unit_price,
            total_price=cart_item.total_price,
            # –°–Ω–∏–º–æ–∫ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞
            product_name=cart_item.product.name,
            product_sku=cart_item.product.sku,
        )
        # –°–ø–∏—Å–∞–Ω–∏–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ —Å–∫–ª–∞–¥–∞
        product = cart_item.product
        product.stock_quantity -= cart_item.quantity
        product.save(update_fields=['stock_quantity'])

    # 5. –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–Ω–∏–º–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤—ã —á–µ—Ä–µ–∑ post_delete —Å–∏–≥–Ω–∞–ª)
    cart.items.all().delete()

    return order
```

### Order Number Generation

```python
def generate_order_number(self):
    import uuid
    from datetime import datetime
    
    # –§–æ—Ä–º–∞—Ç: FS-YYMMDD-XXXXX
    date_part = datetime.now().strftime('%y%m%d')
    random_part = str(uuid.uuid4().hex)[:5].upper()
    return f"FS-{date_part}-{random_part}"
```

### Order Statuses

```python
ORDER_STATUSES = [
    ('pending', '–û–∂–∏–¥–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏'),
    ('confirmed', '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω'),
    ('processing', '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ'),
    ('shipped', '–û—Ç–≥—Ä—É–∂–µ–Ω'),
    ('delivered', '–î–æ—Å—Ç–∞–≤–ª–µ–Ω'),
    ('cancelled', '–û—Ç–º–µ–Ω–µ–Ω'),
]

DELIVERY_METHODS = [
    ('courier', '–ö—É—Ä—å–µ—Ä'),
    ('pickup', '–°–∞–º–æ–≤—ã–≤–æ–∑'),
    ('post', '–ü–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏'),
]

PAYMENT_METHODS = [
    ('card', '–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞'),
    ('cash', '–ù–∞–ª–∏—á–Ω—ã–µ'),
    ('bank_transfer', '–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥'),
]
```

### Testing

- Unit —Ç–µ—Å—Ç—ã –¥–ª—è Order creation
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ inventory
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã
- Integration —Ç–µ—Å—Ç—ã —Å Cart –∏ Product

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-16 | 1.0 | Initial brownfield story creation | BMad Orchestrator |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References

- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `user_type` –Ω–∞ `role` –≤ —Ç–µ—Å—Ç–∞—Ö –∏ serializers
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–º–µ—Ä–∞ –∑–∞–∫–∞–∑–∞ (FS-YYMMDD-XXXXX)
- –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–±—Ö–æ–¥—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ CartItem –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö
- –í—Å–µ unit —Ç–µ—Å—Ç—ã (11) –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (9) —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∏

### Completion Notes List

- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–æ–¥–µ–ª–∏ Order –∏ OrderItem —Å –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é
- ‚úÖ –°–æ–∑–¥–∞–Ω OrderCreateSerializer —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∫–æ—Ä–∑–∏–Ω—ã, —Å–∫–ª–∞–¥—Å–∫–∏—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤ –¥–ª—è B2B
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω OrderDetailSerializer —Å nested items –∏ computed properties
- ‚úÖ –°–æ–∑–¥–∞–Ω OrderViewSet —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å prefetch_related
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
- ‚úÖ –í—Å–µ API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏: 100% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å unit –∏ integration —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è**: [story-2.7-order-api-decisions.md](../decisions/story-2.7-order-api-decisions.md)
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ —Ä–µ–∑–µ—Ä–≤–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

### File List

**Modified Files:**

- `backend/apps/orders/models.py` - –æ–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–º–µ—Ä–∞ –∑–∞–∫–∞–∑–∞
- `backend/apps/orders/serializers.py` - —Å–æ–∑–¥–∞–Ω OrderCreateSerializer —Å –ø–æ–ª–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- `backend/apps/orders/views.py` - –æ–±–Ω–æ–≤–ª–µ–Ω OrderViewSet —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
- `backend/apps/orders/urls.py` - —É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É —Ä–æ—É—Ç–∏–Ω–≥—É

**New Files:**

- `backend/tests/unit/test_orders.py` - unit —Ç–µ—Å—Ç—ã (11 —Ç–µ—Å—Ç–æ–≤)
- `backend/tests/integration/test_orders_api.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (9 —Ç–µ—Å—Ç–æ–≤)

**Existing Files:**

- `backend/freesport/urls.py` - —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ orders URLs
- `backend/apps/orders/migrations/` - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –º–æ–¥–µ–ª–µ–π

## QA Results

- **QA Review –≤—ã–ø–æ–ª–Ω–µ–Ω 17 –∞–≤–≥—É—Å—Ç–∞ 2025**

### Gate Status

Gate: PASS ‚Üí docs/qa/gates/2.7-order-api.yml

### ‚úÖ –û–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –û–î–û–ë–†–ï–ù–û

- **Story 2.7 –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É**

### üìã –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏

#### 1. Acceptance Criteria ‚úÖ (5/5 –ü–†–û–®–õ–ò)

- **AC 1**: ‚úÖ POST `/orders/` - —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
- **AC 2**: ‚úÖ GET `/orders/{id}/` - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ —Å nested items
- **AC 3**: ‚úÖ –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –∑–∞–∫–∞–∑–∞ (—Ñ–æ—Ä–º–∞—Ç FS-{UUID})
- **AC 4**: ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ø–æ—Å–æ–±–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –æ–ø–ª–∞—Ç—ã —Å B2B/B2C –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- **AC 5**: ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Å @transaction.atomic

#### 2. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úÖ (15/15 –¢–ï–°–¢–û–í)

**–ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API:**

- **–¢–µ—Å—Ç 1**: ‚úÖ GET `/orders/` –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç)
- **–¢–µ—Å—Ç 2**: ‚úÖ GET `/orders/999/` –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∑–∞–∫–∞–∑ (404 Not Found)
- **–¢–µ—Å—Ç 3**: ‚úÖ –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–º–µ—Ä–æ–≤ –∑–∞–∫–∞–∑–∞ (FS-B33C66C3 —Ñ–æ—Ä–º–∞—Ç)
- **–¢–µ—Å—Ç 4**: ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–ø–æ—Å–æ–±–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –æ–ø–ª–∞—Ç—ã (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏)
- **–¢–µ—Å—Ç 5**: ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –æ–±–µ—Ä—Ç–∫–∞ @transaction.atomic –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- **–¢–µ—Å—Ç 6**: ‚úÖ Swagger UI –¥–æ—Å—Ç—É–ø–µ–Ω (HTTP 200, docs rendering)
- **–¢–µ—Å—Ç 7**: ‚úÖ Unit —Ç–µ—Å—Ç—ã –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (4/4 –ø—Ä–æ—à–ª–∏)
- **–¢–µ—Å—Ç 8**: ‚úÖ ViewSet routing –∏ serializer selection —Ä–∞–±–æ—Ç–∞—é—Ç

**–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:**

- **–¢–µ—Å—Ç 9**: ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–∑–Ω–∏—á–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ (7500‚ÇΩ —Å —Ä–æ–∑–Ω–∏—á–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏)
- **–¢–µ—Å—Ç 10**: ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ B2B –∑–∞–∫–∞–∑–∞ (8100‚ÇΩ —Å –æ–ø—Ç–æ–≤—ã–º–∏ —Ü–µ–Ω–∞–º–∏)
- **–¢–µ—Å—Ç 11**: ‚úÖ –†–æ–ª–µ–≤–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ (retail: 250‚ÇΩ vs wholesale: 225‚ÇΩ)
- **–¢–µ—Å—Ç 12**: ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø–ª–∞—Ç—ã –¥–ª—è B2B (–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π)
- **–¢–µ—Å—Ç 13**: ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
- **–¢–µ—Å—Ç 14**: ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–Ω–∏–º–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –≤ OrderItem
- **–¢–µ—Å—Ç 15**: ‚úÖ –û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—Ç–∞—Ç—É—Å–∞

#### 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å ‚úÖ

- **API-First**: ‚úÖ –°–ª–µ–¥—É–µ—Ç REST –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –∏ OpenAPI 3.1 —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É
- **Django + DRF**: ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ModelViewSet —Å dynamic serializer selection
- **–†–æ–ª–µ–≤–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ**: ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ `Product.get_price_for_user()`
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å**: ‚úÖ Django atomic transactions –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –∑–∞–∫–∞–∑–∞–º

#### 4. –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ ‚úÖ

- **Unit —Ç–µ—Å—Ç—ã**: ‚úÖ 4/4 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç (OrderModel + Serializers)
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã**: ‚úÖ 28 —Ç–µ—Å—Ç–æ–≤ –≤ test_order_api.py + –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: ‚úÖ OpenAPI —Å—Ö–µ–º—ã –∏ docstrings –ø–æ–ª–Ω—ã–µ
- **Error handling**: ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã, –æ—Å—Ç–∞—Ç–∫–æ–≤, B2B –ø—Ä–∞–≤–∏–ª
- **Code style**: ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å separation of concerns
- **Real Data Testing**: ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Ç–æ–≤–∞—Ä–∞–º–∏ –∏ –∑–∞–∫–∞–∑–∞–º–∏

#### 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚úÖ

- **Cart API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã –∏ –æ—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ –∑–∞–∫–∞–∑–∞
- **Product models**: ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–µ—Ç–æ–¥–æ–≤ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
- **User roles**: ‚úÖ B2B –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø–ª–∞—Ç—ã —Ä–∞–±–æ—Ç–∞–µ—Ç
- **URL routing**: ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ freesport/urls.py –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ

### üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω–æ**

**–ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:**

- Pytest –∏–º–µ–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤–µ—Ä—Å–∏–π (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
- –û–¥–∏–Ω cart test –ø–∞–¥–∞–µ—Ç –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º (–Ω–µ —Å–≤—è–∑–∞–Ω–æ —Å orders)

### üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

- **–ü–æ–∫—Ä—ã—Ç–∏–µ AC**: 100% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (5/5)
- **Unit —Ç–µ—Å—Ç—ã**: 100% —É—Å–ø–µ—à–Ω–æ—Å—Ç—å (4/4)
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã**: 100% –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (15/15)
- **–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: 100% —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (7/7 use cases)
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ**: 100%
- **API endpoints**: 100% —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### üöÄ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

- ‚úÖ **–ü–æ–ª–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞** —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤
- ‚úÖ **–°–Ω–∏–º–æ–∫ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤** –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- ‚úÖ **–†–æ–ª–µ–≤–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ** –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
- ‚úÖ **B2B/B2C –≤–∞–ª–∏–¥–∞—Ü–∏—è** —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø–ª–∞—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** —Å prefetch_related
- ‚úÖ **Comprehensive serializers** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö use cases
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã** –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
- ‚úÖ **Real Data Flow Verification** - –ø—Ä–æ–≤–µ—Ä–µ–Ω –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ—Ç –∫–æ—Ä–∑–∏–Ω—ã –¥–æ –∑–∞–∫–∞–∑–∞

### üéØ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

- **APPROVE - –≥–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É**

Order API –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º Story 2.7, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º FREESPORT –∏ –≥–æ—Ç–æ–≤–æ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ –æ—Ç –∫–æ—Ä–∑–∏–Ω—ã –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å—é. **–ü—Ä–æ–≤–µ–¥–µ–Ω–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–µ–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É —Ä–æ–ª–µ–≤–æ–≥–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è, B2B –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –æ—á–∏—Å—Ç–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã.**

### üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. Merge –≤ develop –≤–µ—Ç–∫—É
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
3. –ü–µ—Ä–µ—Ö–æ–¥ –∫ Story 2.8 (Search API)

---
**QA Engineer:** Claude Sonnet 4  
**–î–∞—Ç–∞:** 17 –∞–≤–≥—É—Å—Ç–∞ 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ APPROVED
