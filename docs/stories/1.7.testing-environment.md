# Story 1.7: testing-environment

## Status
Draft

## Story
**As a** разработчик,
**I want** настроить среду для тестирования приложения,
**so that** обеспечить качество разрабатываемого кода и предотвратить регрессии.

## Acceptance Criteria

1. Настроены unit тесты для Django (pytest)
2. Настроены unit тесты для React (Jest)
3. Созданы базовые тестовые конфигурации
4. Настроена тестовая база данных
5. Добавлены примеры тестов для основных компонентов

## Tasks / Subtasks

- [ ] Настроить pytest для Django backend (AC: 1)
  - [ ] Установить pytest и pytest-django
  - [ ] Создать pytest.ini конфигурацию
  - [ ] Настроить test database settings
  - [ ] Добавить coverage reporting (pytest-cov)

- [ ] Настроить Jest для React frontend (AC: 2)
  - [ ] Установить Jest и React Testing Library
  - [ ] Создать jest.config.js для Next.js
  - [ ] Настроить jsdom environment для DOM тестов
  - [ ] Добавить coverage reporting для frontend

- [ ] Создать тестовые конфигурации (AC: 3)
  - [ ] Настроить test-specific environment variables
  - [ ] Создать mock конфигурации для внешних API
  - [ ] Настроить test fixtures и factories
  - [ ] Добавить setup/teardown процедуры для тестов

- [ ] Настроить тестовую базу данных (AC: 4)
  - [ ] Создать separate test database configuration
  - [ ] Настроить in-memory database для unit тестов
  - [ ] Добавить test data seeding механизм
  - [ ] Настроить database isolation между тестами

- [ ] Создать примеры базовых тестов (AC: 5)
  - [ ] Unit тесты для User model и authentication
  - [ ] API endpoint тесты для DRF ViewSets
  - [ ] React component тесты с RTL
  - [ ] Integration тесты для API-Frontend связи

## Dev Notes

### Технический контекст из архитектуры:

**Testing Strategy:**
- **Backend:** pytest-django с фабриками данных
- **Frontend:** Jest + React Testing Library + MSW
- **E2E:** Playwright для критических user flows
- **Coverage Target:** минимум 80% для всех компонентов

**Testing Tools Configuration:**
```python
# Backend (pytest.ini)
[tool:pytest]
DJANGO_SETTINGS_MODULE = freesport.settings.test
addopts = --cov=apps --cov-report=html --cov-report=term
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
```

```javascript
// Frontend (jest.config.js)
module.exports = {
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  collectCoverageFrom: [
    'src/**/*.{js,jsx,ts,tsx}',
    '!src/**/*.d.ts',
  ],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80,
    },
  },
}
```

**Test Database Configuration:**
```python
# settings/test.py
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': ':memory:',
    }
}

# Или для PostgreSQL test database
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'freesport_test',
        'TEST': {'NAME': 'freesport_test'},
    }
}
```

**Testing File Structure:**
```
backend/
├── tests/
│   ├── __init__.py
│   ├── conftest.py        # pytest fixtures
│   ├── factories.py       # Model factories  
│   ├── test_users/        # User app tests
│   ├── test_products/     # Product app tests
│   └── test_integration/  # Integration tests

frontend/
├── src/
│   ├── components/
│   │   └── __tests__/     # Component tests
│   ├── hooks/
│   │   └── __tests__/     # Hook tests
│   └── services/
│       └── __tests__/     # Service tests
├── jest.config.js
├── jest.setup.js
└── __mocks__/             # Mock definitions
```

**Mock Strategy:**
- **External APIs:** MSW (Mock Service Worker) для API mocking
- **Database:** Factory Boy для создания тестовых данных
- **Authentication:** JWT mock tokens для тестов
- **File Storage:** In-memory file system для тестов

### Testing

**Testing Standards:**
- Test file naming: test_*.py (backend), *.test.tsx (frontend)
- Test organization: По модулям/компонентам
- Coverage reporting: HTML + terminal output
- CI Integration: Автоматический запуск в GitHub Actions

**Тестирование для этой истории:**
- Валидация pytest конфигурации и запуска
- Проверка Jest setup и React component тестов
- Тест создания и очистки test database
- Валидация coverage reporting работы
- Проверка mock configurations

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-08 | 1.0 | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_TBD - будет заполнено dev агентом_

### Debug Log References  
_TBD - будет заполнено dev агентом_

### Completion Notes List
_TBD - будет заполнено dev агентом_

### File List
_TBD - будет заполнено dev агентом_

## QA Results
_TBD - будет заполнено QA агентом_