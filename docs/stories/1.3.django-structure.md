# Story 1.3: django-structure

## Status
Draft

## Story
**As a** разработчик,
**I want** создать backend структуру с Django + DRF,
**so that** иметь основу для API разработки FREESPORT платформы.

## Acceptance Criteria

1. Создан Django проект с правильной структурой приложений
2. Установлен и настроен Django REST Framework  
3. Настроены базовые middleware и настройки безопасности
4. Созданы основные модели пользователей и ролей
5. Настроена базовая аутентификация через JWT

## Tasks / Subtasks

- [ ] Создать Django проект и приложения (AC: 1)
  - [ ] Инициализировать Django проект freesport
  - [ ] Создать приложения: users, products, orders, cart
  - [ ] Настроить settings.py для разных окружений (dev/staging/prod)
  - [ ] Создать базовую структуру URL routing

- [ ] Установить и настроить DRF (AC: 2)
  - [ ] Установить Django REST Framework 3.14+
  - [ ] Добавить DRF в INSTALLED_APPS
  - [ ] Настроить DRF settings (pagination, permissions)
  - [ ] Создать базовые ViewSets и Serializers

- [ ] Настроить безопасность и middleware (AC: 3)
  - [ ] Настроить CORS headers для frontend интеграции
  - [ ] Добавить security middleware (XSS, CSRF protection)
  - [ ] Настроить ALLOWED_HOSTS для разных окружений  
  - [ ] Конфигурировать HTTPS redirect в production

- [ ] Создать модели пользователей (AC: 4)
  - [ ] Создать кастомную модель User с email аутентификацией
  - [ ] Реализовать систему ролей (retail, wholesale_level1-3, trainer, federation_rep)
  - [ ] Создать модели Company, Address для B2B функционала
  - [ ] Настроить миграции для пользовательских моделей

- [ ] Настроить JWT аутентификацию (AC: 5)
  - [ ] Установить djangorestframework-simplejwt
  - [ ] Настроить JWT settings (access/refresh токены)
  - [ ] Создать endpoints для login/logout/refresh
  - [ ] Реализовать JWT middleware для API защиты

## Dev Notes

### Технический контекст из архитектуры:

**Django Configuration:**
- Версия: Django 4.2 LTS + DRF 3.14+
- База данных: PostgreSQL 15+ с настройками подключения
- Кеш: Redis 7.0+ для сессий и Celery
- Authentication: JWT токены с refresh стратегией

**Структура приложений Django:**
```
backend/
├── manage.py
├── requirements.txt
├── freesport/
│   ├── settings/
│   │   ├── __init__.py
│   │   ├── base.py
│   │   ├── development.py
│   │   ├── staging.py  
│   │   └── production.py
│   ├── urls.py
│   └── wsgi.py
├── apps/
│   ├── users/       # Пользователи и роли
│   ├── products/    # Каталог товаров
│   ├── orders/      # Система заказов
│   ├── cart/        # Корзина покупок
│   └── common/      # Общие утилиты
└── tests/
```

**User Roles система:**
```python
USER_ROLES = [
    ('retail', 'Розничный покупатель'),
    ('wholesale_level1', 'Оптовик уровень 1'),
    ('wholesale_level2', 'Оптовик уровень 2'), 
    ('wholesale_level3', 'Оптовик уровень 3'),
    ('trainer', 'Тренер'),
    ('federation_rep', 'Представитель федерации'),
]
```

**JWT Configuration:**
```python
SIMPLE_JWT = {
    'ACCESS_TOKEN_LIFETIME': timedelta(minutes=60),
    'REFRESH_TOKEN_LIFETIME': timedelta(days=7),
    'ROTATE_REFRESH_TOKENS': True,
    'BLACKLIST_AFTER_ROTATION': True,
}
```

**Database Settings:**
- ENGINE: django.db.backends.postgresql
- Подключение через DATABASE_URL environment variable
- Настройки для connection pooling

### Testing

**Testing Standards:**
- Test framework: pytest-django для Django тестов
- Test файлы: tests/ директория в каждом приложении
- Coverage: минимум 80% для models и views
- Naming convention: test_*.py файлы

**Тестирование для этой истории:**
- Unit тесты для пользовательских моделей
- Тесты JWT аутентификации endpoints
- Тесты middleware и security settings
- Integration тесты для DRF ViewSets
- Валидация миграций базы данных

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-08 | 1.0 | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_TBD - будет заполнено dev агентом_

### Debug Log References  
_TBD - будет заполнено dev агентом_

### Completion Notes List
_TBD - будет заполнено dev агентом_

### File List
_TBD - будет заполнено dev агентом_

## QA Results
_TBD - будет заполнено QA агентом_