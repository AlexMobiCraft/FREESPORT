# Story 3.1.1: –ü–∞—Ä—Å–∏–Ω–≥ –ø—É—Ç–µ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ XML - Brownfield Enhancement

## Status

Draft

## Story Title

–ü–∞—Ä—Å–∏–Ω–≥ –ø—É—Ç–µ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ goods.xml - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ XMLDataParser

## User Story

**As a** —Å–∏—Å—Ç–µ–º–∞ –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ 1–°,
**I want** –∏–∑–≤–ª–µ–∫–∞—Ç—å –≤—Å–µ –ø—É—Ç–∏ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –∏–∑ —Ç–µ–≥–æ–≤ `<–ö–∞—Ä—Ç–∏–Ω–∫–∞>` –≤ goods.xml,
**so that** —ç—Ç–∏ –ø—É—Ç–∏ –º–æ–≥–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ Django media storage.

## Story Context

### Existing System Integration

**–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å:**
- `XMLDataParser` ([backend/apps/products/services/parser.py](backend/apps/products/services/parser.py:75-461)) - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ä—Å–µ—Ä CommerceML 3.1
- `parse_goods_xml()` –º–µ—Ç–æ–¥ ([backend/apps/products/services/parser.py:164-207](backend/apps/products/services/parser.py#L164-L207)) - –ø–∞—Ä—Å–∏–Ω–≥ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- `GoodsData` TypedDict ([backend/apps/products/services/parser.py:13-22](backend/apps/products/services/parser.py#L13-L22)) - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Python 3.11+ —Å type hints
- defusedxml.ElementTree –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ XML
- Django settings –¥–ª—è –ø—É—Ç–µ–π –∫ —Ñ–∞–π–ª–∞–º
- CommerceML 3.1 —Ñ–æ—Ä–º–∞—Ç –≤—ã–≥—Ä—É–∑–∫–∏ 1–°

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω:**
```python
# –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è parse_goods_xml() –≤ parser.py:198-202
image_elements = self._find_children(product_element, "–ö–∞—Ä—Ç–∏–Ω–∫–∞")
if image_elements:
    goods_data["images"] = [
        image.text.strip() for image in image_elements if image.text
    ]
```

**–¢–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `GoodsData` TypedDict - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è `images: list[str]` (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!)
2. –ú–µ—Ç–æ–¥ `parse_goods_xml()` - —É–∂–µ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø—É—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ —Ç–µ–≥–æ–≤ `<–ö–∞—Ä—Ç–∏–Ω–∫–∞>`
3. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã `_find_children()` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

‚úÖ **–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- `GoodsData` TypedDict —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `images: list[str]` (—Å—Ç—Ä–æ–∫–∞ 21)
- `parse_goods_xml()` –∏–∑–≤–ª–µ–∫–∞–µ—Ç –≤—Å–µ —Ç–µ–≥–∏ `<–ö–∞—Ä—Ç–∏–Ω–∫–∞>` (—Å—Ç—Ä–æ–∫–∏ 198-202)
- –ü—É—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ `goods_data["images"]` –∫–∞–∫ —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫

‚ùå **–ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:**
1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–µ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π** - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Ç–µ–π
3. **Unit-—Ç–µ—Å—Ç—ã** –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

## Acceptance Criteria

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—É—Ç–µ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ XML**
   - ‚úÖ XMLDataParser.parse_goods_xml() –∏–∑–≤–ª–µ–∫–∞–µ—Ç –≤—Å–µ —Ç–µ–≥–∏ `<–ö–∞—Ä—Ç–∏–Ω–∫–∞>` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ (–£–ñ–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û)
   - ‚úÖ –ü—É—Ç–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–æ–ª–µ `images` –∫–∞–∫ —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫ –≤ GoodsData (–£–ñ–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û)
   - ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ (–£–ñ–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û)
   - ‚úÖ –ü—É—Å—Ç—ã–µ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–µ–≥–∏ `<–ö–∞—Ä—Ç–∏–Ω–∫–∞>` –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç –æ—à–∏–±–æ–∫ (–£–ñ–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û)

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–µ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨)**
   - ‚ö†Ô∏è –ü—É—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å **—Ñ–æ—Ä–º–∞—Ç–∞ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**
   - ‚ö†Ô∏è –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è: `.jpg`, `.jpeg`, `.png`, `.webp` (case-insensitive)
   - ‚ö†Ô∏è –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –ø—É—Ç–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ WARNING –∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è (–Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ goods_data["images"])
   - ‚ö†Ô∏è –ü—É—Ç–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è (—É–±–∏—Ä–∞—é—Ç—Å—è –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã, backslashes –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ forward slashes)
   - ‚ö†Ô∏è **–ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è** —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ (scope Story 3.1.2)
   - ‚ö†Ô∏è **–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞:** –í goods_data["images"] –æ—Å—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—É—Ç–∏ —Å –¥–æ–ø—É—Å—Ç–∏–º—ã–º–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases**
   - ‚úÖ –¢–æ–≤–∞—Ä—ã –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è (–ø–æ–ª–µ images –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫) (–£–ñ–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û)
   - ‚ö†Ô∏è –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –ø—É—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è (–î–û–ë–ê–í–ò–¢–¨)
   - ‚ö†Ô∏è **–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—Ö–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:** –ï—Å–ª–∏ XML —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ç–µ–≥–æ–≤ <–ö–∞—Ä—Ç–∏–Ω–∫–∞> –¥–ª—è —Ç–æ–≤–∞—Ä–∞, –≤ goods_data["images"] –∫–∞–∂–¥—ã–π –ø—É—Ç—å –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
   - ‚ö†Ô∏è –ü—É—Ç–∏ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
   - ‚ö†Ô∏è **–ü—Ä–∏–º–µ—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –ø—É—Ç–µ–π:** `import_files/73/image.png`, `import_files/AB/test image.jpg`, `import_files\73\image.webp` (–Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ forward slashes)
   - ‚ö†Ô∏è **–ü—Ä–∏–º–µ—Ä—ã –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –ø—É—Ç–µ–π:** `image.exe`, `file.txt`, ``, –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

4. **–°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç–æ–π**
   - ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ unit-—Ç–µ—Å—Ç—ã –¥–ª—è `parse_goods_xml()` –ø—Ä–æ—Ö–æ–¥—è—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ GoodsData TypedDict –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è (—Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–µ images)
   - ‚úÖ API XMLDataParser –æ—Å—Ç–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º

5. **–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã —Å–ª–µ–¥—É—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º**
   - ‚ö†Ô∏è –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–µ–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–∞–∫ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –º–µ—Ç–æ–¥ `_validate_image_path(path: str) -> str | None`
   - ‚ö†Ô∏è **–î–æ–±–∞–≤–∏—Ç—å logger:** –í –Ω–∞—á–∞–ª–æ parser.py –¥–æ–±–∞–≤–∏—Ç—å `import logging` –∏ `logger = logging.getLogger(__name__)` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
   - ‚ö†Ô∏è –°–ª–µ–¥—É–µ—Ç —Å—Ç–∏–ª—é –∫–æ–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞ (type hints, docstrings)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞

6. **–ö–æ–¥ –ø–æ–∫—Ä—ã—Ç unit-—Ç–µ—Å—Ç–∞–º–∏**
   - ‚ö†Ô∏è –¢–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ XML –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ `data/import_1c/goods/goods_*.xml`
   - ‚ö†Ô∏è –¢–µ—Å—Ç—ã edge cases: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –ø—É—Ç–∏
   - ‚ö†Ô∏è –ü–æ–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ >= 90%

7. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞**
   - ‚ö†Ô∏è Docstring –º–µ—Ç–æ–¥–∞ `parse_goods_xml()` –≤–∫–ª—é—á–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - ‚ö†Ô∏è –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∫–æ–¥–∞

## Tasks / Subtasks

- [ ] **Task 1: –î–æ–±–∞–≤–∏—Ç—å logger –≤ parser.py** (AC: 5)
  - [ ] –î–æ–±–∞–≤–∏—Ç—å `import logging` –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞
  - [ ] –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä logger: `logger = logging.getLogger(__name__)`

- [ ] **Task 2: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `_validate_image_path()`** (AC: 2, 3)
  - [ ] –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –º–µ—Ç–æ–¥ `_validate_image_path(path: str) -> str | None`
  - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –∏ —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö
  - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –ø—É—Ç–∏ (strip, –∑–∞–º–µ–Ω–∞ `\` –Ω–∞ `/`)
  - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞ (`.jpg`, `.jpeg`, `.png`, `.webp`)
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ WARNING –¥–ª—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –ø—É—Ç–µ–π
  - [ ] –î–æ–±–∞–≤–∏—Ç—å docstring —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –º–µ—Ç–æ–¥–∞

- [ ] **Task 3: –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–æ–¥ `parse_goods_xml()` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏** (AC: 2, 3)
  - [ ] –ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –ª–æ–≥–∏–∫—É –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—Å—Ç—Ä–æ–∫–∏ 198-202)
  - [ ] –î–æ–±–∞–≤–∏—Ç—å —Ü–∏–∫–ª —Å –≤—ã–∑–æ–≤–æ–º `_validate_image_path()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—É—Ç–∏
  - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ `set()` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø—É—Ç–µ–π
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å docstring –º–µ—Ç–æ–¥–∞ `parse_goods_xml()` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

- [ ] **Task 4: –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã** (AC: 6)
  - [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `backend/tests/unit/test_services/test_parser.py`
  - [ ] –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä–∫–∏—Ä–æ–≤–∫—É `@pytest.mark.unit` –∏ `@pytest.mark.django_db`
  - [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_parse_goods_xml_with_single_image`
  - [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_parse_goods_xml_with_multiple_images`
  - [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_parse_goods_xml_with_no_images`
  - [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_parse_goods_xml_with_invalid_image_extension`
  - [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_parse_goods_xml_with_duplicate_image_paths`
  - [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_parse_goods_xml_with_real_data` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π XML)
  - [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_validate_image_path_normalization`
  - [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç `test_validate_image_path_supported_extensions`

- [ ] **Task 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏** (AC: 6)
  - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å —Ñ–ª–∞–≥–æ–º `--cov=apps.products.services.parser`
  - [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–æ–∫—Ä—ã—Ç–∏–µ >= 90% –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
  - [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (AC: 4)

- [ ] **Task 6: Code review –∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è** (AC: 7)
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ type hints –∏ docstrings
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ coding standards –ø—Ä–æ–µ–∫—Ç–∞
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è

## Dev Notes

### Logging Configuration

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ logger –≤ parser.py:**

```python
import logging

logger = logging.getLogger(__name__)
```

–≠—Ç–æ—Ç logger –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –ø—É—Ç—è—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. Django –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–≥–ª–∞—Å–Ω–æ `settings.LOGGING`.

## üìù ADVISORY NOTES

1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥ `_validate_image_path()` –∏–∑ —Å–µ–∫—Ü–∏–∏ Dev Notes –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–Ω—É—é —Ç–æ—á–∫—É –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
2. ‚úÖ –ù–∞—á–Ω–∏—Ç–µ —Å –Ω–∞–ø–∏—Å–∞–Ω–∏—è unit-—Ç–µ—Å—Ç–æ–≤ (—Å–º. –ø—Ä–∏–º–µ—Ä—ã –≤ —Ä–∞–∑–¥–µ–ª–µ Testing Strategy) –∏ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ—Å—å AAA-–ø–∞—Ç—Ç–µ—Ä–Ω–∞.
3. ‚ö†Ô∏è –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –±–∞—Ç—á–∏–Ω–≥ WARNING-–ª–æ–≥–æ–≤ –¥–ª—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –ø—É—Ç–µ–π, —á—Ç–æ–±—ã —É–º–µ–Ω—å—à–∏—Ç—å —à—É–º –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –æ—à–∏–±–æ–∫.
4. ‚úÖ –ë–∞–∑–æ–≤—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω ‚Äî —Å—Ñ–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –ø—É—Ç–µ–π.
5. ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ `backend/apps/products/services/parser.py`, —á—Ç–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ä–∏—Å–∫ –∑–∞—Ç—Ä–æ–Ω—É—Ç—å –¥—Ä—É–≥–∏–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã.

## Technical Notes

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ XML –∏–∑ 1–° (CommerceML 3.1)

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ XML –∏–∑ goods.xml:**
```xml
<–¢–æ–≤–∞—Ä>
    <–ò–¥>73f9d61e-5673-11f0-8041-fa163ea88911</–ò–¥>
    <–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ>–î–µ—Ç—Å–∫–∏–π –∑–∞—â–∏—Ç–Ω—ã–π –≤–µ–ª–æ—à–ª–µ–º COSMORIDE</–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ>
    <–ö–∞—Ä—Ç–∏–Ω–∫–∞>import_files/73/73f9d61e-5673-11f0-8041-fa163ea88911_a62d33ce-5673-11f0-8041-fa163ea88911.png</–ö–∞—Ä—Ç–∏–Ω–∫–∞>
    <!-- –í–æ–∑–º–æ–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–≥–∏ <–ö–∞—Ä—Ç–∏–Ω–∫–∞> –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏ -->
    <–ö–∞—Ä—Ç–∏–Ω–∫–∞>import_files/73/73f9d61e-5673-11f0-8041-fa163ea88911_a62d33ce-5673-11f0-8041-fa163ea88912.jpg</–ö–∞—Ä—Ç–∏–Ω–∫–∞>
</–¢–æ–≤–∞—Ä>
```

**–§–æ—Ä–º–∞—Ç –ø—É—Ç–µ–π:**
- –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏: `import_files/73/filename.png`
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞: `import_files/{–ø–µ—Ä–≤—ã–µ_2_—Å–∏–º–≤–æ–ª–∞_ID}/{ID_—Ç–æ–≤–∞—Ä–∞}_{ID_—Ñ–∞–π–ª–∞}.{—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ}`
- –ë–∞–∑–æ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: `data/import_1c/goods/`

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—É—Ç–µ–π

**–ù–æ–≤—ã–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –º–µ—Ç–æ–¥ –≤ XMLDataParser:**

```python
def _validate_image_path(self, path: str) -> str | None:
    """
    –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Ç–∏ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é

    Args:
        path: –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –∏–∑ XML

    Returns:
        –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø—É—Ç—å –∏–ª–∏ None –µ—Å–ª–∏ –ø—É—Ç—å –Ω–µ–≤–∞–ª–∏–¥–µ–Ω
    """
    if not path or not isinstance(path, str):
        return None

    # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Ç–∏
    normalized = path.strip().replace("\\", "/")

    # –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
    valid_extensions = {".jpg", ".jpeg", ".png", ".webp"}
    _, ext = os.path.splitext(normalized.lower())

    if ext not in valid_extensions:
        logger.warning(f"Invalid image extension: {path}")
        return None

    return normalized
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Django settings

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**

```python
# backend/freesport/settings/base.py:235-238
ONEC_DATA_DIR = os.environ.get(
    "ONEC_DATA_DIR",
    str(BASE_DIR / "data" / "import_1c")
)
```

**–í–∞–∂–Ω–æ:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —ç—Ç–∞–ø–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ XML –ø—Ä–æ–≤–µ—Ä—è–µ—Ç **–¢–û–õ–¨–ö–û —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏ —Ñ–æ—Ä–º–∞—Ç** –ø—É—Ç–∏
- **–ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç** —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ (—ç—Ç–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å Story 3.1.2)
- `ONEC_DATA_DIR` –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ Story 3.1.2 –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω—ã—Ö –ø—É—Ç–µ–π –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏

**Scope —Ç–µ–∫—É—â–µ–π story:**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞ (`.jpg`, `.jpeg`, `.png`, `.webp`)
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Ç–∏ (–∑–∞–º–µ–Ω–∞ `\` –Ω–∞ `/`, —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤ –ø–æ –∫—Ä–∞—è–º)
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø—É—Ç–µ–π –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
- ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –Ω–∞ –¥–∏—Å–∫–µ (Story 3.1.2)
- ‚ùå –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ media storage (Story 3.1.2)

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ parse_goods_xml():**

```python
# –í –º–µ—Ç–æ–¥–µ parse_goods_xml(), —Å—Ç—Ä–æ–∫–∏ 198-202
image_elements = self._find_children(product_element, "–ö–∞—Ä—Ç–∏–Ω–∫–∞")
if image_elements:
    validated_images = []
    seen_paths = set()  # –î–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

    for image in image_elements:
        if image.text:
            validated_path = self._validate_image_path(image.text.strip())
            if validated_path and validated_path not in seen_paths:
                validated_images.append(validated_path)
                seen_paths.add(validated_path)

    if validated_images:
        goods_data["images"] = validated_images
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ProductDataProcessor

**–°–≤—è–∑—å —Å Story 3.1.2:**
- ProductDataProcessor –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `goods_data["images"]` –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—É—Ç–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∞ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–ù–û –ù–ï —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –Ω–∞ –¥–∏—Å–∫–µ - —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç Story 3.1.2)
- –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—É—Ç–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å Django `default_storage.save()`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**
- **–ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –ø—É—Ç–∏** - WARNING –ª–æ–≥, –ø—É—Ç—å –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è, –∏–º–ø–æ—Ä—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** - –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–æ–π, —Ç–æ–≤–∞—Ä –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–î—É–±–ª–∏–∫–∞—Ç—ã –ø—É—Ç–µ–π** - –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ set

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
logger.warning(f"Invalid image path for product {goods_data['id']}: {path}")
logger.debug(f"Found {len(validated_images)} valid images for product {goods_data['id']}")
```

## Definition of Done

- [x] **–ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω** (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ parser.py:198-202)
- [ ] **–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–µ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `_validate_image_path()`
- [ ] **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø—É—Ç–µ–π** —á–µ—Ä–µ–∑ set –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ
- [ ] **–ù–∞–ø–∏—Å–∞–Ω—ã unit-—Ç–µ—Å—Ç—ã** –≤ `backend/tests/unit/test_services/test_parser.py` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- [ ] **–í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç** –±–µ–∑ —Ä–µ–≥—Ä–µ—Å—Å–∏–π
- [ ] **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞** (docstrings –≤ parse_goods_xml() –∏ _validate_image_path())
- [ ] **Code review –ø—Ä–æ–π–¥–µ–Ω** - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∏ —Å—Ç–∏–ª—è –∫–æ–¥–∞
- [ ] **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ >= 90%** –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## Testing Strategy

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

**üî¥ –ö–†–ò–¢–ò–ß–ù–û:** –í—Å–µ —Ç–µ—Å—Ç—ã –î–û–õ–ñ–ù–´ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å [Testing Strategy](docs/architecture/10-testing-strategy.md) –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –∏–∑–æ–ª—è—Ü–∏–∏ (—Ä–∞–∑–¥–µ–ª 10.4).

### Unit-—Ç–µ—Å—Ç—ã

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –°–æ–≥–ª–∞—Å–Ω–æ [Testing Strategy ¬ß10.2](docs/architecture/10-testing-strategy.md#10.2), —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª `backend/tests/unit/test_services/test_parser.py`

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
- Unit-—Ç–µ—Å—Ç—ã —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –≤ `backend/tests/unit/`
- –ü–∞—Ä—Å–µ—Ä –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ —Å–µ—Ä–≤–∏—Å–Ω—ã–º –∫–ª–∞—Å—Å–∞–º ‚Üí –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `test_services/`
- –ò–∑–æ–ª—è—Ü–∏—è –æ—Ç app-specific —Ç–µ—Å—Ç–æ–≤ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ª—É—á—à—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤ (¬ß10.6.2):**
```python
import pytest

# –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è –≤—Å–µ–≥–æ –º–æ–¥—É–ª—è
pytestmark = pytest.mark.django_db

@pytest.mark.unit
class TestXMLDataParserImageParsing:
    """Unit-—Ç–µ—Å—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ goods.xml"""
    # —Ç–µ—Å—Ç—ã –∑–¥–µ—Å—å
```

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–∑–æ–ª—è—Ü–∏–∏ (¬ß10.4)

**üö® –ö–†–ò–¢–ò–ß–ù–û:** –î–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è constraint violations –∏ flaky tests:

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_unique_suffix()` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (¬ß10.4.2):**
```python
from tests.conftest import get_unique_suffix

# –í —Ç–µ—Å—Ç–æ–≤—ã—Ö XML –¥–∞–Ω–Ω—ã—Ö:
unique_id = get_unique_suffix()
xml_content = f"""
<–ö–∞—Ç–∞–ª–æ–≥>
    <–¢–æ–≤–∞—Ä—ã>
        <–¢–æ–≤–∞—Ä>
            <–ò–¥>{unique_id}</–ò–¥>
            ...
```

2. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ pytest –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (¬ß10.4.3):**
   - `--create-db` - —Å–æ–∑–¥–∞–≤–∞—Ç—å —á–∏—Å—Ç—É—é –ë–î –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∞–º–∏
   - `--nomigrations` - –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
   - –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker —Å PostgreSQL (–ù–ï SQLite)

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–∑–æ–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ fixtures:**
   - `@pytest.fixture(autouse=True)` –≤ `conftest.py` –æ—á–∏—â–∞–µ—Ç –ë–î –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `TRUNCATE TABLE ... RESTART IDENTITY CASCADE`

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

1. **test_parse_goods_xml_with_single_image** - —Ç–æ–≤–∞—Ä —Å –æ–¥–Ω–∏–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
2. **test_parse_goods_xml_with_multiple_images** - —Ç–æ–≤–∞—Ä —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
3. **test_parse_goods_xml_with_no_images** - —Ç–æ–≤–∞—Ä –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
4. **test_parse_goods_xml_with_invalid_image_extension** - –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
5. **test_parse_goods_xml_with_duplicate_image_paths** - –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –ø—É—Ç–∏
6. **test_parse_goods_xml_with_real_data** - —Ä–µ–∞–ª—å–Ω—ã–π XML –∏–∑ `data/import_1c/goods/`
7. **test_validate_image_path_normalization** - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Ç–µ–π (–∑–∞–º–µ–Ω–∞ `\` –Ω–∞ `/`)
8. **test_validate_image_path_supported_extensions** - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º

**–ü—Ä–∏–º–µ—Ä 1: –ü–∞—Ä—Å–∏–Ω–≥ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (AAA Pattern ¬ß10.6.3):**

```python
import pytest
import tempfile
import os
from tests.conftest import get_unique_suffix
from apps.products.services.parser import XMLDataParser

pytestmark = pytest.mark.django_db

@pytest.mark.unit
class TestXMLDataParserImageParsing:

    @pytest.mark.django_db
    def test_parse_goods_xml_with_multiple_images(self):
        """–ü–∞—Ä—Å–∏–Ω–≥ —Ç–æ–≤–∞—Ä–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏"""
        # ARRANGE - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        unique_id = get_unique_suffix()
        xml_content = f"""
        <–ö–∞—Ç–∞–ª–æ–≥>
            <–¢–æ–≤–∞—Ä—ã>
                <–¢–æ–≤–∞—Ä>
                    <–ò–¥>{unique_id}</–ò–¥>
                    <–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ>Test Product</–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ>
                    <–ö–∞—Ä—Ç–∏–Ω–∫–∞>import_files/73/image1.png</–ö–∞—Ä—Ç–∏–Ω–∫–∞>
                    <–ö–∞—Ä—Ç–∏–Ω–∫–∞>import_files/73/image2.jpg</–ö–∞—Ä—Ç–∏–Ω–∫–∞>
                    <–ö–∞—Ä—Ç–∏–Ω–∫–∞>import_files/73/image3.webp</–ö–∞—Ä—Ç–∏–Ω–∫–∞>
                </–¢–æ–≤–∞—Ä>
            </–¢–æ–≤–∞—Ä—ã>
        </–ö–∞—Ç–∞–ª–æ–≥>
        """

        with tempfile.NamedTemporaryFile(mode='w', suffix='.xml', delete=False, encoding='utf-8') as f:
            f.write(xml_content)
            temp_file = f.name

        try:
            # ACT - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
            parser = XMLDataParser()
            goods_list = parser.parse_goods_xml(temp_file)

            # ASSERT - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            assert len(goods_list) == 1
            goods_data = goods_list[0]

            assert goods_data["id"] == unique_id
            assert "images" in goods_data
            assert len(goods_data["images"]) == 3
            assert "import_files/73/image1.png" in goods_data["images"]
            assert "import_files/73/image2.jpg" in goods_data["images"]
            assert "import_files/73/image3.webp" in goods_data["images"]
        finally:
            os.unlink(temp_file)
```

**–ü—Ä–∏–º–µ—Ä 2: –¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ 1–° (CLAUDE.md —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ):**

```python
@pytest.mark.unit
@pytest.mark.django_db
def test_parse_goods_xml_with_real_data(self):
    """–ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∞–ª—å–Ω–æ–≥–æ XML –∏–∑ data/import_1c/goods/"""
    # ARRANGE
    real_file = "data/import_1c/goods/goods_1_1_27c08306-a0aa-453b-b436-f9b494ceb889.xml"

    # ACT
    parser = XMLDataParser()
    goods_list = parser.parse_goods_xml(real_file)

    # ASSERT
    assert len(goods_list) > 0, "–î–æ–ª–∂–µ–Ω —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä"

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –∏–º–µ–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    products_with_images = [g for g in goods_list if "images" in g and len(g["images"]) > 0]
    assert len(products_with_images) > 0, "–î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏"

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –ø—É—Ç–µ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    for product in products_with_images:
        for image_path in product["images"]:
            assert image_path.startswith("import_files/"), f"–ü—É—Ç—å –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å 'import_files/': {image_path}"
            assert any(image_path.lower().endswith(ext) for ext in ['.jpg', '.jpeg', '.png', '.webp']), \
                f"–ù–µ–≤–∞–ª–∏–¥–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ: {image_path}"
```

**–ü—Ä–∏–º–µ—Ä 3: –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—É—Ç–µ–π:**

```python
@pytest.mark.unit
def test_validate_image_path_normalization(self):
    """–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Ç–µ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π"""
    # ARRANGE
    parser = XMLDataParser()

    # ACT & ASSERT - —Ç–µ—Å—Ç–∏—Ä—É–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é
    assert parser._validate_image_path("  import_files/73/image.png  ") == "import_files/73/image.png"
    assert parser._validate_image_path("import_files\\73\\image.jpg") == "import_files/73/image.jpg"

    # ACT & ASSERT - —Ç–µ—Å—Ç–∏—Ä—É–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
    assert parser._validate_image_path("import_files/73/image.png") is not None
    assert parser._validate_image_path("import_files/73/image.jpg") is not None
    assert parser._validate_image_path("import_files/73/image.webp") is not None
    assert parser._validate_image_path("import_files/73/image.exe") is None  # –ù–µ–≤–∞–ª–∏–¥–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
    assert parser._validate_image_path("") is None  # –ü—É—Å—Ç–æ–π –ø—É—Ç—å
```

**–ü—Ä–∏–º–µ—Ä 4: –¢–µ—Å—Ç –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:**

```python
@pytest.mark.unit
@pytest.mark.django_db
def test_parse_goods_xml_with_duplicate_image_paths(self):
    """–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –ø—É—Ç–µ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π"""
    # ARRANGE
    unique_id = get_unique_suffix()
    xml_content = f"""
    <–ö–∞—Ç–∞–ª–æ–≥>
        <–¢–æ–≤–∞—Ä—ã>
            <–¢–æ–≤–∞—Ä>
                <–ò–¥>{unique_id}</–ò–¥>
                <–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ>Test Product</–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ>
                <–ö–∞—Ä—Ç–∏–Ω–∫–∞>import_files/73/image1.png</–ö–∞—Ä—Ç–∏–Ω–∫–∞>
                <–ö–∞—Ä—Ç–∏–Ω–∫–∞>import_files/73/image1.png</–ö–∞—Ä—Ç–∏–Ω–∫–∞>
                <–ö–∞—Ä—Ç–∏–Ω–∫–∞>import_files/73/image2.jpg</–ö–∞—Ä—Ç–∏–Ω–∫–∞>
            </–¢–æ–≤–∞—Ä>
        </–¢–æ–≤–∞—Ä—ã>
    </–ö–∞—Ç–∞–ª–æ–≥>
    """

    with tempfile.NamedTemporaryFile(mode='w', suffix='.xml', delete=False, encoding='utf-8') as f:
        f.write(xml_content)
        temp_file = f.name

    try:
        # ACT
        parser = XMLDataParser()
        goods_list = parser.parse_goods_xml(temp_file)

        # ASSERT - –¥—É–±–ª–∏–∫–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã
        assert len(goods_list) == 1
        goods_data = goods_list[0]
        assert len(goods_data["images"]) == 2  # –ù–µ 3!
        assert "import_files/73/image1.png" in goods_data["images"]
        assert "import_files/73/image2.jpg" in goods_data["images"]
    finally:
        os.unlink(temp_file)
```

### –ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ (¬ß10.5)

**üî¥ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:** –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Docker —Å PostgreSQL.

**–ü—Ä–µ–¥–ø–æ—Å—ã–ª–∫–∏:**

- Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ –∑–∞–ø—É—â–µ–Ω—ã
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ `.env` —Ñ–∞–π–ª–µ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
- Docker-–æ–±—Ä–∞–∑—ã —Å–æ–±—Ä–∞–Ω—ã: `docker-compose -f docker/docker-compose.test.yml build`

**–ö–æ–º–∞–Ω–¥—ã:**

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø–∞—Ä—Å–µ—Ä–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±)
make test-unit

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ docker-compose
docker-compose -f docker/docker-compose.test.yml run --rm backend \
  pytest tests/unit/test_services/test_parser.py --create-db --nomigrations -v

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
docker-compose -f docker/docker-compose.test.yml run --rm backend \
  pytest tests/unit/test_services/test_parser.py::TestXMLDataParserImageParsing -v

# –° –æ—Ç—á–µ—Ç–æ–º –æ –ø–æ–∫—Ä—ã—Ç–∏–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è >=90%)
docker-compose -f docker/docker-compose.test.yml run --rm backend \
  pytest tests/unit/test_services/test_parser.py --cov=apps.products.services.parser --cov-report=term-missing

# –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤
make test-fast
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** SQLite –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π JSON –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ PostgreSQL.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–æ–∫—Ä—ã—Ç–∏—é

–°–æ–≥–ª–∞—Å–Ω–æ [Testing Strategy ¬ß10.7](docs/architecture/10-testing-strategy.md#10.7):

- **–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:** >= 70%
- **–ü–æ–∫—Ä—ã—Ç–∏–µ –¥–ª—è parser.py:** >= 90% (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –º–æ–¥—É–ª—å)
- **–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** (`_validate_image_path`, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `parse_goods_xml`): >= 90%

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (Story 3.1.3)

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ProductDataProcessor –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- End-to-end —Ç–µ—Å—Ç –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞–ª–∏—á–∏—è —Ñ–∞–π–ª–æ–≤ –≤ media storage

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–∑–∞–º–µ—á–∞–Ω–∏–µ QA P2)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –∏–∑ QA gate:** –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –±–∞—Ç—á–∏–Ω–≥ WARNING –ª–æ–≥–æ–≤ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –í _validate_image_path() - –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å batch invalid paths
invalid_paths = []

for image in image_elements:
    validated_path = self._validate_image_path(image.text.strip())
    if not validated_path:
        invalid_paths.append(image.text.strip())

if invalid_paths:
    logger.warning(
        f"Found {len(invalid_paths)} invalid image paths for product {goods_data['id']}: "
        f"{', '.join(invalid_paths[:5])}"  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 5
    )
```

## Dependencies

**–ó–∞–≤–∏—Å–∏—Ç –æ—Ç:**
- ‚úÖ Epic 3 - –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ 1–° (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
- ‚úÖ XMLDataParser –±–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (—Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- ‚úÖ GoodsData TypedDict —Å –ø–æ–ª–µ–º images (—Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

**–ë–ª–æ–∫–∏—Ä—É–µ—Ç:**
- ‚è≥ Story 3.1.2 - –ò–º–ø–æ—Ä—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ Django media storage (—Ç—Ä–µ–±—É–µ—Ç –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—É—Ç–∏)

## Risk Mitigation

**–†–∏—Å–∫:** –ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏ –ø—É—Ç—è–º–∏ –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –∏–∑-–∑–∞ WARNING –ª–æ–≥–æ–≤

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Ä–æ–≤–µ–Ω—å DEBUG –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–π
- WARNING —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø—É—Ç–µ–π
- –ë–∞—Ç—á–∏–Ω–≥ –ª–æ–≥–æ–≤ (–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ N –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –ø—É—Ç–µ–π)

**Rollback –ø–ª–∞–Ω:**

- –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ XMLDataParser —á–µ—Ä–µ–∑ git revert
- –í–∞–ª–∏–¥–∞—Ü–∏—è —è–≤–ª—è–µ—Ç—Å—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π - –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ feature flag

**Feature Flag (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**

–ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –¥–æ–±–∞–≤–∏—Ç—å –≤ `settings.py`:

```python
# backend/freesport/settings/base.py
IMPORT_VALIDATE_IMAGE_PATHS = env.bool('IMPORT_VALIDATE_IMAGE_PATHS', default=True)
```

–ò –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ñ–ª–∞–≥ –≤ `_validate_image_path()` –∏–ª–∏ `parse_goods_xml()`

## Story Complexity

**–û—Ü–µ–Ω–∫–∞:** 2 Story Points (–º–∞–ª–∞—è –∑–∞–¥–∞—á–∞)

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –£–ñ–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (–ø–∞—Ä—Å–∏–Ω–≥ —Ç–µ–≥–æ–≤ `<–ö–∞—Ä—Ç–∏–Ω–∫–∞>`)
- –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ (parser.py)
- Unit-—Ç–µ—Å—Ç—ã –ø—Ä–æ—Å—Ç—ã –≤ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏

**–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è:** 2-3 —á–∞—Å–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ + 1-2 —á–∞—Å–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-08
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** High (–±–ª–æ–∫–∏—Ä—É–µ—Ç Story 3.1.2)
**Epic:** Epic 3.1 - –ò–º–ø–æ—Ä—Ç –∏ —Å–≤—è–∑—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ 1–°
**Assigned to:** Developer Team

**–ò—Ç–æ–≥**: –û–±—Ä–∞–∑—Ü–æ–≤–∞—è brownfield —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Å —á–µ—Ç–∫–∏–º scope —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º. –ì–æ—Ç–æ–≤–∞ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-08 | 1.0 | –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è story | PM Team |
| 2025-11-09 | 1.1 | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ PO: –¥–æ–±–∞–≤–ª–µ–Ω logger, Tasks/Subtasks, —É–ª—É—á—à–µ–Ω—ã AC | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

_–ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ dev-agent –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏_

### Debug Log References

_–ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ dev-agent –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏_

### Completion Notes List

_–ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ dev-agent –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏_

### File List

_–ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ dev-agent –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏_

## QA Results

_–ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ qa-agent –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏_
