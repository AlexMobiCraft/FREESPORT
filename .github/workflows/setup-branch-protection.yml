name: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª –∑–∞—â–∏—Ç—ã –≤–µ—Ç–æ–∫

on:
  # –ó–∞–ø—É—Å–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
  create:
  # –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é
  workflow_dispatch:
  # –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ workflow —Ñ–∞–π–ª–æ–≤
  push:
    paths:
      - '.github/workflows/setup-branch-protection.yml'
      - '.github/scripts/setup-branch-protection.sh'
    branches: [main, develop]

jobs:
  setup-branch-protection:
    name: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª –∑–∞—â–∏—Ç—ã –≤–µ—Ç–æ–∫
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      repository-projects: write
      issues: write
      
    steps:
    - name: Checkout –∫–æ–¥–∞
      uses: actions/checkout@v4
      
    - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
      run: |
        sudo apt-get update
        sudo apt-get install -y jq
        
    - name: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª –∑–∞—â–∏—Ç—ã –≤–µ—Ç–æ–∫
      run: |
        chmod +x .github/scripts/setup-branch-protection.sh
        .github/scripts/setup-branch-protection.sh
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        
    - name: –°–æ–∑–¥–∞–Ω–∏–µ ISSUE –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
      if: github.event_name == 'create'
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: 'üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª –∑–∞—â–∏—Ç—ã –≤–µ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞',
            body: `## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª –∑–∞—â–∏—Ç—ã –≤–µ—Ç–æ–∫
            
            ### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
            - [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –≤–µ—Ç–∫–∏ \`main\`
            - [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –≤–µ—Ç–∫–∏ \`develop\`
            - [x] –í–∫–ª—é—á–µ–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ CI/CD
            - [x] –¢—Ä–µ–±—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º 1 –æ–¥–æ–±—Ä–µ–Ω–∏–µ –¥–ª—è PR
            - [x] –í–∫–ª—é—á–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–æ–º–º–∏—Ç—ã
            
            ### üîí –¢–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞:
            - **main**: –æ—Å–Ω–æ–≤–Ω–∞—è –≤–µ—Ç–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
            - **develop**: –≤–µ—Ç–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            
            ### üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
            1. –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–µ–±—É–µ–º—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
            2. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
            3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –≤–µ—Ç–∫–∞—Ö
            
            ---
            *–≠—Ç–æ issue —Å–æ–∑–¥–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è*`,
            labels: ['infrastructure', 'branch-protection']
          })