# –°–∞–º–º–∞—Ä–∏: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ (–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ProductVariant)

## üéØ –ó–∞–¥–∞—á–∞
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –Ω–∞–±–æ—Ä–∞ backend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Å–ª–æ–º–∞–Ω–Ω–æ–≥–æ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö:
1. –ü–µ—Ä–µ–Ω–æ—Å –ø–æ–ª–µ–π `retail_price`, `stock_quantity`, `sku` –∏ –¥—Ä. –∏–∑ `Product` –≤ `ProductVariant`.
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π `CustomerSyncLog` –∏ `SyncConflict` (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–æ–ª–µ–π –Ω–∞ read-only —Å–≤–æ–π—Å—Ç–≤–∞).
3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å AuditLog –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏.

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

### 1. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (Factories)
- **ProductFactory:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ "Transparent Variant Creation". –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `ProductFactory(retail_price=100)` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–≤—è–∑–∞–Ω–Ω—ã–π `ProductVariant`, —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏.
- **FactoryWrapper:** –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `__call__`, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `product_factory()` –≤–º–µ—Å—Ç–æ `product_factory.create()`.
- **Conftest:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ–∏–∫—Å—Ç—É—Ä–∞ `onec_data_dir` –¥–ª—è —Ç–µ—Å—Ç–æ–≤ –∏–º–ø–æ—Ä—Ç–∞.

### 2. –ú–æ–¥—É–ª–∏ —Ç–µ—Å—Ç–æ–≤ (Unit & Integration)
- **Search:** –¢–µ—Å—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Exists` subquery –∫ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º.
- **Cart & Orders:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã. –¢–µ–ø–µ—Ä—å –∫–æ—Ä–∑–∏–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —Å `variant_id`. –î–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∏–º–∫–∞ —Ü–µ–Ω—ã (`price_snapshot`) –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –∫–æ—Ä–∑–∏–Ω—ã.
- **Monitoring & Reporting:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã `NameError` (uuid/time) –∏ `AttributeError` (customer_email). –û—Ç—á–µ—Ç—ã —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ.
- **User Admin:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `AuditLog.log_action` –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `fieldsets`.

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–¥–µ (Hotfixes)
- **AuditLog:** –î–æ–±–∞–≤–ª–µ–Ω —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥ `log_action` –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞.
- **CustomerSyncLog:** –î–æ–±–∞–≤–ª–µ–Ω—ã `choices` –¥–ª—è –ø–æ–ª–µ–π —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞.
- **load_product_stocks:** –ö–æ–º–∞–Ω–¥–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ (bulk_update –ø–æ `product_variants`).

## üõë –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
- –û–±—â–∏–π –ø—Ä–æ–≥–æ–Ω —Ç–µ—Å—Ç–æ–≤: **1247+ PASS**.
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ `TypeError` –∏ `FieldDoesNotExist`.
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–∞–¥–µ–Ω–∏—è –∏–∑-–∑–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö URL —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (`/api/v1/catalog/products/` -> `/api/v1/products/`).

## üöÄ –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏
1. **Logout Audit:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å `test_logout_audit_logging` (—Å–µ–π—á–∞—Å `user_id` –≤ –ª–æ–≥–µ —Ä–∞–≤–µ–Ω `None`).
2. **Conflict Scenarios:** –î–æ–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É JSON-–ø–æ–ª–µ–π –≤ —Ç–µ—Å—Ç–∞—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ B2B.
3. **Coverage:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ –ø–æ–∫—Ä—ã—Ç–∏–∏ –∏ —É–±–µ–¥–∏—Ç—å—Å—è –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–µ–≥—Ä–µ—Å—Å–∏–π –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–∑–ª–∞—Ö (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å 1–°).
