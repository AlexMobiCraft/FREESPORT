# Story 5.0: Spike - Анализ реальных XML 1С

Status: ready-for-dev

## Story

As a **разработчик**,
I want **проанализировать реальные XML-файлы выгрузки заказов (`orders.xml`) от 1С**,
So that **мы могли спроектировать корректный парсер и маппинг статусов, соответствующий реальной конфигурации 1С клиента**.

## Acceptance Criteria

1. **Given** получены образцы файлов `orders.xml` от рабочей базы 1С клиента
2. **When** проведен анализ структуры XML
3. **Then** задокументированы ключевые теги для: идентификатора заказа, статуса заказа, даты оплаты/отгрузки
4. **And** составлена таблица маппинга "Статус 1С" -> "Статус FREESPORT"
5. **And** определена версия CommerceML (2.10 или 3.1) и наличие контейнеров
6. **And** результаты сохранены в `docs/integrations/1c/analysis-orders-xml.md`

## Tasks / Subtasks

- [ ] Task 1: Получение и первичный осмотр образцов (AC: 1)
  - [ ] 1.1: Запросить файлы `orders.xml` (разные статусы: отгружен, оплачен, отменен)
  - [ ] 1.2: Определить версию CommerceML (атрибут `ВерсияСхемы`) и кодировку
- [ ] Task 2: Детальный анализ структуры (AC: 2, 3, 5)
  - [ ] 2.1: Проверить наличие тега `<Контейнер>` (от этого зависит парсер Epic 5)
  - [ ] 2.2: Найти тег идентификатора заказа (`<Ид>` или `<Номер>`) - проверить совпадение с тем, что мы экспортируем
  - [ ] 2.3: Найти тег статуса (обычно `<ЗначениеРеквизита>` с `Наименование="Статус заказа"`)
  - [ ] 2.4: Найти даты оплаты и отгрузки
- [ ] Task 3: Составление маппинга (AC: 4)
  - [ ] 3.1: Выписать все возможные статусы из 1С
  - [ ] 3.2: Сопоставить их со статусами Django-модели Order (pending, processing, shipped, delivered, cancelled)
- [ ] Task 4: Документирование (AC: 6)
  - [ ] 4.1: Создать файл `docs/integrations/1c/analysis-orders-xml.md`
  - [ ] 4.2: Описать структуру, XPath пути к данным, таблицу маппинга
  - [ ] 4.3: Добавить примеры XML фрагментов

## Dev Notes

- Это исследовательская задача (Spike).
- Результат - документация, не код (кроме, возможно, скриптов для парсинга).
- **Важно:** Мы должны быть уверены, что `orders.xml` использует ту же схему идентификации (UUID или ID), что мы отправляем в `mode=query`.

### Project Structure Notes

- Документация в `docs/integrations/1c/`.
- Если нужны скрипты для теста парсинга, создает `scripts/analyze_1c_xml.py` (не в основной кодовой базе).

### References

- [Source: _bmad-output/planning-artifacts/epics.md#Story 5.0]
- [Source: docs/integrations/1c/architecture.md]

## Dev Agent Record

### Agent Model Used

{{agent_model_name_version}}

### Debug Log References

### Completion Notes List

### File List
