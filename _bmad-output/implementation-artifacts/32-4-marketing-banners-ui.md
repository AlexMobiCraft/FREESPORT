# Story 32.4: Секция маркетинговых баннеров (UI)

Status: ready-for-dev

## История

Как Пользователь,
Я хочу видеть карусель маркетинговых предложений под блоком "Быстрые ссылки",
Чтобы узнавать о текущих акциях, и они не мешали основному Hero-баннеру.

## Критерии приемки

1.  **Размещение и видимость**:
    - **Дано**: структура главной страницы,
    - **Когда**: страница рендерится,
    - **Тогда**: новая секция `MarketingBannersSection` отображается сразу под секцией "Быстрые ссылки" (FR8).

2.  **Обработка пустого состояния**:
    - **Дано**: секция маркетинговых баннеров,
    - **Когда**: API не возвращает активных маркетинговых баннеров,
    - **Тогда**: секция явно скрыта (ничего не рендерит) (FR10).

3.  **Производительность и UX (Загрузка)**:
    - **Дано**: секция отображается,
    - **Когда**: изображение загружается,
    - **Тогда**: Skeleton-лоадер или контейнер с фиксированным соотношением сторон предотвращает сдвиг макета (CLS) (NFR5).
    - **И**: изображение рендерится через `Next/Image` с корректными `sizes` и поддержкой форматов WebP/AVIF, без регрессии UX в текущей конфигурации `images.unoptimized` (NFR4).

4.  **Обработка ошибок (Изображение)**:
    - **Дано**: изображение баннера не загрузилось (404/Error),
    - **Когда**: происходит ошибка,
    - **Тогда**: этот конкретный слайд скрывается или заменяется плейсхолдером (NFR8).

5.  **Обработка ошибок (Компонент)**:
    - **Дано**: критическая ошибка рендера в компоненте,
    - **Когда**: компонент падает,
    - **Тогда**: Error Boundary перехватывает ошибку и скрывает секцию вместо падения всей страницы (NFR6).

6.  **Навигация**:
    - **Дано**: маркетинговый баннер,
    - **Когда**: кликнули по баннеру,
    - **Тогда**: пользователь перенаправляется по настроенному `cta_link`.

## Задачи / Подзадачи

- [ ] **Настройка и каркас**
    - [ ] Создать компонент `MarketingBannersSection` в `frontend/src/components/home/`.
    - [ ] Экспортировать компонент из `frontend/src/components/home/index.ts`.
    - [ ] Интегрировать компонент в `HomePage.tsx` сразу после `QuickLinksSection` и до `CategoriesSection`.

- [ ] **Реализация**
    - [ ] Получение баннеров через `bannersService.getActive('marketing')`.
    - [ ] Интеграция хука `useBannerCarousel` для логики слайдера.
    - [ ] Реализация рендеринга слайдов с использованием `Next/Image` (`sizes`, `loading`, `priority` по правилам секции).
    - [ ] Реализация условного рендеринга (скрыть, если пусто).
    - [ ] Добавить component-level `ErrorBoundary` для секции с fallback `null` (секция скрывается, HomePage продолжает работать).
    - [ ] Навигация по клику реализуется через поле `cta_link` из API.

- [ ] **UX и Стилизация**
    - [ ] Реализовать состояние Skeleton-лоадера, соответствующее соотношению сторон.
    - [ ] Обработка ошибок загрузки изображений (фоллбек или скрытие).
    - [ ] Применить адаптивные стили (мобильные/десктоп).

- [ ] **Тестирование**
    - [ ] Создать юнит-тесты `MarketingBannersSection.test.tsx`.
    - [ ] Настроить тестовые данные для marketing-баннеров: локально мокать `bannersService.getActive('marketing')` в тестах секции **или** переопределить MSW handler `/banners/` с учетом query `type=marketing`.
    - [ ] Проверить состояние загрузки (скелетон).
    - [ ] Проверить пустое состояние (null рендер).
    - [ ] Проверить обработку ошибок API.
    - [ ] Проверить обработку ошибки загрузки изображения (слайд скрывается или показывается placeholder согласно выбранной стратегии).
    - [ ] Проверить, что `ErrorBoundary` перехватывает ошибку рендера и секция скрывается без падения страницы.
    - [ ] Проверить навигацию по клику на баннер через `cta_link`.

### Финальный QA Checklist (Ready for Review)

- [ ] **AC1 / FR8:** В `HomePage` секция рендерится сразу после `QuickLinksSection` и до `CategoriesSection`.
- [ ] **AC2 / FR10:** При ответе API `[]` секция не рендерится (`null`).
- [ ] **AC3 / NFR5:** Во время загрузки рендерится skeleton/контейнер с фиксированным aspect ratio (без layout shift в рамках компонента).
- [ ] **AC3 / NFR4:** Слайды используют `Next/Image` с корректными `sizes`; форматы WebP/AVIF не деградируют UX при текущем `images.unoptimized`.
- [ ] **AC4 / NFR8:** Ошибка загрузки изображения (onError) обрабатывается: слайд скрыт или заменен placeholder согласно принятой стратегии.
- [ ] **AC5 / NFR6:** Component-level Error Boundary перехватывает render error; HomePage продолжает рендер остальных секций.
- [ ] **AC6:** Клик по баннеру ведет на `cta_link` из API-контракта.
- [ ] Проверены accessibility-атрибуты: `alt` у изображения, доступный label секции/элементов управления.
- [ ] Проверено, что при API error компонент деградирует безопасно (без crash всей страницы).
- [ ] Проверено, что при `banners.length > 1` работает навигация карусели (dots/controls), при `<=1` лишние контролы скрыты.

### Команды валидации (frontend)

- [ ] `npm run lint`
- [ ] `npm run test -- src/components/home/__tests__/MarketingBannersSection.test.tsx`
- [ ] `npm run test -- src/components/home/__tests__/HomePage.test.tsx` (если добавлен интеграционный тест порядка секций)
- [ ] `npm run test:coverage` (опционально перед merge)

## Заметки разработчика

### Архитектура
- **Компонент**: `MarketingBannersSection`
- **Сервис**: `bannersService` (уже существует, поддерживает тип 'marketing')
- **Хук**: `useBannerCarousel` (уже существует из Story 32.3)
- **Контракт API**: для перехода используется поле `cta_link` (не `target_url`).
- **Отказоустойчивость**: секция должна быть обернута в component-level Error Boundary с fallback `null`.
- **Тестовая инфраструктура**: глобальный MSW handler `/banners/` по умолчанию отдает hero-баннер; для этой story тесты должны явно формировать marketing-данные (через локальный mock сервиса или override handler на `type=marketing`).

### Ограничения
- **Изображения**: Обязательно использовать `Next/Image`; учитывать текущую конфигурацию `images.unoptimized` и не вводить противоречий с ней.
- **CLS**: Критично поддерживать контейнеры с фиксированным соотношением сторон до загрузки изображения.
- **Отказоустойчивость**: Главная страница никогда не должна ломаться, если эта маркетинговая секция упадет.

## Запись агента разработки

### Используемая модель агента
Cascade (Windsurf)
