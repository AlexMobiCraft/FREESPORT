---
title: 'Обновление блока популярных категорий'
slug: 'update-popular-categories'
created: '2026-01-12'
status: 'ready-for-dev'
stepsCompleted: [1, 2, 3, 4]
tech_stack: ['Next.js', 'React', 'Tailwind CSS']
files_to_modify: ['c:\\Users\\38670\\DEV_WEB\\FREESPORT\\frontend\\src\\components\\home\\CategoriesSection.tsx']
code_patterns: ['Component-based architecture', 'Client-side data fetching', 'Service layer pattern']
test_patterns: ['Jest', 'React Testing Library']
---

# Техническое задание: Обновление блока популярных категорий

## Обзор

### Проблема

В настоящее время блок "Популярные категории" на главной странице (и на `/home`) отображает произвольный набор из 6 корневых категорий. Бизнес-требования предписывают отображать конкретный упорядоченный список из 7 категорий.

### Решение

Рефакторинг компонента `CategoriesSection`: получение всех корневых категорий и их фильтрация/сортировка на стороне клиента для соответствия списку. Обеспечение отображения всех 7 категорий, корректной верстки и ссылок на `/catalog`.

### Объем работ (Scope)

**Входит в объем**:

- Модификация `src/components/home/CategoriesSection.tsx` для реализации фильтрации и сортировки.
- Обновление Grid-верстки для размещения 7 элементов (Smart Grid).
- **Mobile UX**: Горизонтальный скролл (Карусель) для мобильных устройств.
- **UX**: Добавление Skeleton Loader для предотвращения сдвига макета.
- Обеспечение переходов на `/catalog/[slug]`.

**Не входит в объем**:

- Изменения на бэкенде.
- Глобальные изменения дизайна сайта.

## Контекст разработки

- **Список категорий (в порядке приоритета)**:
  1. Спортивные игры
  2. Фитнес и атлетика
  3. Гимнастика и танцы
  4. Плавание
  5. Единоборства
  6. Детский транспорт
  7. Оборудование

- **Компонент**: `CategoriesSection` используется на `src/app/page.tsx` (Продакшн) и `src/app/home/page.tsx` (Тест).
- **Данные**: Используется `categoriesService.getCategories`.
- **Ограничение**: Текущий вызов имеет `limit=6`. Нужно убрать лимит (или увеличить до 100) и фильтровать на клиенте.

### Изменяемые файлы

| Файл | Изменения |
|------|-----------|
| `src/components/home/CategoriesSection.tsx` | - Загрузка ВСЕХ категорий (limit: 100)<br>- Фильтрация по SLUG (с маппингом на русские названия)<br>- **Smart Grid Верстка**: Ряд 1 (3 элемента), Ряд 2 (4 элемента)<br>- Устойчивость к ошибкам (Resilience) |

### Технические решения

- **Стратегия фильтрации**:
  - **Strict Slug**: Фильтрация СТРОГО по слагам. Маппинг по именам ненадежен.
  - Маппинг и верстка:
    1. Спортивные игры (`sportivnye-igry`) -> Большая карточка (Row 1)
    2. Фитнес и атлетика (`fitnes-i-atletika`) -> Большая карточка (Row 1)
    3. Гимнастика и танцы (`gimnastika-i-tantsy`) -> Большая карточка (Row 1)
    4. Плавание (`plavanie`) -> Стандартная карточка (Row 2)
    5. Единоборства (`edinoborstva`) -> Стандартная карточка (Row 2)
    6. Детский транспорт (`detskiy-transport`) -> Стандартная карточка (Row 2)
    7. Оборудование (`oborudovanie`) -> Стандартная карточка (Row 2)
  - *Примечание*: Слаги должны точно совпадать. Fallback по имени убираем.

- **Иконки**:
  - Иконки пока не используем (по требованию заказчика). UI: Только название категории.

- **Архитектура верстки (Smart Grid)**:
  - **Desktop**:
    - Ряд 1: `grid-cols-3` (Элементы 1-3).
    - Ряд 2: `grid-cols-4` (Элементы 4-7).
  - **Mobile**:
    - **Горизонтальная карусель** (`overflow-x-auto`).
    - Карточки фиксированной ширины (например, `w-[280px]`).

- **User Experience**:
  - **Skeleton Loader**: Отображать скелет (имитацию сетки) во время загрузки данных (`isLoading`).

- **Устойчивость (Resilience)**:
  - Если категория не пришла с API — пропускаем.
  - Если элементов < 7 — центрируем оставшиеся, не ломая сетку.

## План реализации (Implementation Plan)

### Задача 1: Интеграция с CategoriesService

- [ ] Задача 1.1: Убрать лимит в запросе
  - Файл: `src/components/home/CategoriesSection.tsx`
  - Действие: Изменить вызов `categoriesService.getCategories`, убрав `limit` (или поставив 100), чтобы получить все категории для фильтрации.

### Задача 2: Логика фильтрации и иконок

- [ ] Задача 2.1: Определить маппинг
  - Файл: `src/components/home/CategoriesSection.tsx`
  - Действие: Создать константу `TARGET_CATEGORIES` с полями `slug` и `priority`.
  - Действие: Реализовать функцию `filterCategories`, сопоставляющую ответ API с `TARGET_CATEGORIES` по слагу (основной) или имени (резервный).

### Задача 3: Smart Grid Верстка

- [ ] Задача 3.1: Логика рендеринга
  - Файл: `src/components/home/CategoriesSection.tsx`
- [ ] Задача 3.1: Логика рендеринга
  - Файл: `src/components/home/CategoriesSection.tsx`
  - Действие: Разделить отфильтрованные категории на `row1` (первые 3) и `row2` (следующие 4).
  - Действие: Рендерить `row1` в контейнере `grid-cols-3`.
  - Действие: Рендерить `row2` в контейнере `grid-cols-4`.
  - Действие: **Mobile**: Реализовать контейнер с `overflow-x-auto` (hidden scrollbar) и `flex-nowrap`.
  - Действие: **Skeleton**: Создать компонент `CategoriesSkeleton` (или использовать существующий UI) и показывать его при `isLoading`.

- [ ] Задача 3.2: Обновление UI карточки
  - Файл: `src/components/home/CategoriesSection.tsx`
  - Действие: Выровнять высоту карточек.

## Критерии приемки (Acceptance Criteria)

### AC 1: Отображение конкретных категорий

- [ ] **Дано**: Я на главной странице. **Когда**: Страница загружается. **Тогда**: Я вижу ровно 7 категорий: Спортивные игры, Фитнес и атлетика, Гимнастика и танцы, Плавание, Единоборства, Детский транспорт, Оборудование.

### AC 2: Корректная верстка (Smart Grid)

- [ ] **Дано**: Десктоп экран (>1024px). **Тогда**: Я вижу 3 элемента в верхнем ряду и 4 элемента в нижнем.
- [ ] **Дано**: Мобильный экран. **Тогда**: Элементы расположены в горизонтальной карусели с возможностью скролла.

### AC 3: Loading State

- [ ] **Дано**: Данные загружаются. **Тогда**: Пользователь видит Skeleton Loader, повторяющий структуру сетки (без прыжков контента).

- [ ] **Когда**: Я кликаю на "Спортивные игры". **Тогда**: Переход на `/catalog/sportivnye-igry` (или соответствующий слаг).

### AC 5: Отказоустойчивость

- [ ] **Дано**: API не вернул категорию "Плавание". **Тогда**: Блок отображает оставшиеся 6 категорий, центрируя их, верстка не "ломается".

## Стратегия тестирования

- **Unit Tests**: `src/components/home/__tests__/CategoriesSection.test.tsx`:
  - Замокать `categoriesService` с большим списком.
  - Проверить, что рендерятся только нужные 7.
  - Проверить наличие ссылок.
- **Manual**: Проверить визуально на `/home` (Desktop/Mobile).
